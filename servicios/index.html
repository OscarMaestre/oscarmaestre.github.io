<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programación de servicios y procesos</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="None" href="index.html#document-index" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="programacion-de-servicios-y-procesos">
<h1>Programacion de servicios y procesos<a class="headerlink" href="#programacion-de-servicios-y-procesos" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-textos/tema1"></span><div class="section" id="programacion-multiproceso">
<h2>﻿Programación multiproceso<a class="headerlink" href="#programacion-multiproceso" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="ejecutables-procesos-servicios">
<h3>Ejecutables. Procesos. Servicios.<a class="headerlink" href="#ejecutables-procesos-servicios" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="ejecutables">
<h4>Ejecutables<a class="headerlink" href="#ejecutables" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Un ejecutable es un archivo con la estructura necesaria para que el sistema operativo pueda poner en marcha el programa que hay dentro. En Windows, los ejecutables suelen ser archivos con la extension .EXE.</p>
<p>Se pueden utilizar &#8220;desensambladores&#8221; para averiguar la secuencia de instrucciones que hay en un EXE. Incluso existen desensambladores en línea como <a class="reference external" href="http://onlinedisassembler.com">http://onlinedisassembler.com</a></p>
<p>Sin embargo, Java genera ficheros .JAR o .CLASS. Estos ficheros <em>no son ejecutables</em> sino que son archivos que el intérprete de JAVA (el archivo <code class="docutils literal"><span class="pre">java.exe</span></code>) leerá y ejecutará.</p>
<p>El intérprete toma el programa y lo traduce a instrucciones del microprocesador en el que estemos, que puede ser x86 o un x64 o lo que sea. Ese proceso se hace &#8220;al instante&#8221; o JIT (Just-In-Time).</p>
<p>Un archivo .CLASS puede desensamblarse utilizando el comando <code class="docutils literal"><span class="pre">javap</span> <span class="pre">-c</span> <span class="pre">&lt;archivo.class&gt;</span></code> . Cuando se hace así, se obtiene un listado de &#8220;instrucciones&#8221; que no se corresponden con las instrucciones del microprocesador, sino con &#8220;instrucciones virtuales de Java&#8221;. El intérprte Java (el archivo <code class="docutils literal"><span class="pre">java.exe</span></code>) traducirá en el momento del arranque dichas instrucciones virtuales Java a instrucciones reales del microprocesador.</p>
<p>Este último aspecto es el esgrimido por Java para defender que su ejecución puede ser más rápida que la de un EXE, ya que Java puede averiguar en qué microprocesador se está ejecutando y así generar el código más óptimo posible.</p>
<p>Un EXE puede que no contenga las instrucciones de los microprocesadores más modernos. Como todos son compatibles no es un gran problema, sin embargo, puede que no aprovechemos al 100% la capacidad de nuestro micro.</p>
</div>
<div class="section" id="procesos">
<h4>Procesos<a class="headerlink" href="#procesos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Es un archivo que está en ejecución y bajo el control del sistema operativo. Un proceso puede atravesar diversas etapas en su &#8220;ciclo de vida&#8221;. Los estados en los que puede estar son:</p>
<ul class="simple">
<li>En ejecución: está dentro del microprocesador.</li>
<li>Pausado/detenido/en espera: el proceso tiene que seguir en ejecución pero en ese momento el S.O tomó la decisión de dejar paso a otro.</li>
<li>Interrumpido: el proceso tiene que seguir en ejecución pero <em>el usuario</em> ha decidido interrumpir la ejecución.</li>
<li>Existen otros estados pero ya son muy dependientes del sistema operativo concreto.</li>
</ul>
</div>
<div class="section" id="servicios">
<h4>Servicios<a class="headerlink" href="#servicios" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Un servicio es un proceso que no muestra ninguna ventana ni gráfico en pantalla porque no está pensado para que el usuario lo maneje directamente.</p>
<p>Habitualmente, un servicio es un programa que atiende a otro programa.</p>
</div>
</div>
<div class="section" id="hilos">
<h3>Hilos.<a class="headerlink" href="#hilos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un hilo es un concepto más avanzado que un proceso: al hablar de procesos cada uno tiene su propio espacio en memoria. Si abrimos 20 procesos cada uno de ellos consume 20x de memoria RAM. Un hilo es un proceso mucho más ligero, en el que el código y los datos se comparten de una forma distinta.</p>
<p>Un proceso no tiene acceso a los datos de otro procesos. Sin embargo un hilo sí accede a los datos de otro hilo. Esto complicará algunas cuestiones a la hora de programar.</p>
</div>
<div class="section" id="programacion-concurrente">
<h3>Programación concurrente.<a class="headerlink" href="#programacion-concurrente" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La programación concurrente es la parte de la programación que se ocupa de crear programas que pueden tener varios procesos/hilos que colaboran para ejecutar un trabajo y aprovechar al máximo el rendimiento de sistemas multinúcleo.</p>
</div>
<div class="section" id="programacion-paralela-y-distribuida">
<h3>Programación paralela y distribuida.<a class="headerlink" href="#programacion-paralela-y-distribuida" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Dentro de la programación concurrente tenemos la paralela y la distribuida:</p>
<ul class="simple">
<li>En general se denomina &#8220;programación paralela&#8221; a la creación de software que se ejecuta siempre en un solo ordenador (con varios núcleos o no)</li>
<li>Se denomina &#8220;programación distribuida&#8221; a la creación de software que se ejecuta en ordenadores distintos y que se comunican a través de una red.</li>
</ul>
</div>
<div class="section" id="creacion-de-procesos">
<h3>Creación de procesos.<a class="headerlink" href="#creacion-de-procesos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En Java es posible crear procesos utilizando algunas clases que el entorno ofrece para esta tarea. En este tema, veremos en profundidad la clase ProcessBuilder.</p>
<p>El ejemplo siguiente muestra como lanzar un proceso de Acrobat Reader:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LanzadorProcesos</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ejecutar</span><span class="o">(</span><span class="n">String</span> <span class="n">ruta</span><span class="o">){</span>

                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="n">ruta</span><span class="o">);</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>

        <span class="o">}</span>
        <span class="cm">/**</span>
<span class="cm">         * @param args</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">ruta</span><span class="o">=</span>
                        <span class="s">&quot;C:\\Program Files (x86)\\Adobe\\Reader 11.0\\Reader\\AcroRd32.exe&quot;</span><span class="o">;</span>
                <span class="n">LanzadorProcesos</span> <span class="n">lp</span><span class="o">=</span><span class="k">new</span> <span class="n">LanzadorProcesos</span><span class="o">();</span>
                <span class="n">lp</span><span class="o">.</span><span class="na">ejecutar</span><span class="o">(</span><span class="n">ruta</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Finalizado&quot;</span><span class="o">);</span>
        <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Supongamos que necesitamos crear un programa que aproveche al máximo el número de CPUs para realizar alguna tarea intensiva. Supongamos que dicha tarea consiste en sumar números.</p>
<p>Enunciado: crear una clase Java que sea capaz de sumar todos los números comprendidos entre dos valores incluyendo ambos valores.</p>
<p>Para resolverlo crearemos una clase <code class="docutils literal"><span class="pre">Sumador</span></code> que tenga un método que acepte dos números <code class="docutils literal"><span class="pre">n1</span></code> y <code class="docutils literal"><span class="pre">n2</span></code> y que devuelva la suma de todo el intervalor.</p>
<p>Además, incluiremos un método <code class="docutils literal"><span class="pre">main</span></code> que ejecute la operación de suma tomando los números de la línea de comandos (es decir, se pasan como argumentos al main).</p>
<p>El código de dicha clase podría ser algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.ies</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sumador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumar</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n2</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">resultado</span><span class="o">+</span><span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Sumador</span> <span class="n">s</span><span class="o">=</span><span class="k">new</span> <span class="n">Sumador</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">n1</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">n2</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">sumar</span><span class="o">(</span><span class="n">n1</span><span class="o">,</span> <span class="n">n2</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">resultado</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Para ejecutar este programa desde dentro de Eclipse es necesario indicar que deseamos enviar <em>argumentos</em> al programa. Por ejemplo, si deseamos sumar los números del 2 al 10, deberemos ir a la venta &#8220;Run configuration&#8221; y en la pestaña &#8220;Arguments&#8221; indicar los argumentos (que en este caso son los dos números a indicar).</p>
<div class="figure align-center" id="id1" style="width: 50%">
<img alt="_images/configuraciones.png" src="_images/configuraciones.png" />
<p class="caption"><span class="caption-text">Modificando los argumentos del programa</span></p>
</div>
<p>Una vez hecha la prueba de la clase sumador, le quitamos el main, y crearemos una clase que sea capaz de lanzar varios procesos. La clase <code class="docutils literal"><span class="pre">Sumador</span></code> se quedará así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sumador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumar</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n2</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">resultado</span><span class="o">+</span><span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Y ahora tendremos una clase que lanza procesos de esta forma:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.ies</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lanzador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lanzarSumador</span><span class="o">(</span><span class="n">Integer</span> <span class="n">n1</span><span class="o">,</span>
                        <span class="n">Integer</span> <span class="n">n2</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">clase</span><span class="o">=</span><span class="s">&quot;com.ies.Sumador&quot;</span><span class="o">;</span>
                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span>
                                        <span class="s">&quot;java&quot;</span><span class="o">,</span><span class="n">clase</span><span class="o">,</span>
                                        <span class="n">n1</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span>
                                        <span class="n">n2</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Lanzador</span> <span class="n">l</span><span class="o">=</span><span class="k">new</span> <span class="n">Lanzador</span><span class="o">();</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">51</span><span class="o">);</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">51</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Ok&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="comunicacion-entre-procesos">
<h3>Comunicación entre procesos.<a class="headerlink" href="#comunicacion-entre-procesos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las operaciones multiproceso pueden implicar que sea necesario comunicar información entre muchos procesos, lo que obliga a la necesidad de utilizar mecanismos específicos de comunicación que ofrecerá Java o a diseñar alguno separado que evite los problemas que puedan aparecer.</p>
<p>En el ejemplo, el segundo proceso suele sobreescribir el resultado del primero, así que modificaremos el código del lanzador para que cada proceso use su propio fichero de resultados.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lanzador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lanzarSumador</span><span class="o">(</span><span class="n">Integer</span> <span class="n">n1</span><span class="o">,</span>
                        <span class="n">Integer</span> <span class="n">n2</span><span class="o">,</span> <span class="n">String</span> <span class="n">fichResultado</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">clase</span><span class="o">=</span><span class="s">&quot;com.ies.Sumador&quot;</span><span class="o">;</span>
                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span>
                                        <span class="s">&quot;java&quot;</span><span class="o">,</span><span class="n">clase</span><span class="o">,</span>
                                        <span class="n">n1</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span>
                                        <span class="n">n2</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>

                        <span class="n">pb</span><span class="o">.</span><span class="na">redirectError</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;errores.txt&quot;</span><span class="o">));</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">redirectOutput</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fichResultado</span><span class="o">));</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Lanzador</span> <span class="n">l</span><span class="o">=</span><span class="k">new</span> <span class="n">Lanzador</span><span class="o">();</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="s">&quot;result1.txt&quot;</span><span class="o">);</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span> <span class="s">&quot;result2.txt&quot;</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Ok&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Cuando se lanza un programa desde Eclipse no ocurre lo mismo que cuando se lanza desde Windows. Eclipse trabaja con unos directorios predefinidos y puede ser necesario indicar a nuestro programa cual es la ruta donde hay que buscar algo.</p>
<p>Usando el método <code class="docutils literal"><span class="pre">.directory(new</span> <span class="pre">File(&quot;c:\\dir\\))</span></code> se puede indicar a Java donde está el archivo que se desea ejecutar.</p>
</div>
<div class="section" id="ejercicio">
<h3>Ejercicio<a class="headerlink" href="#ejercicio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Crear un programa que permita parametrizar el lanzamiento de sumadores, que vuelque el contenido de las sumas en ficheros y que permita al programa principal recuperar las sumas de los ficheros parciales.</p>
<p>En el listado siguiente se muestra la clase Sumador</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">es.ies.multiproceso</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sumador</span> <span class="o">{</span>
        <span class="cm">/** Suma todos los valores incluidos</span>
<span class="cm">         * entre dos valores</span>
<span class="cm">         * @param n1 Limite 1</span>
<span class="cm">         * @param n2 Limite 2</span>
<span class="cm">         * @return La suma de dichos valores</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">sumar</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">suma</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">n1</span><span class="o">&gt;</span><span class="n">n2</span><span class="o">){</span>
                        <span class="kt">int</span> <span class="n">aux</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span>
                        <span class="n">n1</span><span class="o">=</span><span class="n">n2</span><span class="o">;</span>
                        <span class="n">n2</span><span class="o">=</span><span class="n">aux</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">n2</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">suma</span><span class="o">=</span><span class="n">suma</span><span class="o">+</span><span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">n1</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">n2</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">suma</span><span class="o">=</span><span class="n">sumar</span><span class="o">(</span><span class="n">n1</span><span class="o">,</span> <span class="n">n2</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">suma</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>En el listado siguiente se muestra la clase Main</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">NUM_PROCESOS</span><span class="o">=</span><span class="mi">4</span><span class="o">;</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PREFIJO_FICHEROS</span><span class="o">=</span><span class="s">&quot;fich&quot;</span><span class="o">;</span>


        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">lanzarSumador</span><span class="o">(</span>
                        <span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">,</span><span class="n">String</span> <span class="n">fichResultados</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">String</span> <span class="n">comando</span><span class="o">;</span>
                <span class="n">comando</span><span class="o">=</span><span class="s">&quot;es.ies.multiproceso.Sumador&quot;</span><span class="o">;</span>

                <span class="n">File</span> <span class="n">directorioSumador</span><span class="o">;</span>
                <span class="n">directorioSumador</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;C:\\Users\\&quot;</span><span class="o">+</span>
                <span class="s">&quot;ogomez\\workspace\\&quot;</span><span class="o">+</span>
                <span class="s">&quot;MultiProceso1\\bin\\&quot;</span><span class="o">);</span>
                <span class="n">File</span> <span class="n">fichResultado</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fichResultados</span><span class="o">);</span>
                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="n">pb</span><span class="o">=</span><span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="s">&quot;java&quot;</span><span class="o">,</span>
                                <span class="n">comando</span><span class="o">,</span>
                                <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">n1</span><span class="o">),</span>
                                <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">n2</span><span class="o">)</span> <span class="o">);</span>
                <span class="n">pb</span><span class="o">.</span><span class="na">directory</span><span class="o">(</span><span class="n">directorioSumador</span><span class="o">);</span>
                <span class="n">pb</span><span class="o">.</span><span class="na">redirectOutput</span><span class="o">(</span><span class="n">fichResultado</span><span class="o">);</span>
                <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getResultadoFichero</span><span class="o">(</span>
                        <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">){</span>

                <span class="kt">int</span> <span class="n">suma</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">FileInputStream</span> <span class="n">fichero</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span>
                                                        <span class="n">nombreFichero</span><span class="o">);</span>
                        <span class="n">InputStreamReader</span> <span class="n">fir</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span>
                                                        <span class="n">fichero</span><span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">fir</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">suma</span><span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                        <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;No se pudo abrir &quot;</span><span class="o">+</span><span class="n">nombreFichero</span><span class="o">);</span>

                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;No hay nada en &quot;</span><span class="o">+</span><span class="n">nombreFichero</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
        <span class="o">}</span>


        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getSumaTotal</span><span class="o">(</span><span class="kt">int</span> <span class="n">numFicheros</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">sumaTotal</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">NUM_PROCESOS</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">sumaTotal</span><span class="o">+=</span><span class="n">getResultadoFichero</span><span class="o">(</span>
                                <span class="n">PREFIJO_FICHEROS</span><span class="o">+</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">sumaTotal</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="cm">/* Recibe dos parámetros y hará</span>
<span class="cm">         * la suma de los valores comprendidos</span>
<span class="cm">         * entre ambos parametros</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span><span class="o">{</span>
                <span class="kt">int</span> <span class="n">n1</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">n2</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">salto</span><span class="o">=(</span> <span class="n">n2</span> <span class="o">/</span> <span class="n">NUM_PROCESOS</span> <span class="o">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">NUM_PROCESOS</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;n1:&quot;</span><span class="o">+</span><span class="n">n1</span><span class="o">);</span>
                        <span class="kt">int</span> <span class="n">resultadoSumaConSalto</span><span class="o">=</span><span class="n">n1</span><span class="o">+</span><span class="n">salto</span><span class="o">;</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;n2:&quot;</span><span class="o">+</span><span class="n">resultadoSumaConSalto</span><span class="o">);</span>
                        <span class="n">lanzarSumador</span><span class="o">(</span><span class="n">n1</span><span class="o">,</span> <span class="n">n1</span><span class="o">+</span><span class="n">salto</span> <span class="o">,</span>
                                        <span class="n">PREFIJO_FICHEROS</span><span class="o">+</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                        <span class="n">n1</span><span class="o">=</span><span class="n">n1</span> <span class="o">+</span> <span class="n">salto</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Suma lanzada...&quot;</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">sumaTotal</span><span class="o">=</span><span class="n">getSumaTotal</span><span class="o">(</span><span class="n">NUM_PROCESOS</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;La suma total es:&quot;</span><span class="o">+</span>
                                                <span class="n">sumaTotal</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ejercicio-resuelto">
<h3>Ejercicio resuelto<a class="headerlink" href="#ejercicio-resuelto" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Crear un programa que sea capaz de contar cuantas vocales hay en un fichero. El programa padre debe lanzar cinco procesos hijo, donde cada uno de ellos se ocupará de contar una vocal concreta (que puede ser minúscula o mayúscula). Cada subproceso que cuenta vocales deberá dejar el resultado en un fichero. El programa padre se ocupará de recuperar los resultados de los ficheros, sumar todos los subtotales y mostrar el resultado final en pantalla.</p>
<div class="section" id="operaciones-con-ficheros">
<h4>Operaciones con ficheros<a class="headerlink" href="#operaciones-con-ficheros" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Tanto en este ejercicio como en muchos otros vamos a necesitar realizar ciertas operaciones con ficheros. Para aumentar nuestra productividad utilizaremos una clase llamada <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code> que nos permita realizar ciertas tareas como las siguientes:</p>
<ul class="simple">
<li>Obtener un objeto <code class="docutils literal"><span class="pre">BufferedReader</span></code> a partir de un nombre de fichero de tipo <code class="docutils literal"><span class="pre">String</span></code>. Llamaremos a este método <code class="docutils literal"><span class="pre">getBufferedReader</span></code> y lo utilizaremos para poder manejar un fichero mediante una clase de muy alto nivel que nos facilita la lectura de ficheros. En el listado adjunto se puede consultar dicho método.</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedReader</span> <span class="nf">getBufferedReader</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">FileNotFoundException</span> <span class="o">{</span>
    <span class="n">FileReader</span> <span class="n">lector</span><span class="o">;</span>
    <span class="n">lector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="n">BufferedReader</span> <span class="n">bufferedReader</span><span class="o">;</span>
    <span class="n">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">lector</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">bufferedReader</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li>De la misma forma crearemos un método <code class="docutils literal"><span class="pre">getPrintWriter</span></code> que nos devuelva un objeto de la clase <code class="docutils literal"><span class="pre">PrintWriter</span></code> para poder realizar fácilmente operaciones de escritura en ficheros. En el listado adjunto se muestra el código.</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">PrintWriter</span> <span class="nf">getPrintWriter</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">PrintWriter</span> <span class="n">printWriter</span><span class="o">;</span>
    <span class="n">FileWriter</span> <span class="n">fileWriter</span><span class="o">;</span>
    <span class="n">fileWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="n">printWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">fileWriter</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">printWriter</span><span class="o">;</span>
<span class="c1">//Fin de getPrintWriter</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li>Aunque nos estamos anticipando, puede ser útil tener un método que dado un nombre de fichero nos devuelva un <code class="docutils literal"><span class="pre">ArrayList&lt;String&gt;</span></code> con todas las líneas que hay en el fichero. <strong>En este ejercicio no lo usaremos</strong>. Este método podría implementarse así:</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLineasFichero</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">BufferedReader</span> <span class="n">bfr</span> <span class="o">=</span> <span class="n">getBufferedReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="c1">//Leemos líneas del fichero...</span>
    <span class="n">String</span> <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">linea</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//Y las añadimos al array</span>
        <span class="n">lineas</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
        <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//Fin del bucle que lee líneas</span>
    <span class="k">return</span> <span class="n">lineas</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="procesado-de-ficheros">
<h4>Procesado de ficheros<a class="headerlink" href="#procesado-de-ficheros" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Necesitaremos una clase <code class="docutils literal"><span class="pre">ProcesadorFichero</span></code> que nos permita procesar los ficheros de la forma pedida. Antes de crear un programa multiproceso empezaremos por crear una clase simple que nos resuelva este problema.</p>
<p>Dicha clase tendrá un método <code class="docutils literal"><span class="pre">hacerRecuento</span></code> que resuelva el problema de contar el número de apariciones en un fichero dejando el total de apariciones en un fichero de salida distintos. En el código adjunto podemos ver como podría implementarse dicho método.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLineasFichero</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">BufferedReader</span> <span class="n">bfr</span> <span class="o">=</span> <span class="n">getBufferedReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="c1">//Leemos líneas del fichero...</span>
    <span class="n">String</span> <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">linea</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//Y las añadimos al array</span>
        <span class="n">lineas</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
        <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//Fin del bucle que lee líneas</span>
    <span class="k">return</span> <span class="n">lineas</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>La clase <code class="docutils literal"><span class="pre">ProcesadorFichero</span></code> será lanzada desde otra clase que llamaremos <code class="docutils literal"><span class="pre">Lanzador</span></code>. Nuestra <code class="docutils literal"><span class="pre">ProcesadorFichero</span></code> recogerá en su método <code class="docutils literal"><span class="pre">main</span></code> los siguientes parámetros:</p>
<ol class="arabic simple">
<li>El nombre del fichero a procesar. Lo llamaremos <code class="docutils literal"><span class="pre">nombreFicheroEntrada</span></code> y estará en la posición 0 de los argumentos.</li>
<li>La letra de la que hay que hacer el recuento de apariciones. La llamaremos <code class="docutils literal"><span class="pre">letra</span></code> y estará en la posición 1.</li>
<li>El nombre del fichero donde se dejarán los resultados. Lo llamaremos <code class="docutils literal"><span class="pre">nombreFicheroResultado</span></code> y estará en la posición 1 de los argumentos.</li>
</ol>
<p>El código del main se muestra a continuación.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">	 * Dado un fichero pasado como argumento, contará cuantas</span>
<span class="cm">	 * apariciones hay de una cierta vocal (pasada como argumento)</span>
<span class="cm">	 * y dejará la cantidad en otro fichero (también pasado como</span>
<span class="cm">	 * argumento)</span>
<span class="cm">	 * @throws IOException</span>
<span class="cm">	 * @throws FileNotFoundException  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">FileNotFoundException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">nombreFicheroEntrada</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">letra</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">nombreFicheroResultado</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    <span class="n">hacerRecuento</span><span class="o">(</span><span class="n">nombreFicheroEntrada</span><span class="o">,</span> <span class="n">letra</span><span class="o">,</span> <span class="n">nombreFicheroResultado</span><span class="o">);</span>
<span class="c1">//Fin del main</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lanzamiento-de-los-procesos">
<h3>Lanzamiento de los procesos<a class="headerlink" href="#lanzamiento-de-los-procesos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La clase <code class="docutils literal"><span class="pre">Lanzador</span></code> tendrá un método <code class="docutils literal"><span class="pre">main</span></code> que se encargará de varias cosas:</p>
<ol class="arabic simple">
<li>Recoger el primer parámetro (<code class="docutils literal"><span class="pre">args[0]</span></code>), que contendrá el fichero a procesar.</li>
<li>Recoger el segundo parámetro, que contendrá el directorio de <code class="docutils literal"><span class="pre">CLASSPATH</span></code> donde habrá que buscar la clase <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code>.</li>
<li>Recoger el tercer parámetro, que contendrá el directorio donde habrá que buscar la clase <code class="docutils literal"><span class="pre">ProcesadorFicheros</span></code>.</li>
<li>Una vez recogidos los parámetros, se lanzarán los procesos utilizando la clase <code class="docutils literal"><span class="pre">ProcessBuilder</span></code>.</li>
<li>Los procesos se ejecutarán y después recogeremos los resultados de los ficheros.</li>
</ol>
<p>En el código siguiente puede verse el método <code class="docutils literal"><span class="pre">main</span></code> de esta clase <code class="docutils literal"><span class="pre">Lanzador</span></code>. La recogida de resultados se deja como ejercicio:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">ficheroEntrada</span><span class="o">;</span>
    <span class="n">ficheroEntrada</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">classpathUtilidades</span><span class="o">;</span>
    <span class="n">classpathUtilidades</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">classpathProcesadorFichero</span><span class="o">;</span>
    <span class="n">classpathProcesadorFichero</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">vocales</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;A&quot;</span><span class="o">,</span> <span class="s">&quot;E&quot;</span><span class="o">,</span> <span class="s">&quot;I&quot;</span><span class="o">,</span> <span class="s">&quot;O&quot;</span><span class="o">,</span> <span class="s">&quot;U&quot;</span> <span class="o">};</span>
    <span class="n">String</span> <span class="n">classPath</span><span class="o">;</span>
    <span class="n">classPath</span> <span class="o">=</span> <span class="n">classpathProcesadorFichero</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">classpathUtilidades</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Usando classpath:&quot;</span> <span class="o">+</span> <span class="n">classPath</span><span class="o">);</span>
    <span class="cm">/* Se lanzan los procesos*/</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vocales</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fichErrores</span> <span class="o">=</span> <span class="s">&quot;Errores_&quot;</span> <span class="o">+</span> <span class="n">vocales</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span>
                             <span class="s">&quot;.txt&quot;</span><span class="o">;</span>
        <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="s">&quot;java&quot;</span><span class="o">,</span> <span class="s">&quot;-cp&quot;</span><span class="o">,</span> <span class="n">classPath</span><span class="o">,</span>
                                <span class="s">&quot;com.ies.ProcesadorFichero&quot;</span><span class="o">,</span> <span class="n">ficheroEntrada</span><span class="o">,</span>
                                <span class="n">vocales</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">vocales</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span><span class="o">);</span>
        <span class="c1">//Si hay algún error, almacenarlo en un fichero</span>
        <span class="n">pb</span><span class="o">.</span><span class="na">redirectError</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fichErrores</span><span class="o">));</span>
        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">//Fin del for</span>
    <span class="o">}</span>
    <span class="cm">/* Esperamos un poco*/</span>
    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
    <span class="cm">/* La recogida de resultados se deja como</span>
<span class="cm">    		 * ejercicio al lector. ;) */</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ejercicio-propuesto-i">
<h3>Ejercicio propuesto (I)<a class="headerlink" href="#ejercicio-propuesto-i" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se desea crear un programa que procese ficheros aprovechando el paralelismo de la máquina. Se tienen cinco ficheros con los siguientes nombres:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">informatica.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">gerencia.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">contabilidad.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">comercio.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">rrhh.txt</span></code></li>
</ul>
<p>En cada fichero hay una lista de cantidades enteras que representa las contabilidades de distintos departamentos. Hay una cantidad en cada línea. Se desea que el programa creado sume la cantidad total que suman todas las cantidades de los cinco ficheros haciendo uso del paralelismo.</p>
<div class="section" id="solucion-al-ejercicio-propuesto-i">
<h4>Solución al ejercicio propuesto (I)<a class="headerlink" href="#solucion-al-ejercicio-propuesto-i" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Este ejercicio es bastante parecido al anterior, con la salvedad de que ahora necesitaremos sumar cantidades en lugar de buscar elementos. Por lo demás,  también generaremos un fichero de resultados por cada fichero de datos y los llamaremos igual pero añadiendo la extensión &#8221;.res&#8221;. Es decir, la suma de las cantidades de <code class="docutils literal"><span class="pre">informatica.txt</span></code> se dejará en <code class="docutils literal"><span class="pre">informatica.txt.res</span></code>.</p>
<p>Una vez generados todos los fichero <code class="docutils literal"><span class="pre">Resultado</span></code> tendremos que sumar todas las cantidades de estos ficheros. Su estructura es muy simple, todos contienen una única línea con una cantidad. Dado que esta operación de sumar cantidades almacenadas en distintos ficheros es una operación muy habitual, añadiremos un método a <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code> que se encargue de hacer esta operación. Obsérvese que usaremos tipos de datos <code class="docutils literal"><span class="pre">long</span></code> y no <code class="docutils literal"><span class="pre">int</span></code> dado que no sabemos como de grandes serán las cantidades a procesar.</p>
<p>A continuación se muestra el código de este método.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">//Fin de getLineasFichero</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">getSuma</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span>
                           <span class="n">listaNombresFichero</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">suma</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">lineaCantidad</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">cantidad</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">nombreFichero</span> <span class="o">:</span> <span class="n">listaNombresFichero</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">//Recuperamos todas las lineas</span>
            <span class="n">lineas</span> <span class="o">=</span> <span class="n">getLineasFichero</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
            <span class="c1">//Pero solo nos interesa la primera</span>
            <span class="n">lineaCantidad</span> <span class="o">=</span> <span class="n">lineas</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="c1">//Convertimos la linea a número</span>
            <span class="n">cantidad</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">lineaCantidad</span><span class="o">);</span>
            <span class="c1">//Y se incrementa la suma total</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="n">suma</span> <span class="o">+</span> <span class="n">cantidad</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fallo al procesar el fichero &quot;</span>
                               <span class="o">+</span> <span class="n">nombreFichero</span><span class="o">);</span>
            <span class="c1">//Fin del catch</span>
        <span class="o">}</span>
        <span class="c1">//Fin del for que recorre los nombres de fichero</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Una vez creado este método que usaremos al final, pasemos a crear una clase <code class="docutils literal"><span class="pre">ProcesadorContabilidad</span></code> que leerá un fichero, sumará las cantidades y las dejará en el fichero de resultados. Esta clase solo tendrá un método <code class="docutils literal"><span class="pre">main</span></code> que realizará esta tarea.</p>
<p>Como nuestro programa está formado por varias clases que están dispersas por distintos directorios, nuestro <code class="docutils literal"><span class="pre">main</span></code> tomará el <code class="docutils literal"><span class="pre">CLASSPATH</span></code> de los argumentos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">nombreFichero</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">nombreFicheroResultado</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cantidades</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">//Extraemos las cantidades</span>
        <span class="n">cantidades</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getLineasFichero</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
        <span class="c1">//Y las sumamos una por una</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">lineaCantidad</span> <span class="o">:</span> <span class="n">cantidades</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">cantidad</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">lineaCantidad</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">cantidad</span><span class="o">;</span>
            <span class="c1">//Fin del for que recorre las cantidades</span>
        <span class="o">}</span>
        <span class="c1">//Almacenamos el total en un fichero</span>
        <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">;</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getPrintWriter</span><span class="o">(</span><span class="n">nombreFicheroResultado</span><span class="o">);</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span><span class="c1">//Fin del try</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;No se pudo procesar el fichero &quot;</span>
        <span class="o">+</span> <span class="n">nombreFichero</span><span class="o">);</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="c1">//Fin del main</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Por último, solo queda crear la clase <code class="docutils literal"><span class="pre">Lanzador</span></code> que recogerá los nombres de fichero que hay que sumar y lanzará un proceso de la clase <code class="docutils literal"><span class="pre">ProcesadorContabilidad</span></code> para cada uno de ellos. Por último, sumará todos los resultados y los dejará en un fichero que llamaremos (por ejemplo) <code class="docutils literal"><span class="pre">Resultado_global.txt</span></code></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">classpath</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">ficheros</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;informatica.txt&quot;</span><span class="o">,</span> <span class="s">&quot;gerencia.txt&quot;</span><span class="o">,</span> <span class="s">&quot;contabilidad.txt&quot;</span><span class="o">,</span> <span class="s">&quot;comercio.txt&quot;</span><span class="o">,</span> <span class="s">&quot;rrhh.txt&quot;</span> <span class="o">};</span>
    <span class="c1">//Los nombres de los ficheros de resultados</span>
    <span class="c1">//se generarán y luego se almacenarán aquí</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">ficherosResultado</span><span class="o">;</span>
    <span class="n">ficherosResultado</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">ficheros</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="cm">/* Lanzamos los procesos*/</span>
    <span class="n">ProcessBuilder</span><span class="o">[]</span> <span class="n">constructores</span><span class="o">;</span>
    <span class="n">constructores</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">[</span><span class="n">ficheros</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ficheros</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fichResultado</span><span class="o">,</span> <span class="n">fichErrores</span><span class="o">;</span>
        <span class="n">fichResultado</span> <span class="o">=</span> <span class="n">ficheros</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">SUFIJO_RESULTADO</span><span class="o">;</span>
        <span class="n">fichErrores</span> <span class="o">=</span> <span class="n">ficheros</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">SUFIJO_ERRORES</span><span class="o">;</span>
        <span class="n">ficherosResultado</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">fichResultado</span><span class="o">;</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">();</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">command</span><span class="o">(</span><span class="s">&quot;java&quot;</span><span class="o">,</span> <span class="s">&quot;-cp&quot;</span><span class="o">,</span> <span class="n">classpath</span><span class="o">,</span>
                                 <span class="s">&quot;com.ies.ProcesadorContabilidad&quot;</span><span class="o">,</span> <span class="n">ficheros</span><span class="o">[</span><span class="n">i</span><span class="o">],</span>
                                 <span class="n">fichResultado</span><span class="o">);</span>
        <span class="c1">//El fichero de errores se generará, aunque</span>
        <span class="c1">//puede que vacío</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">redirectError</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span>
                                           <span class="n">fichErrores</span><span class="o">));</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">//Fin del for que recorre los ficheros</span>
    <span class="o">}</span>
    <span class="c1">//Calculamos las sumas de cantidades</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getSuma</span><span class="o">(</span><span class="n">ficherosResultado</span><span class="o">);</span>
    <span class="c1">//Y las almacenamos</span>
    <span class="n">PrintWriter</span> <span class="n">pw</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getPrintWriter</span><span class="o">(</span><span class="n">RESULTADOS_GLOBALES</span><span class="o">);</span>
    <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
    <span class="n">pw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="c1">//Fin del main</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="gestion-de-procesos">
<h3>Gestión de procesos.<a class="headerlink" href="#gestion-de-procesos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La gestión de procesos se realiza de dos formas <strong>muy distintas</strong> en función de los dos grandes sistemas operativos: Windows y Linux.</p>
<ul class="simple">
<li>En Windows toda la gestión de procesos se realiza desde el &#8220;Administrador de tareas&#8221; al cual se accede con Ctrl+Alt+Supr. Existen otros programas más sofisticados que proporcionan algo más de información sobre los procesos, como Process Explorer (antes conocido con el nombre de ProcessViewer).</li>
</ul>
</div>
<div class="section" id="comandos-para-la-gestion-de-procesos-en-sistemas-libres-y-propietarios">
<h3>Comandos para la gestión de procesos en sistemas libres y propietarios.<a class="headerlink" href="#comandos-para-la-gestion-de-procesos-en-sistemas-libres-y-propietarios" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En sistemas Windows, no existen apenas comandos para gestionar procesos. Puede obligarse al sistema operativo a arrancar la aplicación asociada a un archivo con el comando <code class="docutils literal"><span class="pre">START</span></code>. Es decir, si se ejecuta lo siguiente:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">START</span> <span class="n">documento</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>se abrirá el visor de archivos PDF el cual cargará automáticamente el fichero <code class="docutils literal"><span class="pre">documento.pdf</span></code></p>
<p>En GNU/Linux se puede utilizar un terminal de consola para la gestión de procesos, lo que implica que no solo se pueden arrancar procesos si no tambien detenerlos, reanudarlos, terminarlos y modificar su prioridad de ejecución.</p>
<ul class="simple">
<li>Para arrancar un proceso, simplemente tenemos que escribir el nombre del comando correspondiente. Desde GNU/Linux se pueden controlar los servicios que se ejecutan con un comando llamado <code class="docutils literal"><span class="pre">service</span></code>. Por ejemplo, se puede usar <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">stop</span></code> para parar el servidor web y <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">start</span></code> para volver a ponerlo en marcha. También se puede reiniciar un servicio (tal vez para que relea un fichero de configuración que hemos cambiado) con <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">restart</span></code>.</li>
<li>Se puede detener y/o terminar un proceso con el comando <code class="docutils literal"><span class="pre">kill</span></code>. Se puede usar este comando para <strong>terminar un proceso</strong> sin guardar nada usando <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-SIGKILL</span> <span class="pre">&lt;numproceso&gt;</span></code> o <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-9</span> <span class="pre">&lt;numproceso&gt;</span></code>. Se puede pausar un proceso con <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-SIGSTOP</span> <span class="pre">&lt;numproceso&gt;</span></code> y rearrancarlo con <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-SIGCONT</span></code></li>
<li>Se puede enviar un proceso a segundo plano con comandos como <code class="docutils literal"><span class="pre">bg</span></code> o al arrancar el proceso escribir el nombre del comando terminado en <code class="docutils literal"><span class="pre">&amp;</span></code>.</li>
<li>Se puede devolver un proceso a primer plano con el comando <code class="docutils literal"><span class="pre">fg</span></code>.</li>
</ul>
<div class="section" id="prioridades">
<h4>Prioridades<a class="headerlink" href="#prioridades" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En sistemas como GNU/Linux se puede modificar la prioridad con que se ejecuta un proceso. Esto implica dos posibilidades</p>
<ul class="simple">
<li>Si pensamos que un programa que necesitamos ejecutar es muy importante podemos darle más prioridad para que reciba &#8220;más turnos&#8221; del planificador.</li>
<li>Y por el contrario, si pensamos que un programa no es muy necesario podemos quitarle prioridad y reservar &#8220;más turnos de planificador&#8221; para otros posibles procesos.</li>
</ul>
<p>El comando <code class="docutils literal"><span class="pre">nice</span></code> permite indicar prioridades entre -20 y 19. El -20 implica que un proceso reciba la <strong>máxima prioridad</strong>, y el 19 supone asignar la <strong>mínima prioridad</strong></p>
</div>
</div>
<div class="section" id="sincronizacion-entre-procesos">
<h3>Sincronización entre procesos.<a class="headerlink" href="#sincronizacion-entre-procesos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando se lanza más de un proceso de una misma sección de código no se sabe qué proceso ejecutará qué instrucción en un cierto momento, lo que es muy peligroso:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span><span class="n">j</span><span class="o">;</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">2</span><span class="o">){</span>
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
        <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
<span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Ok&quot;</span><span class="o">);</span>
<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">;</span>
<span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</pre></div>
</div>
<p>Si dos o más procesos avanzan por esta sección de código es perfectamente posible que unas veces nuestro programa multiproceso se ejecute bien y otras no.</p>
<p>En todo programa multiproceso pueden encontrarse estas zonas de código &#8220;peligrosas&#8221; que deben protegerse especialmente utilizando ciertos mecanismos. El nombre global para todos los lenguajes es denominar a estos trozos &#8220;secciones críticas&#8221;.</p>
<div class="section" id="mecanismos-para-controlar-secciones-criticas">
<h4>Mecanismos para controlar secciones críticas<a class="headerlink" href="#mecanismos-para-controlar-secciones-criticas" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Los mecanismos más típicos son los ofrecidos por UNIX/Windows:</p>
<ul class="simple">
<li>Semáforos.</li>
<li>Colas de mensajes.</li>
<li>Tuberías (pipes)</li>
<li>Bloques de memoria compartida.</li>
</ul>
<p>En realidad algunos de estos mecanismos se utilizan más para intercomunicar procesos, aunque para los programadores Java la forma de resolver el problema de la &#8220;sección crítica&#8221; es más simple.</p>
<p>En Java, si el programador piensa que un trozo de código es peligroso puede ponerle la palabra clave <code class="docutils literal"><span class="pre">synchronized</span></code> y la máquina virtual Java protege el código automáticamente.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span>    <span class="cm">/* La máquina virtual Java evitará que más de un proceso/hilo acceda a este método*/</span>
    <span class="kd">synchronized</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actualizarPension</span><span class="o">(</span><span class="kt">int</span> <span class="n">nuevoValor</span><span class="o">){</span>
            <span class="cm">/*..trozo de código largo omitido*/</span>
            <span class="k">this</span><span class="o">.</span><span class="na">pension</span><span class="o">=</span><span class="n">nuevoValor</span>
    <span class="o">}</span>


    <span class="cm">/* Otro ejemplo, ahora no hemos protegido un método entero,</span>
<span class="cm">sino solo un pequeño trozo de código.*/</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="cm">/* Código omitido*/</span>
            <span class="kd">synchronized</span> <span class="o">{</span>
                    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">;</span>
                    <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="documentacion">
<h3>Documentación<a class="headerlink" href="#documentacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para hacer la documentación tradicionalmente hemos usado JavaDOC. Sin embargo, las versiones más modernas de Java incluyen las <strong>anotaciones</strong>.</p>
<p>Una anotación es un texto que pueden utilizar otras herramientas (no solo el Javadoc) para comprender mejor qué hace ese código o como documentarlo.</p>
<p>Cualquiera puede crear sus propias anotaciones simplemente definiéndolas como un interfaz Java. Sin embargo tendremos que programar nuestras propias clases para extraer la información que proporcionan dichas anotaciones.</p>
</div>
<div class="section" id="depuracion">
<h3>Depuración.<a class="headerlink" href="#depuracion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>¿Como se depura un programa multiproceso/multihilo? Por desgracia puede ser muy difícil:</p>
<ol class="arabic simple">
<li>No todos los depuradores son capaces.</li>
<li>A veces cuando un depurador interviene en un proceso puede ocurrir que el resto de procesos consigan ejecutarse en el orden correcto y dar lugar a que el programa parezca que funciona bien.</li>
<li>Un error muy típico es la <code class="docutils literal"><span class="pre">NullPointerException</span></code>, que en muchos casos se deben a la utilización de referencias Java no inicializadas o incluso a la devolución de valores NULL que luego no se comprueban en alguna parte del código.</li>
<li>Se puede usar el método <code class="docutils literal"><span class="pre">redirectError</span></code> pasándole un objeto de tipo <code class="docutils literal"><span class="pre">File</span></code> para que los mensajes de error vayan a un fichero.</li>
<li>Se debe recordar que la &#8220;visión&#8221; que tiene Eclipse del sistema puede ser <strong>muy diferente</strong> de la visión que tiene el proceso lanzado. Un problema muy común es que el proceso lanzado no encuentre clases, lo que obligará a indicar el <code class="docutils literal"><span class="pre">CLASSPATH</span></code>.</li>
<li>Un buen método para determinar errores consiste en utilizar el entorno de consola para lanzar comandos para ver &#8220;como es el sistema&#8221; que ve un proceso fuera de Eclipse (o de cualquier otro entorno).</li>
</ol>
<p>En general todos los fallos en un programa multiproceso vienen derivado de no usar <code class="docutils literal"><span class="pre">synchronized</span></code> de la forma correcta.</p>
</div>
<div class="section" id="examen">
<h3>Examen<a class="headerlink" href="#examen" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Fecha por determinar</p>
</div>
</div>
<span id="document-textos/tema2"></span><div class="section" id="programacion-multihilo">
<h2>﻿Programación multihilo<a class="headerlink" href="#programacion-multihilo" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="recursos-compartidos-por-los-hilos">
<h3>Recursos compartidos por los hilos.<a class="headerlink" href="#recursos-compartidos-por-los-hilos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando creamos varios objetos de una clase, puede ocurrir que varios hilos de ejecución accedan a un objeto. Es importante recordar que <strong>todos los campos del objeto son compartidos entre todos los hilos</strong>.</p>
<p>Supongamos una clase como esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nf">Empleado</span><span class="o">(){</span>
        <span class="kt">int</span> <span class="n">numHorasTrabajadas</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="kt">int</span> <span class="nf">incrementarHoras</span><span class="o">(){</span>
                <span class="n">numHorasTrabajadas</span><span class="o">++;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Si varios hilos ejecutan sin querer el método <code class="docutils literal"><span class="pre">incrementar</span></code> en teoría debería ocurrir que el número se incrementase tantas veces como procesos. Sin embargo, <strong>es muy probable que eso no ocurra</strong></p>
</div>
<div class="section" id="estados-de-un-hilo-cambios-de-estado">
<h3>Estados de un hilo. Cambios de estado.<a class="headerlink" href="#estados-de-un-hilo-cambios-de-estado" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Aunque no lo vemos, un hilo cambia de estado: puede pasar de la nada a la ejecución. De la ejecución al estado &#8220;en espera&#8221;. De ahí puede volver a estar en ejecución. De cualquier estado se puede pasar al estado &#8220;finalizado&#8221;.</p>
<p>El programador no necesita controlar esto, lo hace el sistema operativo. Sin embargo un programa multihilo mal hecho puede dar lugar problemas como los siguientes:</p>
<ul class="simple">
<li>Interbloqueo. Se produce cuando las peticiones y las esperas se entrelazan de forma que ningún proceso puede avanzar.</li>
<li>Inanición. Ningún proceso consigue hacer ninguna tarea útil y por lo tanto hay que esperar a que el administrador del sistema detecte el interbloqueo y mate procesos (o hasta que alguien reinicie el equipo).</li>
</ul>
</div>
<div class="section" id="elementos-relacionados-con-la-programacion-de-hilos-librerias-y-clases">
<h3>Elementos relacionados con la programación de hilos. Librerías y clases.<a class="headerlink" href="#elementos-relacionados-con-la-programacion-de-hilos-librerias-y-clases" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para crear programas multihilo en Java se pueden hacer dos cosas:</p>
<ol class="arabic simple">
<li>Heredar de la clase Thread.</li>
<li>Implementar la interfaz Runnable.</li>
</ol>
<p>Los documentos de Java aconsejan el segundo. Lo único que hay que hacer es algo como esto.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">EjecutorTareaCompleja</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">nombre</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">numEjecucion</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">EjecutorTareaCompleja</span><span class="o">(</span><span class="n">String</span> <span class="n">nombre</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">nombre</span><span class="o">=</span><span class="n">nombre</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">cad</span><span class="o">;</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">numEjecucion</span><span class="o">&lt;</span><span class="mi">100</span><span class="o">){</span>
                        <span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mf">4999.99</span><span class="o">;</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mf">0.04</span><span class="o">)</span>
                        <span class="o">{</span>
                                <span class="n">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">cad</span><span class="o">=</span><span class="s">&quot;Soy el hilo &quot;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">nombre</span><span class="o">;</span>
                        <span class="n">cad</span><span class="o">+=</span><span class="s">&quot; y mi valor de i es &quot;</span><span class="o">+</span><span class="n">numEjecucion</span><span class="o">;</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cad</span><span class="o">);</span>
                        <span class="n">numEjecucion</span><span class="o">++;</span>
                <span class="o">}</span>
        <span class="o">}</span>

<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LanzaHilos</span> <span class="o">{</span>

        <span class="cm">/**</span>
<span class="cm">         * @param args</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">NUM_HILOS</span><span class="o">=</span><span class="mi">500</span><span class="o">;</span>
                <span class="n">EjecutorTareaCompleja</span> <span class="n">op</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_HILOS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                <span class="o">{</span>
                        <span class="n">op</span><span class="o">=</span><span class="k">new</span> <span class="n">EjecutorTareaCompleja</span> <span class="o">(</span><span class="s">&quot;Operacion &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">op</span><span class="o">);</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Este código tiene un problema <strong>muy grave</strong> y es que no se controla el acceso a variables compartidas, es decir <strong>HAY UNA SECCIÓN CRÍTICA QUE NO ESTÁ PROTEGIDA</strong> por lo que el resultado de la ejecución no muestra ningún sentido aunque el programa esté bien.</p>
</div>
</div>
<div class="section" id="gestion-de-hilos">
<h3>Gestión de hilos.<a class="headerlink" href="#gestion-de-hilos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Con los hilos se pueden efectuar diversas operaciones que sean de utilidad al programador (y al administrador de sistemas a veces).</p>
<p>Por ejemplo, un hilo puede tener un nombre. Si queremos asignar un nombre a un hilo podemos usar el método <code class="docutils literal"><span class="pre">setName(&quot;Nombre</span> <span class="pre">que</span> <span class="pre">sea&quot;)</span></code>. También podemos obtener un objeto que represente el hilo de ejecución con <code class="docutils literal"><span class="pre">currentThread</span></code> que nos devolverá un objeto de la clase <code class="docutils literal"><span class="pre">Thread</span></code>.</p>
<p>Otra operación de utilidad al gestionar hilos es indicar la prioridad que queremos darle a un hilo. En realidad esta prioridad es indicativa, el sistema operativo no está obligado a respetarla aunque por lo general lo hacen. Se puede indicar la prioridad con <code class="docutils literal"><span class="pre">setPriority(10)</span></code>. La máxima prioridad posible es <code class="docutils literal"><span class="pre">MAX_PRIORITY</span></code>, y la mínima es <code class="docutils literal"><span class="pre">MIN_PRIORITY</span></code>.</p>
<p>Cuando lanzamos una operación también podemos usar el método <code class="docutils literal"><span class="pre">Thread.sleep(numero)</span></code> y poner nuestro hilo &#8220;a dormir&#8221;.</p>
<p>Cuando se trabaja con prioridades en hilos <strong>no hay garantías de que un hilo termine cuando esperemos</strong>.</p>
<p>Podemos terminar un hilo de ejecución llamando al método <code class="docutils literal"><span class="pre">join</span></code>. Este método devuelve el control al hilo principal que lanzó el hilo secundario con la posibilidad de elegir un tiempo de espera en milisegundos.</p>
<p>El siguiente programa ilustra el uso de estos métodos:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Calculador</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">while</span><span class="o">(</span><span class="n">num</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Calculando...&quot;</span><span class="o">);</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="kt">long</span> <span class="n">tiempo</span><span class="o">=(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">10</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">tiempo</span><span class="o">&gt;</span><span class="mi">8000</span><span class="o">){</span>
                                        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
                                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                                        <span class="s">&quot;Terminando hilo:&quot;</span><span class="o">+</span>
                                                                        <span class="n">hilo</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
                                        <span class="o">);</span>
                                        <span class="n">hilo</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
                                <span class="o">}</span>
                                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">tiempo</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="c1">// TODO Auto-generated catch block</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Calculado y reiniciando.&quot;</span><span class="o">);</span>
                        <span class="n">num</span><span class="o">++;</span>
                <span class="o">}</span>
                <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">miNombre</span><span class="o">=</span><span class="n">hilo</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hilo terminado:&quot;</span><span class="o">+</span><span class="n">miNombre</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LanzadorHilos</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Calculador</span> <span class="n">vHilos</span><span class="o">[]=</span><span class="k">new</span> <span class="n">Calculador</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">vHilos</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">Calculador</span><span class="o">();</span>
                        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">vHilos</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Hilo &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="o">){</span>
                                <span class="n">hilo</span><span class="o">.</span><span class="na">setPriority</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">MAX_PRIORITY</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Ejercicio: crear un programa que lance 10 hilos de ejecución donde a cada hilo se le pasará la base y la altura de un triángulo, y cada hilo ejecutará el cálculo del área de dicho triángulo informando de qué base y qué altura recibió y cual es el área resultado.</p>
<p>Una posibilidad (quizá incorrecta) sería esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.ies</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">CalculadorAreas</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="kt">int</span> <span class="n">base</span><span class="o">,</span> <span class="n">altura</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">CalculadorAreas</span><span class="o">(</span><span class="kt">int</span> <span class="n">base</span><span class="o">,</span> <span class="kt">int</span> <span class="n">altura</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">base</span><span class="o">=</span><span class="n">base</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">altura</span><span class="o">=</span><span class="n">altura</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="kt">float</span> <span class="n">area</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">base</span><span class="o">*</span><span class="k">this</span><span class="o">.</span><span class="na">altura</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Base:&quot;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">base</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Altura:&quot;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">altura</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Area:&quot;</span><span class="o">+</span><span class="n">area</span><span class="o">);</span>
        <span class="o">}</span>

<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AreasEnParalelo</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Random</span> <span class="n">generador</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">numHilos</span><span class="o">=</span><span class="mi">10000</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">baseMaxima</span><span class="o">=</span><span class="mi">3</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">alturaMaxima</span><span class="o">=</span><span class="mi">5</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">numHilos</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="c1">//Sumamos 1 para evitar casos como base=0</span>
                        <span class="kt">int</span> <span class="n">base</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">baseMaxima</span><span class="o">);</span>
                        <span class="kt">int</span> <span class="n">altura</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">alturaMaxima</span><span class="o">);</span>
                        <span class="n">CalculadorAreas</span> <span class="n">ca</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">CalculadorAreas</span><span class="o">(</span><span class="n">base</span><span class="o">,</span> <span class="n">altura</span><span class="o">);</span>
                        <span class="n">Thread</span> <span class="n">hiloAsociado</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">ca</span><span class="o">);</span>
                        <span class="n">hiloAsociado</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Las secciones siguientes sirven como resumen de como crear una aplicación multihilo</p>
</div>
<div class="section" id="creacion-inicio-y-finalizacion">
<h3>Creación, inicio y finalización.<a class="headerlink" href="#creacion-inicio-y-finalizacion" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li>Podemos heredar de Thread o implementar <code class="docutils literal"><span class="pre">Runnable</span></code>. Usaremos el segundo recordando implementar el método <code class="docutils literal"><span class="pre">public</span> <span class="pre">void</span> <span class="pre">run()</span></code>.</li>
<li>Para crear un hilo asociado a un objeto usaremos algo como:</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">objetoDeClase</span><span class="o">)</span>
</pre></div>
</div>
<p>Lo más habitual es guardar en un vector todos los hilos que hagan algo, y no en un objeto suelto.</p>
<ul class="simple">
<li>Cada objeto que tenga un hilo asociado debe iniciarse así:</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</pre></div>
</div>
<ul class="simple">
<li>Todo programa multihilo tiene un &#8220;hilo principal&#8221;, el cual deberá esperar a que terminen los hilos asociados ejecutando el método <code class="docutils literal"><span class="pre">join()</span></code>  .</li>
</ul>
</div>
<div class="section" id="sincronizacion-de-hilos">
<h3>Sincronización de hilos.<a class="headerlink" href="#sincronizacion-de-hilos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando un método acceda a una variable miembro que esté compartida deberemos proteger dicha sección crítica, usando <code class="docutils literal"><span class="pre">synchronized</span></code>. Se puede poner todo el método <code class="docutils literal"><span class="pre">synchronized</span></code> o marcar un trozo de código más pequeño.</p>
</div>
<div class="section" id="informacion-entre-hilos">
<h3>Información entre hilos.<a class="headerlink" href="#informacion-entre-hilos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Todos los hilos comparten todo, así que obtener información es tan sencillo como consultar un miembro.
En realidad podemos comunicar los hilos con otro mecanismo llamado <code class="docutils literal"><span class="pre">sockets</span> <span class="pre">de</span> <span class="pre">red</span></code>, pero se ve en el tema siguiente.</p>
</div>
<div class="section" id="prioridades-de-los-hilos">
<h3>Prioridades de los hilos.<a class="headerlink" href="#prioridades-de-los-hilos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Podemos asignar distintas prioridades a los hilos usando los campos estáticos <code class="docutils literal"><span class="pre">MAX_PRIORITY</span></code> y <code class="docutils literal"><span class="pre">MIN_PRIORITY</span></code>. Usando valores entre estas dos constantes podemos hacer que un hilo reciba más procesador que otro (se hace en contadas ocasiones).</p>
<p>Para ello se usa el método <code class="docutils literal"><span class="pre">setPriority(valor)</span></code></p>
</div>
<div class="section" id="gestion-de-prioridades">
<h3>Gestión de prioridades.<a class="headerlink" href="#gestion-de-prioridades" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En realidad un sistema operativo no está obligado a respetar las prioridades, sino que se lo tomará como &#8220;recomendaciones&#8221;. En general hasta ahora todos respetan hasta cierto punto las prioridades que pone el programador pero no debe tomarse como algo absoluto.</p>
</div>
<div class="section" id="programacion-de-aplicaciones-multihilo">
<h3>Programación de aplicaciones multihilo.<a class="headerlink" href="#programacion-de-aplicaciones-multihilo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La estructura típica de un programa multihilo es esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">TareaCompleja</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">Thread</span> <span class="n">hiloActual</span><span class="o">=</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">miNombre</span><span class="o">=</span><span class="n">hiloActual</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;Finalizado el hilo&quot;</span><span class="o">+</span><span class="n">miNombre</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LanzadorHilos</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">NUM_HILOS</span><span class="o">=</span><span class="mi">100</span><span class="o">;</span>
                <span class="n">Thread</span><span class="o">[]</span> <span class="n">hilosAsociados</span><span class="o">;</span>

                <span class="n">hilosAsociados</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">NUM_HILOS</span><span class="o">];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_HILOS</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">TareaCompleja</span> <span class="n">t</span><span class="o">=</span><span class="k">new</span> <span class="n">TareaCompleja</span><span class="o">();</span>
                        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Hilo: &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                        <span class="n">hilosAsociados</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">hilo</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="cm">/* Despues de crear todo, nos aseguramos</span>
<span class="cm">                 * de esperar que todos los hilos acaben. */</span>

                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_HILOS</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="n">hilosAsociados</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="c1">//Espera a que el hilo acabe</span>
                                <span class="n">hilo</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Algun hilo acabó &quot;</span><span class="o">);</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; antes de tiempo!&quot;</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">}</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;El principal ha terminado&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Supongamos que la tarea es más compleja y que el bucle se ejecuta un número al azar de veces. Esto significaría que nuestro bucle es algo como esto:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Random</span> <span class="n">generador</span><span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">numAzar</span><span class="o">=(</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5</span><span class="o">))*</span><span class="mi">100</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">numAzar</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
        <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>¿Como podríamos modificar el programa para que podamos saber cuantas multiplicaciones se han hecho en total entre todos los hilos?</p>
<p>Aquí entra el problema de la sincronización. Supongamos una clase contador muy simple como esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Contador</span><span class="o">{</span>
        <span class="kt">int</span> <span class="n">cuenta</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Contador</span><span class="o">(){</span>
                <span class="n">cuenta</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">incrementar</span><span class="o">(){</span>
                <span class="n">cuenta</span><span class="o">=</span><span class="n">cuenta</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCuenta</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">cuenta</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>De esta forma podríamos construir un objeto contador y pasárselo a todos los hilos para que en ese único objeto se almacene el recuento final. El problema es que en la programación multihilo <strong>SI EL OBJETO CONTADOR SE COMPARTE ENTRE VARIOS HILOS LA CUENTA FINAL RESULTANTE ES MUY POSIBLE QUE ESTÉ MAL</strong></p>
<p>Esta clase debería tener protegidas sus secciones críticas</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Contador</span><span class="o">{</span>
        <span class="kt">int</span> <span class="n">cuenta</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Contador</span><span class="o">(){</span>
                <span class="n">cuenta</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">incrementar</span><span class="o">(){</span>
                <span class="n">cuenta</span><span class="o">=</span><span class="n">cuenta</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">int</span> <span class="nf">getCuenta</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">cuenta</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Se puede aprovechar todavía más rendimiento si en un método marcamos como sección crítica (o sincronizada) exclusivamente el código peligroso:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span>  <span class="kt">void</span> <span class="nf">incrementar</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Otras cosas&quot;</span><span class="o">);</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">){</span>
                <span class="n">cuenta</span><span class="o">=</span><span class="n">cuenta</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Mas cosas...&quot;</span><span class="o">);</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">cuenta</span><span class="o">&gt;</span><span class="mi">300</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Este hilo trabaja mucho&quot;</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="problema">
<h3>Problema<a class="headerlink" href="#problema" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En una mesa hay procesos que simulan el comportamiento de unos filósofos que intentan comer de un plato. Cada filósofo tiene un cubierto a su izquierda y uno a su derecha y para poder comer tiene que conseguir los dos. Si lo consigue, mostrará un mensaje en pantalla que indique &#8220;Filosofo 2 comiendo&#8221;.</p>
<p>Despues de comer, soltará los cubiertos y esperará al azar un tiempo entre 1000 y 5000 milisegundos, indicando por pantalla &#8220;El filósofo 2 está pensando&#8221;.</p>
<p>En general todos los objetos de la clase Filósofo está en un bucle infinito dedicándose a comer y a pensar.</p>
<p>Simular este problema en un programa Java que muestre el progreso de todos sin caer en problemas de sincronización ni de inanición.</p>
<div class="figure align-center" id="id2" style="width: 50%">
<img alt="_images/Filosofos.png" src="_images/Filosofos.png" />
<p class="caption"><span class="caption-text">Esquema de los filósofos</span></p>
</div>
<div class="section" id="boceto-de-solucion">
<h4>Boceto de solución<a class="headerlink" href="#boceto-de-solucion" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Filosofo</span>  <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="n">String</span> <span class="n">miNombre</span><span class="o">=</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
                <span class="n">Random</span> <span class="n">generador</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="cm">/* Comer*/</span>
                        <span class="cm">/* Intentar coger palillos*/</span>
                        <span class="cm">/* Si los coge:*/</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">miNombre</span><span class="o">+</span><span class="s">&quot; comiendo...&quot;</span><span class="o">);</span>
                        <span class="kt">int</span> <span class="n">milisegs</span><span class="o">=(</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5</span><span class="o">))*</span><span class="mi">1000</span><span class="o">;</span>
                        <span class="n">esperarTiempoAzar</span><span class="o">(</span><span class="n">miNombre</span><span class="o">,</span> <span class="n">milisegs</span><span class="o">);</span>
                        <span class="cm">/* Pensando...*/</span>
                        <span class="c1">//Recordemos soltar los palillos</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">miNombre</span><span class="o">+</span><span class="s">&quot;  pensando...&quot;</span><span class="o">);</span>                           <span class="n">milisegs</span><span class="o">=(</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5</span><span class="o">))*</span><span class="mi">1000</span><span class="o">;</span>
                        <span class="n">esperarTiempoAzar</span><span class="o">(</span><span class="n">miNombre</span><span class="o">,</span> <span class="n">milisegs</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">esperarTiempoAzar</span><span class="o">(</span><span class="n">String</span> <span class="n">miNombre</span><span class="o">,</span> <span class="kt">int</span> <span class="n">milisegs</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">milisegs</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="n">miNombre</span><span class="o">+</span><span class="s">&quot; interrumpido!!. Saliendo...&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="solucion-completa-al-problema-de-los-filosofos">
<h3>Solución completa al problema de los filósofos<a class="headerlink" href="#solucion-completa-al-problema-de-los-filosofos" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="gestor-de-recursos-compartidos-palillos">
<h4>Gestor de recursos compartidos (palillos)<a class="headerlink" href="#gestor-de-recursos-compartidos-palillos" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GestorPalillos</span> <span class="o">{</span>
        <span class="cm">/* False significa que no están cogidos*/</span>
        <span class="kd">private</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">palillos</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">GestorPalillos</span><span class="o">(</span><span class="kt">int</span> <span class="n">num_filosofos</span><span class="o">){</span>
                <span class="n">palillos</span><span class="o">=</span><span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="n">num_filosofos</span><span class="o">];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">palillos</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">palillos</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">boolean</span>
                <span class="nf">sePuedenCogerAmbosPalillos</span><span class="o">(</span>
                        <span class="kt">int</span> <span class="n">num1</span><span class="o">,</span><span class="kt">int</span> <span class="n">num2</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span> <span class="o">(</span><span class="n">palillos</span><span class="o">[</span><span class="n">num1</span><span class="o">]==</span><span class="kc">false</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                        <span class="o">(</span><span class="n">palillos</span><span class="o">[</span><span class="n">num2</span><span class="o">]==</span><span class="kc">false</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
                        <span class="n">palillos</span><span class="o">[</span><span class="n">num1</span><span class="o">]=</span><span class="kc">true</span><span class="o">;</span>
                        <span class="n">palillos</span><span class="o">[</span><span class="n">num2</span><span class="o">]=</span><span class="kc">true</span><span class="o">;</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;Alguien consiguio los palillos &quot;</span>
                                <span class="o">+</span><span class="n">num1</span><span class="o">+</span><span class="s">&quot; y &quot;</span><span class="o">+</span><span class="n">num2</span><span class="o">);</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">soltarPalillos</span><span class="o">(</span><span class="kt">int</span> <span class="n">num1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num2</span><span class="o">){</span>
                <span class="n">palillos</span><span class="o">[</span><span class="n">num1</span><span class="o">]=</span><span class="kc">false</span><span class="o">;</span>
                <span class="n">palillos</span><span class="o">[</span><span class="n">num2</span><span class="o">]=</span><span class="kc">false</span><span class="o">;</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                        <span class="s">&quot;Alguien liberó los palillos &quot;</span><span class="o">+</span>
                        <span class="n">num1</span><span class="o">+</span><span class="s">&quot; y &quot;</span><span class="o">+</span><span class="n">num2</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="simulacion-de-un-filosofo">
<h4>Simulación de un filósofo<a class="headerlink" href="#simulacion-de-un-filosofo" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Filosofo</span>  <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="kt">int</span> <span class="n">num_palillo_izq</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">num_palillo_der</span><span class="o">;</span>
        <span class="n">GestorPalillos</span> <span class="n">gestorPalillos</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Filosofo</span><span class="o">(</span><span class="n">GestorPalillos</span> <span class="n">gp</span><span class="o">,</span>
                        <span class="kt">int</span> <span class="n">p_izq</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p_der</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">gestorPalillos</span><span class="o">=</span><span class="n">gp</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">num_palillo_der</span><span class="o">=</span><span class="n">p_der</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">num_palillo_izq</span><span class="o">=</span><span class="n">p_izq</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="n">String</span> <span class="n">miNombre</span><span class="o">=</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
                <span class="n">Random</span> <span class="n">generador</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="cm">/* Comer*/</span>
                        <span class="cm">/* Intentar coger palillos*/</span>
                        <span class="k">while</span><span class="o">(!</span><span class="n">gestorPalillos</span><span class="o">.</span><span class="na">sePuedenCogerAmbosPalillos</span>
                                <span class="o">(</span>
                                                <span class="n">num_palillo_izq</span><span class="o">,</span>
                                                <span class="n">num_palillo_der</span>
                                <span class="o">))</span>
                        <span class="o">{</span>

                        <span class="o">}</span>
                        <span class="cm">/* Si los coge:*/</span>

                        <span class="kt">int</span> <span class="n">milisegs</span><span class="o">=(</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5</span><span class="o">))*</span><span class="mi">1000</span><span class="o">;</span>
                        <span class="n">esperarTiempoAzar</span><span class="o">(</span><span class="n">miNombre</span><span class="o">,</span> <span class="n">milisegs</span><span class="o">);</span>
                        <span class="cm">/* Pensando...*/</span>
                        <span class="c1">//Recordemos soltar los palillos</span>
                        <span class="n">gestorPalillos</span><span class="o">.</span><span class="na">soltarPalillos</span><span class="o">(</span>
                                <span class="n">num_palillo_izq</span><span class="o">,</span>
                                <span class="n">num_palillo_der</span><span class="o">);</span>

                        <span class="n">milisegs</span><span class="o">=(</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5</span><span class="o">))*</span><span class="mi">1000</span><span class="o">;</span>
                        <span class="n">esperarTiempoAzar</span><span class="o">(</span><span class="n">miNombre</span><span class="o">,</span> <span class="n">milisegs</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">esperarTiempoAzar</span><span class="o">(</span><span class="n">String</span> <span class="n">miNombre</span><span class="o">,</span> <span class="kt">int</span> <span class="n">milisegs</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">milisegs</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="n">miNombre</span><span class="o">+</span>
                                <span class="s">&quot; interrumpido!!. Saliendo...&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="lanzador-de-hilos">
<h4>Lanzador de hilos<a class="headerlink" href="#lanzador-de-hilos" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LanzadorFilosofos</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">MAX_FILOSOFOS</span><span class="o">=</span><span class="mi">5</span><span class="o">;</span>
                <span class="n">Filosofo</span><span class="o">[]</span> <span class="n">filosofos</span><span class="o">=</span><span class="k">new</span> <span class="n">Filosofo</span><span class="o">[</span><span class="n">MAX_FILOSOFOS</span><span class="o">];</span>
                <span class="n">Thread</span><span class="o">[]</span> <span class="n">hilosAsociados</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">MAX_FILOSOFOS</span><span class="o">];</span>
                <span class="n">GestorPalillos</span> <span class="n">gestorCompartido</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">GestorPalillos</span><span class="o">(</span><span class="n">MAX_FILOSOFOS</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAX_FILOSOFOS</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="o">){</span>
                                <span class="n">filosofos</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span>
                                <span class="k">new</span> <span class="n">Filosofo</span><span class="o">(</span>
                                                <span class="n">gestorCompartido</span><span class="o">,</span>
                                                <span class="n">i</span><span class="o">,</span><span class="n">MAX_FILOSOFOS</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="k">else</span> <span class="o">{</span>
                                <span class="n">filosofos</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">Filosofo</span><span class="o">(</span>
                                                <span class="n">gestorCompartido</span><span class="o">,</span> <span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">filosofos</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Filosofo &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">hilosAsociados</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">hilo</span><span class="o">;</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="cm">/* Un poco inútil*/</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAX_FILOSOFOS</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="n">hilosAsociados</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">join</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="c1">// TODO Auto-generated catch block</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Problema<a class="headerlink" href="#id1" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En una peluquería hay barberos y sillas para los clientes (siempre hay más sillas que clientes). Sin embargo, en esta peluquería no siempre hay trabajo por lo que los barberos duermen cuando no hay clientes a los que afeitar. Un cliente puede llegar a la barbería y encontrar alguna silla libre, en cuyo caso, el cliente se sienta y esperará que algún barbero le afeite. Puede ocurrir que el cliente llegue y no haya sillas libres, en cuyo caso se marcha. Simular el comportamiento de la barbería mediante un programa Java.</p>
<div class="figure align-center" id="id3" style="width: 50%">
<img alt="_images/barberodormilon.png" src="_images/barberodormilon.png" />
<p class="caption"><span class="caption-text">Los  barberos dormilones</span></p>
</div>
</div>
<div class="section" id="una-mala-solucion-al-problema-de-los-barberos">
<h3>Una (mala) solución al problema de los barberos<a class="headerlink" href="#una-mala-solucion-al-problema-de-los-barberos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Prueba la siguiente solución:</p>
<div class="section" id="clase-barbero">
<h4>Clase Barbero<a class="headerlink" href="#clase-barbero" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Barbero</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">String</span>                          <span class="n">nombre</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">GestorConcurrencia</span>      <span class="n">gc</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Random</span>                          <span class="n">generador</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span>                                     <span class="n">MAX_ESPERA_SEGS</span><span class="o">=</span><span class="mi">5</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Barbero</span><span class="o">(</span><span class="n">GestorConcurrencia</span> <span class="n">gc</span><span class="o">,</span><span class="n">String</span> <span class="n">nombre</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">nombre</span>             <span class="o">=</span><span class="n">nombre</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">gc</span>                 <span class="o">=</span><span class="n">gc</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">generador</span>  <span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">esperarTiempoAzar</span><span class="o">(</span><span class="kt">int</span> <span class="n">max</span><span class="o">){</span>
                <span class="cm">/* Se calculan unos milisegundos al azar*/</span>
                <span class="kt">int</span> <span class="n">msgs</span><span class="o">=(</span><span class="mi">1</span><span class="o">+</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">max</span><span class="o">))*</span><span class="mi">1000</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">sleep</span><span class="o">(</span><span class="n">msgs</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="kt">int</span> <span class="n">num_silla</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="na">atenderAlgunCliente</span><span class="o">();</span>
                        <span class="k">while</span> <span class="o">(</span><span class="n">num_silla</span><span class="o">==-</span><span class="mi">1</span><span class="o">){</span>
                                <span class="cm">/* Mientras no haya nadie a quien</span>
<span class="cm">                                 * atender, dormimos</span>
<span class="cm">                                 */</span>
                                <span class="n">esperarTiempoAzar</span><span class="o">(</span><span class="n">MAX_ESPERA_SEGS</span><span class="o">);</span>
                                <span class="n">num_silla</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="na">atenderAlgunCliente</span><span class="o">();</span>
                        <span class="o">}</span>
                        <span class="cm">/* Si llegamos aqui es que había algún cliente</span>
<span class="cm">                         * Simulamos un tiempo de afeitado</span>
<span class="cm">                         */</span>
                        <span class="n">esperarTiempoAzar</span><span class="o">(</span><span class="n">MAX_ESPERA_SEGS</span><span class="o">);</span>
                        <span class="cm">/* Tras ese tiempo de afeitado se</span>
<span class="cm">                         * libera la silla</span>
<span class="cm">                         */</span>
                        <span class="n">gc</span><span class="o">.</span><span class="na">liberarSilla</span><span class="o">(</span><span class="n">num_silla</span><span class="o">);</span>
                        <span class="cm">/* Y vuelta a empezar*/</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-cliente">
<h4>Clase Cliente<a class="headerlink" href="#clase-cliente" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cliente</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="n">GestorConcurrencia</span>      <span class="n">gc</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Cliente</span><span class="o">(</span><span class="n">GestorConcurrencia</span> <span class="n">gc</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">gc</span>         <span class="o">=</span><span class="n">gc</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="cm">/* Los clientes no esperan que haya</span>
<span class="cm">                 * sillas libres, no hay bucle infinito.</span>
<span class="cm">                 * Si no hay sillas libres se van...</span>
<span class="cm">                 */</span>
                <span class="n">gc</span><span class="o">.</span><span class="na">getSillaLibre</span><span class="o">();</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-gestorconcurrencia">
<h4>Clase GestorConcurrencia<a class="headerlink" href="#clase-gestorconcurrencia" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GestorConcurrencia</span> <span class="o">{</span>
        <span class="cm">/* Vector que indica cuantas sillas hay y</span>
<span class="cm">         * si están libres o no</span>
<span class="cm">         */</span>
        <span class="kt">boolean</span><span class="o">[]</span> <span class="n">sillasLibres</span><span class="o">;</span>
        <span class="cm">/* Indica si el cliente sentado en esa</span>
<span class="cm">         * silla está atendido por un barbero o no</span>
<span class="cm">         */</span>
        <span class="kt">boolean</span><span class="o">[]</span> <span class="n">clienteEstaAtendido</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">GestorConcurrencia</span><span class="o">(</span><span class="kt">int</span> <span class="n">numSillas</span><span class="o">){</span>
                <span class="cm">/*Construimos los vectores...*/</span>
                <span class="n">sillasLibres</span>            <span class="o">=</span><span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="n">numSillas</span><span class="o">];</span>
                <span class="n">clienteEstaAtendido</span>     <span class="o">=</span><span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="n">numSillas</span><span class="o">];</span>
                <span class="cm">/* ... los inicializamos*/</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">numSillas</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">sillasLibres</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>                 <span class="o">=</span><span class="kc">true</span><span class="o">;</span>
                        <span class="n">clienteEstaAtendido</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>  <span class="o">=</span><span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="cm">/**</span>
<span class="cm">         * Permite obtener una silla libre, usado por la</span>
<span class="cm">         * clase Cliente para saber si puede sentarse</span>
<span class="cm">         * en algún sitio o irse</span>
<span class="cm">         * @return Devuelve el número de la primera silla</span>
<span class="cm">         * que está libre o -1 si no hay ninguna</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">int</span> <span class="nf">getSillaLibre</span><span class="o">(){</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">sillasLibres</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="cm">/* Si está libre la silla ...*/</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">sillasLibres</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">{</span>
                                <span class="cm">/* ...se marca como ocupada*/</span>
                                <span class="n">sillasLibres</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="kc">false</span><span class="o">;</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;Cliente sentado en silla &quot;</span><span class="o">+</span><span class="n">i</span>
                                                <span class="o">);</span>
                                <span class="cm">/*.. y devolvemos i...*/</span>
                                <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
                <span class="cm">/* Si llegamos aquí es que no había nada libre*/</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="cm">/**</span>
<span class="cm">         * Nos dice qué silla tiene algun cliente</span>
<span class="cm">         * que no está atendido</span>
<span class="cm">         * @return un número de silla o -1 si no</span>
<span class="cm">         * hay clientes sin atender</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">int</span> <span class="nf">atenderAlgunCliente</span><span class="o">(){</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">sillasLibres</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="cm">/* Si una silla está ocupada (no libre, false)</span>
<span class="cm">                         * y está marcado como &quot;sin atender&quot; (false)</span>
<span class="cm">                         * entonces la marcamos como atendida</span>
<span class="cm">                         */</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">clienteEstaAtendido</span><span class="o">[</span><span class="n">i</span><span class="o">]==</span><span class="kc">false</span><span class="o">){</span>
                                <span class="n">clienteEstaAtendido</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="kc">true</span><span class="o">;</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                                <span class="s">&quot;Afeitando cliente en silla &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
                                <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="cm">/* El cliente de esa silla, se marcha, por lo</span>
<span class="cm">         * que se marca esa silla como &quot;libre&quot;</span>
<span class="cm">         * y como &quot;sin atender&quot;</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">liberarSilla</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">){</span>
                <span class="n">sillasLibres</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>                 <span class="o">=</span><span class="kc">true</span><span class="o">;</span>
                <span class="n">clienteEstaAtendido</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>  <span class="o">=</span><span class="kc">false</span><span class="o">;</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;Se marcha el cliente de la silla &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-lanzador">
<h4>Clase Lanzador<a class="headerlink" href="#clase-lanzador" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lanzador</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

                <span class="kt">int</span> <span class="n">MAX_BARBEROS</span>        <span class="o">=</span><span class="mi">2</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">MAX_SILLAS</span>          <span class="o">=</span><span class="n">MAX_BARBEROS</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">MAX_CLIENTES</span>        <span class="o">=</span><span class="n">MAX_BARBEROS</span><span class="o">*</span><span class="mi">10</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">MAX_ESPERA_SEGS</span>     <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
                <span class="n">GestorConcurrencia</span> <span class="n">gc</span><span class="o">;</span>
                <span class="n">gc</span><span class="o">=</span><span class="k">new</span> <span class="n">GestorConcurrencia</span><span class="o">(</span><span class="n">MAX_SILLAS</span><span class="o">);</span>

                <span class="n">Thread</span><span class="o">[]</span> <span class="n">vhBarberos</span>     <span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">MAX_BARBEROS</span><span class="o">];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAX_BARBEROS</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">Barbero</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="n">Barbero</span><span class="o">(</span><span class="n">gc</span><span class="o">,</span> <span class="s">&quot;Barbero &quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
                        <span class="n">vhBarberos</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">hilo</span><span class="o">;</span>
                        <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="cm">/* Generamos unos cuantos clientes</span>
<span class="cm">                 * a intervalos aleatorios</span>
<span class="cm">                 */</span>
                <span class="n">Random</span> <span class="n">generador</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAX_CLIENTES</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Cliente</span> <span class="n">c</span>                       <span class="o">=</span><span class="k">new</span> <span class="n">Cliente</span><span class="o">(</span><span class="n">gc</span><span class="o">);</span>
                        <span class="n">Thread</span> <span class="n">hiloCliente</span>      <span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
                        <span class="n">hiloCliente</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

                        <span class="kt">int</span> <span class="n">msegs</span><span class="o">=</span><span class="n">generador</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">3</span><span class="o">)*</span><span class="mi">1000</span><span class="o">;</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">msegs</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="c1">// TODO Auto-generated catch block</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>
                <span class="o">}</span> <span class="cm">/* Fin del for*/</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="criticas-a-la-solucion-anterior">
<h4>Críticas a la solución anterior<a class="headerlink" href="#criticas-a-la-solucion-anterior" title="Enlazar permanentemente con este título">¶</a></h4>
<p>¿Cual es el problema?</p>
<p>El problema está en que la forma que tiene el gestor de concurrencia de decirle a un barbero qué silla tiene un cliente sin afeitar es incorrecta: como siempre se empieza a buscar por el principio del vector, los clientes sentados al final <strong>nunca son atendidos</strong>. Hay que corregir esa asignación para <em>evitar que los procesos sufrán de inanición</em>.</p>
</div>
<div class="section" id="metodo-corregido">
<h4>Método corregido<a class="headerlink" href="#metodo-corregido" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">int</span> <span class="nf">atenderAlgunCliente</span><span class="o">(){</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">pasos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                        <span class="n">pasos</span><span class="o">&lt;</span><span class="n">clienteEstaAtendido</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
                        <span class="n">pasos</span><span class="o">++)</span>
        <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span>
                                <span class="n">clienteEstaAtendido</span>
                                <span class="o">[</span><span class="n">numUltimaSillaExaminada</span><span class="o">]</span>
                                                <span class="o">==</span> <span class="kc">false</span>
                                                <span class="o">)</span>
                <span class="o">{</span>
                        <span class="cm">/*Atendemos a ese cliente*/</span>
                        <span class="n">clienteEstaAtendido</span>
                                <span class="o">[</span><span class="n">numUltimaSillaExaminada</span><span class="o">]=</span><span class="kc">true</span><span class="o">;</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;Afeitando cliente en silla &quot;</span><span class="o">+</span>
                                                        <span class="n">numUltimaSillaExaminada</span><span class="o">);</span>
                        <span class="k">return</span> <span class="n">numUltimaSillaExaminada</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="n">numUltimaSillaExaminada</span><span class="o">=</span>
                                        <span class="o">(</span><span class="n">numUltimaSillaExaminada</span><span class="o">+</span><span class="mi">1</span><span class="o">)%</span>
                                        <span class="n">clienteEstaAtendido</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
                <span class="o">}</span> <span class="c1">//Fin del else</span>
        <span class="o">}</span> <span class="c1">//Fin del for</span>
        <span class="cm">/* Si llegamos aquí hemos dado toda</span>
<span class="cm">         * una vuelta al vector y no había nadie sin</span>
<span class="cm">         * atender devolver -1</span>
<span class="cm">         */</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="o">}</span> <span class="c1">//Fin del método</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="problema-productores-y-consumidores">
<h3>Problema: productores y consumidores.<a class="headerlink" href="#problema-productores-y-consumidores" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En un cierto programa se tienen procesos que producen números y procesos que leen esos números. Todos los números se introducen en una cola (o vector) limitada.</p>
<p>Todo el mundo lee y escribe de/en esa cola. Cuando un productor quiere poner un número tendrá que comprobar si la cola está llena. Si está llena, espera un tiempo al azar. Si no está llena pone su número en la última posición libre.</p>
<p>Cuando un lector quiere leer, examina si la cola está vacía. Si lo está espera un tiempo al azar, y sino coge el número que haya al principio de la cola y ese número <em>ya no está disponible para el siguiente</em>.</p>
<p>Crear un programa que simule el comportamiento de estos procesos evitando problemas de entrelazado e inanición.</p>
</div>
<div class="section" id="solucion">
<h3>Solución<a class="headerlink" href="#solucion" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="una-cola-limitada-en-tamano">
<h4>Una cola limitada en tamaño<a class="headerlink" href="#una-cola-limitada-en-tamano" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ColaLimitada</span> <span class="o">{</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">cola</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">posParaEncolar</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">ColaLimitada</span><span class="o">(</span><span class="kt">int</span> <span class="n">numElementos</span><span class="o">){</span>
                <span class="n">cola</span><span class="o">=</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">numElementos</span><span class="o">];</span>
                <span class="n">posParaEncolar</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ponerEnCola</span><span class="o">(</span><span class="kt">int</span> <span class="n">numero</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">posParaEncolar</span><span class="o">==</span><span class="n">cola</span><span class="o">.</span><span class="na">length</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;Cola llena, debe Vd. esperar&quot;</span><span class="o">);</span>
                        <span class="c1">//Cola llena.</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">//Aún queda sitio</span>
                <span class="n">cola</span><span class="o">[</span><span class="n">posParaEncolar</span><span class="o">]=</span><span class="n">numero</span><span class="o">;</span>
                <span class="n">posParaEncolar</span><span class="o">++;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sacarPrimero</span><span class="o">(){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">posParaEncolar</span><span class="o">==</span><span class="mi">0</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;Warning:cola vacía, devolviendo 0&quot;</span>
                        <span class="o">);</span>
                        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kt">int</span> <span class="n">elementoInicial</span><span class="o">=</span><span class="n">cola</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
                <span class="cm">/*Movemos los elementos hacia delante*/</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span> <span class="n">pos</span><span class="o">&lt;</span><span class="n">cola</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">pos</span><span class="o">++){</span>
                        <span class="n">cola</span><span class="o">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="o">]=</span><span class="n">cola</span><span class="o">[</span><span class="n">pos</span><span class="o">];</span>
                <span class="o">}</span>
                <span class="cm">/* Ahora la posParaEncolar ha disminuido*/</span>
                <span class="n">posParaEncolar</span><span class="o">--;</span>
                <span class="k">return</span> <span class="n">elementoInicial</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span>
                <span class="n">String</span> <span class="n">cadenaCola</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">pos</span><span class="o">&lt;</span><span class="n">posParaEncolar</span><span class="o">;</span> <span class="n">pos</span><span class="o">++){</span>
                        <span class="n">cadenaCola</span><span class="o">+=</span><span class="n">cola</span><span class="o">[</span><span class="n">pos</span><span class="o">]+</span><span class="s">&quot;-&quot;</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">cadenaCola</span><span class="o">+=</span><span class="s">&quot;FIN&quot;</span><span class="o">;</span>
                <span class="k">return</span> <span class="n">cadenaCola</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="un-gestor-de-concurrencia-para-la-cola">
<h4>Un gestor de concurrencia para la cola<a class="headerlink" href="#un-gestor-de-concurrencia-para-la-cola" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GestorColasConcurrentes</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">ColaLimitada</span> <span class="n">colaProtegida</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">GestorColasConcurrentes</span><span class="o">(</span><span class="kt">int</span> <span class="n">numElementos</span><span class="o">){</span>
                <span class="n">colaProtegida</span><span class="o">=</span><span class="k">new</span> <span class="n">ColaLimitada</span><span class="o">(</span><span class="n">numElementos</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">synchronized</span>
                <span class="kt">void</span> <span class="nf">ponerEnCola</span><span class="o">(</span><span class="kt">int</span> <span class="n">elemento</span><span class="o">){</span>
                <span class="n">colaProtegida</span><span class="o">.</span><span class="na">ponerEnCola</span><span class="o">(</span><span class="n">elemento</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">int</span> <span class="nf">sacarDeCola</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">colaProtegida</span><span class="o">.</span><span class="na">sacarPrimero</span><span class="o">();</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-productor">
<h4>La clase Productor<a class="headerlink" href="#la-clase-productor" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Productor</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="kd">private</span> <span class="n">Random</span>                                                  <span class="n">generadorAzar</span><span class="o">;</span>
        <span class="kd">private</span>         <span class="n">GestorColasConcurrentes</span>         <span class="n">gc</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Productor</span><span class="o">(</span><span class="n">GestorColasConcurrentes</span> <span class="n">gc</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">gc</span><span class="o">=</span><span class="n">gc</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">generadorAzar</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="kt">int</span> <span class="n">numero</span><span class="o">=</span><span class="n">generadorAzar</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
                        <span class="n">gc</span><span class="o">.</span><span class="na">ponerEnCola</span><span class="o">(</span><span class="n">numero</span><span class="o">);</span>
                        <span class="kt">int</span> <span class="n">milisegs</span><span class="o">=</span><span class="n">generadorAzar</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">sleep</span><span class="o">(</span><span class="n">milisegs</span><span class="o">*</span><span class="mi">1000</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                                <span class="s">&quot;Productor interrumpido&quot;</span>
                                <span class="o">);</span>
                                <span class="k">return</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-consumidor">
<h4>La clase consumidor<a class="headerlink" href="#la-clase-consumidor" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Consumidor</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">Random</span>                                                  <span class="n">generadorAzar</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">GestorColasConcurrentes</span>         <span class="n">gc</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Consumidor</span><span class="o">(</span><span class="n">GestorColasConcurrentes</span> <span class="n">gc</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">gc</span><span class="o">=</span><span class="n">gc</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">generadorAzar</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="kt">int</span> <span class="n">num</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="na">sacarDeCola</span><span class="o">();</span>
                        <span class="kt">int</span> <span class="n">milisegs</span><span class="o">=</span><span class="n">generadorAzar</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">sleep</span><span class="o">(</span><span class="n">milisegs</span><span class="o">*</span><span class="mi">1000</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="c1">// TODO Auto-generated catch block</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                                <span class="s">&quot;Consumidor interrumpido&quot;</span><span class="o">);</span>
                                <span class="k">return</span> <span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="un-lanzador">
<h4>Un lanzador<a class="headerlink" href="#un-lanzador" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lanzador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
                <span class="n">ColaLimitada</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">ColaLimitada</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">sacarPrimero</span><span class="o">()!=</span><span class="mi">0</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                          <span class="s">&quot;Error, no se comprueba el caso cola vacía&quot;</span>
                        <span class="o">);</span>
                <span class="o">}</span>
                <span class="n">c</span><span class="o">.</span><span class="na">ponerEnCola</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
                <span class="n">c</span><span class="o">.</span><span class="na">ponerEnCola</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">cadenaCola</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">cadenaCola</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;10-20-FIN&quot;</span><span class="o">)){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fallos al encolar&quot;</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argumentos</span><span class="o">){</span>
                <span class="n">Lanzador</span> <span class="n">l</span><span class="o">=</span><span class="k">new</span> <span class="n">Lanzador</span><span class="o">();</span>
                <span class="n">GestorColasConcurrentes</span> <span class="n">gcl</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">GestorColasConcurrentes</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>

                <span class="kt">int</span> <span class="n">NUM_PRODUCTORES</span><span class="o">=</span><span class="mi">5</span><span class="o">;</span>
                <span class="n">Productor</span><span class="o">[]</span>     <span class="n">productores</span><span class="o">;</span>
                <span class="n">Thread</span><span class="o">[]</span>                        <span class="n">hilosProductores</span><span class="o">;</span>

                <span class="n">productores</span>             <span class="o">=</span>
                                <span class="k">new</span> <span class="n">Productor</span><span class="o">[</span><span class="n">NUM_PRODUCTORES</span><span class="o">];</span>
                <span class="n">hilosProductores</span>        <span class="o">=</span>
                                <span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">NUM_PRODUCTORES</span><span class="o">];</span>

                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PRODUCTORES</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">productores</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">Productor</span><span class="o">(</span><span class="n">gcl</span><span class="o">);</span>
                        <span class="n">hilosProductores</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span>
                                        <span class="n">productores</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                        <span class="n">hilosProductores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="kt">int</span> <span class="n">NUM_CONSUMIDORES</span><span class="o">=</span><span class="mi">10</span><span class="o">;</span>
                <span class="n">Consumidor</span><span class="o">[]</span>    <span class="n">consumidores</span><span class="o">;</span>
                <span class="n">Thread</span><span class="o">[]</span>                        <span class="n">hilosConsumidores</span><span class="o">;</span>

                <span class="n">consumidores</span>                    <span class="o">=</span>
                                <span class="k">new</span> <span class="n">Consumidor</span><span class="o">[</span><span class="n">NUM_CONSUMIDORES</span><span class="o">];</span>
                <span class="n">hilosConsumidores</span>       <span class="o">=</span>
                                <span class="k">new</span> <span class="n">Thread</span><span class="o">[</span><span class="n">NUM_CONSUMIDORES</span><span class="o">];</span>


                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_CONSUMIDORES</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">consumidores</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">Consumidor</span><span class="o">(</span><span class="n">gcl</span><span class="o">);</span>
                        <span class="n">hilosConsumidores</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span>
                                        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">consumidores</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                        <span class="n">hilosConsumidores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="cm">/* Se debería esperar a que todos terminen*/</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PRODUCTORES</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="n">hilosProductores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">join</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_CONSUMIDORES</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="n">hilosConsumidores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">join</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="c1">// TODO Auto-generated catch block</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ejercicio">
<h3>Ejercicio<a class="headerlink" href="#ejercicio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En unos grandes almacenes hay 300 clientes agolpados en la puerta para intentar conseguir un producto del cual solo hay 100 unidades.</p>
<p>Por la puerta solo cabe una persona, pero la paciencia de los clientes es limitada por lo que solo se harán un máximo de 10 intentos para entrar por la puerta. Si despues de 10 intentos la puerta no se ha encontrado libre ni una sola vez, el cliente desiste y se marcha.</p>
<p>Cuando se consigue entrar por la puerta el cliente puede encontrarse con dos situaciones:</p>
<ol class="arabic simple">
<li>Quedan productos: el cliente cogerá uno y se marchará.</li>
<li>No quedan productos: el cliente simplemente se marchará.</li>
</ol>
<p>Realizar la simulación en Java de dicha situación.</p>
</div>
<div class="section" id="documentacion">
<h3>Documentación.<a class="headerlink" href="#documentacion" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="depuracion">
<h3>Depuración.<a class="headerlink" href="#depuracion" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
</div>
<span id="document-textos/tema3"></span><div class="section" id="programacion-de-comunicaciones-en-red">
<h2>﻿Programación de comunicaciones en red<a class="headerlink" href="#programacion-de-comunicaciones-en-red" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="comunicacion-entre-aplicaciones">
<h3>Comunicación entre aplicaciones.<a class="headerlink" href="#comunicacion-entre-aplicaciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En Java toda la comunicación vista en primer curso de DAM consiste en dos cosas</p>
<ul class="simple">
<li>Entrada/salida por consola: con las clases <code class="docutils literal"><span class="pre">System.in</span></code> o <code class="docutils literal"><span class="pre">System.out</span></code>.</li>
<li>Lectura/escritura en ficheros: con las clases File y similares.</li>
</ul>
<p>Se puede avanzar un paso más utilizando Java para enviar datos a través de Internet a otro programa Java remoto, que es lo que haremos en este capítulo.</p>
</div>
<div class="section" id="roles-cliente-y-servidor">
<h3>Roles cliente y servidor.<a class="headerlink" href="#roles-cliente-y-servidor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando se hacen programas Java que se comuniquen lo habitual es que uno o varios actúen de cliente y uno o varios actúen de servidores.</p>
<ul class="simple">
<li>Servidor: espera peticiones, recibe datos de entrada y devuelve respuestas.</li>
<li>Cliente: genera peticiones, las envía a un servidor y espera respuestas.</li>
</ul>
<p>Un factor fundamental en los servidores es que tienen que ser capaces de procesar varias peticiones a la vez: <strong>deben ser multihilo</strong>.</p>
<p>Su arquitectura típica es la siguiente:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
        <span class="n">peticion</span><span class="o">=</span><span class="n">esperarPeticion</span><span class="o">();</span>
        <span class="n">hiloAsociado</span><span class="o">=</span><span class="k">new</span> <span class="n">Hilo</span><span class="o">();</span>
        <span class="n">hiloAsociado</span><span class="o">.</span><span class="na">atender</span><span class="o">(</span><span class="n">peticion</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="recordatorio-de-los-flujos-en-java">
<h3>Recordatorio de los flujos en Java<a class="headerlink" href="#recordatorio-de-los-flujos-en-java" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="inputstreams-y-outputstreams">
<h4>InputStreams y OutputStreams<a class="headerlink" href="#inputstreams-y-outputstreams" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Manejan bytes a secas. Por ejemplo, si queremos leer un fichero byte a byte usaremos <code class="docutils literal"><span class="pre">FileInputStream</span></code> y si queremos escribir usaremos <code class="docutils literal"><span class="pre">FileOutputStream</span></code>.</p>
<p>Son operaciones a muy bajo nivel que usaremos muy pocas veces (por ejemplo, solo si quisiéramos cambiar el primer byte de un archivo). En general usaremos otras clases más cómodas de usar.</p>
</div>
<div class="section" id="readers-y-writers">
<h4>Readers y Writers<a class="headerlink" href="#readers-y-writers" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En lugar de manejar <em>bytes</em> manejan <em>caracteres</em> (recordemos que hoy en día y con Unicode una letra como la <em>ñ</em> en realidad podría ocupar más de un byte).</p>
<p>Así, cuando queramos leer letras de un archivo usaremos clases como <code class="docutils literal"><span class="pre">FileReader</span></code> y <code class="docutils literal"><span class="pre">FileWriter</span></code>.</p>
<p>Las clases <code class="docutils literal"><span class="pre">Readers</span></code> y <code class="docutils literal"><span class="pre">Writers</span></code> en realidad se apoyan sobre las <code class="docutils literal"><span class="pre">InputStreams</span></code> y <code class="docutils literal"><span class="pre">OutputStreams</span></code>.</p>
<p>A veces nos interesará mezclar conceptos y por ejemplo poder tener una clase que use caracteres cuando a lo mejor Java nos ha dado una clase que usa bytes. Así, por ejemplo <code class="docutils literal"><span class="pre">InputStreamReader</span></code> puede coger un objeto que lea bytes y nos devolverá caracteres. De la misma forma <code class="docutils literal"><span class="pre">OutputStreamWriter</span></code> coge letras y devuelve los bytes que la componen.</p>
</div>
<div class="section" id="bufferedreaders-y-printwriters">
<h4><code class="docutils literal"><span class="pre">BufferedReaders</span></code> y <code class="docutils literal"><span class="pre">PrintWriters</span></code><a class="headerlink" href="#bufferedreaders-y-printwriters" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Cuando trabajamos con caracteres (que recordemos pueden tener varios bytes) normalmente no trabajamos de uno en uno. Es más frecuente usar <strong>líneas</strong> que se leen y escriben de una sola vez. Así por ejemplo, la clase <code class="docutils literal"><span class="pre">PrintWriter</span></code> tiene un método <code class="docutils literal"><span class="pre">print(ln)</span></code> que puede imprimir elementos complejos como <code class="docutils literal"><span class="pre">floats</span></code> o cadenas largas.</p>
<p>Además, Java ofrece clases que gestionan automáticamente los <em>buffers</em> por nosotros lo que nos da más comodidad y eficiencia. Por ello es muy habitual hacer cosas como esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">lectorEficiente</span> <span class="o">=</span> <span class="k">new</span>
        <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="s">&quot;fich1.txt&quot;</span><span class="o">));</span>
<span class="n">escritorEficiente</span> <span class="o">=</span> <span class="k">new</span>
        <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">&quot;fich2.txt&quot;</span><span class="o">));</span>
</pre></div>
</div>
<p>En el primer caso creamos un objeto <code class="docutils literal"><span class="pre">FileReader</span></code> que es capaz de leer caracteres de <code class="docutils literal"><span class="pre">fich1.txt</span></code>. Como esto nos parece poco práctico creamos otro objeto a partir del primero de tipo <code class="docutils literal"><span class="pre">BufferedReader</span></code> que nos permitirá leer bloques enteros de texto.</p>
<p>De hecho, si se comprueba la ayuda de la clase <code class="docutils literal"><span class="pre">FileReader</span></code> se verá que solo hay un método <code class="docutils literal"><span class="pre">read</span></code> que devuelve un <code class="docutils literal"><span class="pre">int</span></code>, es decir el siguiente <strong>carácter</strong> disponible, lo que hace que el método sea muy incómodo. Sin embargo <code class="docutils literal"><span class="pre">BufferedReader</span></code></p>
</div>
</div>
<div class="section" id="elementos-de-programacion-de-aplicaciones-en-red-librerias">
<h3>Elementos de programación de aplicaciones en red. Librerías.<a class="headerlink" href="#elementos-de-programacion-de-aplicaciones-en-red-librerias" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En Java toda la infraestructura de clases para trabajar con redes está en el paquete <code class="docutils literal"><span class="pre">java.net</span></code>.</p>
<p>En muchos casos nuestros programas empezarán con la sentencia <code class="docutils literal"><span class="pre">import</span> <span class="pre">java.net.*</span></code> pero muchos entornos (como Eclipse) son capaces de importar automáticamente las clases necesarias.</p>
<div class="section" id="la-clase-url">
<h4>La clase URL<a class="headerlink" href="#la-clase-url" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La clase URL permite gestionar accesos a URLs del tipo <code class="docutils literal"><span class="pre">http://marca.com/fichero.html</span></code> y descargar cosas con bastante sencillez.</p>
<p>Al crear un objeto URL se debe capturar la excepción <code class="docutils literal"><span class="pre">MalformedURLException</span></code> que sucede cuando hay algún error en la URL (como escribir <code class="docutils literal"><span class="pre">htp://marca.com</span></code>).</p>
<p>La clase URL nos ofrece un método <code class="docutils literal"><span class="pre">openStream</span></code> que nos devuelve un flujo básico de bytes. Podemos crear objetos más sofisticados para leer bloques como muestra el programa siguiente:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GestorDescargas</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">descargarArchivo</span><span class="o">(</span>
                        <span class="n">String</span> <span class="n">url_descargar</span><span class="o">,</span>
                        <span class="n">String</span> <span class="n">nombreArchivo</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Descargando &quot;</span>
                                <span class="o">+</span><span class="n">url_descargar</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">URL</span> <span class="n">laUrl</span><span class="o">=</span><span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">url_descargar</span><span class="o">);</span>
                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">laUrl</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
                        <span class="n">InputStreamReader</span> <span class="n">reader</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">bReader</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
                        <span class="n">FileWriter</span> <span class="n">escritorFichero</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">nombreArchivo</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">;</span>
                        <span class="k">while</span> <span class="o">((</span><span class="n">linea</span><span class="o">=</span><span class="n">bReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())!=</span><span class="kc">null</span><span class="o">){</span>
                                <span class="n">escritorFichero</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">escritorFichero</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">bReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;URL mal escrita!&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;Fallo en la lectura del fichero&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argumentos</span><span class="o">){</span>
                <span class="n">GestorDescargas</span> <span class="n">gd</span><span class="o">=</span><span class="k">new</span> <span class="n">GestorDescargas</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">base</span><span class="o">=</span>
                        <span class="s">&quot;http://10.13.0.20:8000&quot;</span><span class="o">+</span>
                                        <span class="s">&quot;/ServiciosProcesos/textos/&quot;</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">String</span> <span class="n">url</span><span class="o">=</span><span class="n">base</span><span class="o">+</span><span class="s">&quot;tema&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">&quot;.rst&quot;</span><span class="o">;</span>
                        <span class="n">gd</span><span class="o">.</span><span class="na">descargarArchivo</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="funciones-y-objetos-de-las-librerias">
<h3>Funciones y objetos de las librerías.<a class="headerlink" href="#funciones-y-objetos-de-las-librerias" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La clase URL proporciona un mecanismo muy sencillo pero por desgracia completamente atado al protocolo de las URL.</p>
<p>Java ofrece otros objetos que permiten tener un mayor control sobre lo que se envía o recibe a través de la red. Por desgracia esto implica que en muchos casos tendremos solo flujos de bajo nivel (streams).</p>
<p>En concreto Java ofrece dos elementos fundamentales para crear programas que usen redes</p>
<ul class="simple">
<li>Sockets</li>
<li>ServerSockets</li>
</ul>
<div class="section" id="repaso-de-redes">
<h4>Repaso de redes<a class="headerlink" href="#repaso-de-redes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En redes el protocolo IP es el responsable de dos cuestiones fundamentales:</p>
<ul class="simple">
<li>Establecer un sistema de direcciones universal (direcciones IP)</li>
<li>Establecer los mecanismos de enrutado.</li>
</ul>
<p>Como programadores el segundo no nos interesa, pero el primero será absolutamente fundamental para contactar con programas que estén en una ubicación remota.</p>
<p>Una ubicación remota <em>siempre</em> tendrá una dirección
IP pero <em>solo a veces tendrá un nombre DNS</em>. Para nosotros no habrá diferencia ya que si es necesario el sistema operativo traducirá de nombre DNS a IP.</p>
<p>Otro elemento necesario en la comunicación en redes es el uso de un puerto de un cierto protocolo:</p>
<ul class="simple">
<li>TCP: ofrece fiabilidad a los programas.</li>
<li>UDP: ofrece velocidad sacrificando la fiabilidad.</li>
</ul>
<p>A partir de ahora cuando usemos un número de puerto habrá que comprobar si ese número ya está usado.</p>
<p>Por ejemplo, es mala idea que nuestros programas usen el puerto 80 TCP, probablemente ya esté en uso.
Antes de usar un puerto en una aplicación comercial deberíamos consultar la lista de &#8220;IANA assigned ports&#8221;.</p>
<p>En líneas generales se pueden usar los puertos desde 1024 TCP a 49151 TCP, pero deberíamos comprobar que el número que elegimos no sea un número usado por un puerto de alguna aplicación que haya en la empresa.</p>
<p>En las prácticas de clase usaremos el 9876 TCP. Si se desea conectar desde el instituto con algún programa ejecutado en casa se deberá &#8220;abrir el puerto 9876 TCP&#8221;. Abrir un puerto consiste en configurar el router para que <strong>SÍ ACEPTE TRÁFICO INICIADO DESDE EL EXTERIOR</strong> cosa que no hace nunca por motivos de protección.</p>
</div>
</div>
<div class="section" id="sockets">
<h3>Sockets.<a class="headerlink" href="#sockets" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un <em>socket</em> es un objeto Java que nos permite contactar con un programa o servidor remoto. Dicho objeto nos proporcionará flujos de entrada y/o salida y podremos comunicarnos con dicho programa.</p>
<p>Existe otro tipo de sockets, los <em>ServerSocket</em>. Se utilizan para crear programas que acepten conexiones o peticiones.</p>
<p>Todos los objetos mencionados en este tema están en el paquete <code class="docutils literal"><span class="pre">java.net</span></code>.</p>
</div>
<div class="section" id="creacion-de-sockets">
<h3>Creación de sockets.<a class="headerlink" href="#creacion-de-sockets" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En el siguiente código puede verse el proceso básico de creación de un socket. En los párrafos siguientes explicaremos el significado de los bloques de código.:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Conector</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">destino</span><span class="o">=</span><span class="s">&quot;www.google.com&quot;</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">puertoDestino</span><span class="o">=</span><span class="mi">80</span><span class="o">;</span>
                <span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span>
                                <span class="n">destino</span><span class="o">,</span> <span class="n">puertoDestino</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                        <span class="c1">//Si llegamos aquí es que la conexión</span>
                        <span class="c1">//sí se hizo.</span>

                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>


                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;No se pudo establecer la conexion &quot;</span><span class="o">+</span>
                                <span class="s">&quot; o hubo un fallo al leer datos.&quot;</span>
                        <span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Para poder crear un socket primero necesitamos una dirección con la que contactar. Toda dirección está formada por dirección IP (o DNS) y un puerto. En nuestro caso intentaremos contactar con <code class="docutils literal"><span class="pre">www.google.com:80</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">destino</span><span class="o">=</span><span class="s">&quot;www.google.com&quot;</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">puertoDestino</span><span class="o">=</span><span class="mi">80</span><span class="o">;</span>
<span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
<span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span>
        <span class="n">InetSocketAddress</span><span class="o">(</span>
                        <span class="n">destino</span><span class="o">,</span> <span class="n">puertoDestino</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="enlazado-y-establecimiento-de-conexiones">
<h3>Enlazado y establecimiento de conexiones.<a class="headerlink" href="#enlazado-y-establecimiento-de-conexiones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El paso crítico para iniciar la comunicación es llamar al método <code class="docutils literal"><span class="pre">connect</span></code>. Este método puede disparar una excepción del tipo <code class="docutils literal"><span class="pre">IOException</span></code> que puede significar dos cosas:</p>
<ul class="simple">
<li>La conexión no se pudo establecer.</li>
<li>Aunque la conexión se estableció no fue posible leer o escribir datos.</li>
</ul>
<p>Así, la conexión debería realizarse así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">{</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
        <span class="c1">//Si llegamos aquí es que la conexión</span>
        <span class="c1">//sí se hizo.</span>

        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>

<span class="o">}</span>  <span class="c1">//Fin del try</span>
<span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                <span class="s">&quot;No se pudo establecer la conexion &quot;</span><span class="o">+</span>
                <span class="s">&quot; o hubo un fallo al leer datos.&quot;</span>
        <span class="o">);</span>
<span class="o">}</span> <span class="c1">//Fin del catch IOException</span>
</pre></div>
</div>
</div>
<div class="section" id="utilizacion-de-sockets-para-la-transmision-y-recepcion-de-informacion">
<h3>Utilización de sockets para la transmisión y recepción de información.<a class="headerlink" href="#utilizacion-de-sockets-para-la-transmision-y-recepcion-de-informacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La clase <code class="docutils literal"><span class="pre">Socket</span></code> tiene dos métodos llamados <code class="docutils literal"><span class="pre">getInputStream</span></code> y <code class="docutils literal"><span class="pre">getOutputSream</span></code> que nos permiten obtener <em>flujos orientados a bytes</em>. Recordemos que es posible crear nuestros propios flujos, con más métodos que ofrecen más comodidad.</p>
<div class="section" id="el-ejemplo-completo">
<h4>El ejemplo completo<a class="headerlink" href="#el-ejemplo-completo" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Podemos contactar con un programa cualquiera escrito en cualquier lenguaje y enviar las peticiones de acuerdo a un protocolo. Nuestro programa podrá leer las respuestas independientemente de como fuera el servidor.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Conector</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Iniciando...&quot;</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">destino</span><span class="o">=</span><span class="s">&quot;10.8.0.253&quot;</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">puertoDestino</span><span class="o">=</span><span class="mi">80</span><span class="o">;</span>
                <span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span>
                                <span class="n">destino</span><span class="o">,</span> <span class="n">puertoDestino</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                        <span class="c1">//Si llegamos aquí es que la conexión</span>
                        <span class="c1">//sí se hizo.</span>

                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>

                        <span class="c1">//Flujos que manejan caracteres</span>
                        <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">OutputStreamWriter</span> <span class="n">osw</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>

                        <span class="c1">//Flujos de líneas</span>
                        <span class="n">BufferedReader</span> <span class="n">bReader</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                        <span class="n">PrintWriter</span> <span class="n">pWriter</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">osw</span><span class="o">);</span>


                        <span class="n">pWriter</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;GET /index.html&quot;</span><span class="o">);</span>
                        <span class="n">pWriter</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">;</span>
                        <span class="n">FileWriter</span> <span class="n">escritorArchivo</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">&quot;resultado.txt&quot;</span><span class="o">);</span>
                        <span class="k">while</span> <span class="o">((</span><span class="n">linea</span><span class="o">=</span><span class="n">bReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">){</span>
                                <span class="n">escritorArchivo</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">escritorArchivo</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">pWriter</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">bReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">isr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">osw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;No se pudo establecer la conexion &quot;</span><span class="o">+</span>
                                <span class="s">&quot; o hubo un fallo al leer datos.&quot;</span>
                        <span class="o">);</span>
                <span class="o">}</span> <span class="c1">//Fin del catch</span>
        <span class="o">}</span> <span class="c1">//Fin del main</span>
<span class="o">}</span> <span class="c1">//Fin de la clase Conector</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="programacion-de-aplicaciones-cliente-y-servidor">
<h3>Programación de aplicaciones cliente y servidor.<a class="headerlink" href="#programacion-de-aplicaciones-cliente-y-servidor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Al crear aplicaciones cliente y servidor puede ocurrir que tengamos que implementar varias operaciones:</p>
<ul class="simple">
<li>Si tenemos que programar el servidor <strong>deberemos definir un protocolo</strong> de acceso a ese servidor.</li>
<li>Si tenemos que programar solo el cliente <strong>necesitaremos conocer el protocolo de acceso</strong> a ese servidor.</li>
<li>Si tenemos que programar los dos tendremos que empezar por <strong>definir el protocolo de comunicación entre ambos</strong>.</li>
</ul>
<p>En el ejemplo siguiente puede verse un ejemplo para Python 3 que implementa un servidor de cálculo. El servidor tiene un protocolo muy rígido (demasiado) que consiste en lo siguiente:</p>
<ol class="arabic simple">
<li>El servidor espera que primero envíen la operación que puede ser <code class="docutils literal"><span class="pre">+</span></code> o <code class="docutils literal"><span class="pre">-</span></code>. La operación debe terminar con un fin de línea UNIX (<code class="docutils literal"><span class="pre">\n</span></code>)</li>
<li>Despues acepta un número de dos cifras (ni una ni tres) terminado en un fín de línea UNIX.</li>
<li>Despues acepta un segundo número de dos cifras terminado en un fin de línea UNIX.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socketserver</span>
<span class="n">TAM_MAXIMO_PARAMETROS</span><span class="o">=</span><span class="mi">64</span>
<span class="n">PUERTO</span><span class="o">=</span><span class="mi">9876</span>
<span class="k">class</span> <span class="nc">GestorConexion</span><span class="p">(</span>
        <span class="n">socketserver</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">leer_cadena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">LONGITUD</span><span class="p">):</span>
                <span class="n">cadena</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">LONGITUD</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">cadena</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">convertir_a_cadena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">calcular_resultado</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
                <span class="n">n1</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
                <span class="n">n2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>

                <span class="n">op</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">convertir_a_cadena</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="s2">&quot;+&quot;</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">n1</span><span class="o">+</span><span class="n">n2</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">n1</span><span class="o">-</span><span class="n">n2</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="sd">&quot;&quot;&quot;Controlador de evento &#39;NuevaConexion&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">direccion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">operacion</span>   <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">leer_cadena</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">num1</span>        <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">leer_cadena</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">num2</span>        <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">leer_cadena</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">print</span> <span class="p">(</span><span class="n">direccion</span><span class="o">+</span><span class="s2">&quot; pregunta:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">operacion</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num2</span><span class="p">))</span>

                <span class="n">resultado</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calcular_resultado</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="n">operacion</span><span class="p">,</span> <span class="n">num2</span><span class="p">)</span>
                <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Devolviendo a &quot;</span> <span class="o">+</span> <span class="n">direccion</span><span class="o">+</span><span class="s2">&quot; el resultado &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">resultado</span><span class="p">))</span>
                <span class="n">bytes_resultado</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resultado</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">bytes_resultado</span><span class="p">)</span>
<span class="n">servidor</span><span class="o">=</span><span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">((</span><span class="s2">&quot;10.13.0.20&quot;</span><span class="p">,</span> <span class="mi">9876</span><span class="p">),</span> <span class="n">GestorConexion</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Servidor en marcha.&quot;</span><span class="p">)</span>
<span class="n">servidor</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div>
<p>La comunicación Java con el servidor sería algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bSuma</span><span class="o">=</span><span class="s">&quot;+\n&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">bOp1</span><span class="o">=</span><span class="s">&quot;42\n&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">bOp2</span><span class="o">=</span><span class="s">&quot;34\n&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>

<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bSuma</span><span class="o">);</span>
<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bOp1</span><span class="o">);</span>
<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bOp2</span><span class="o">);</span>
<span class="n">os</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
<span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span>
        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
<span class="n">String</span> <span class="n">cadenaRecibida</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Recibido:&quot;</span><span class="o">+</span>
                <span class="n">cadenaRecibida</span><span class="o">);</span>

<span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</pre></div>
</div>
<div class="section" id="ejemplo-de-servidor-java">
<h4>Ejemplo de servidor Java<a class="headerlink" href="#ejemplo-de-servidor-java" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Supongamos que se nos pide crear un servidor de operaciones de cálculo que sea menos estricto que el anterior:</p>
<ul class="simple">
<li>Cualquier parámetro que envíe el usuario debe ir terminado en un fin de línea UNIX (&#8220;n&#8221;).</li>
<li>El usuario enviará primero un símbolo &#8220;+&#8221;, &#8220;-&#8221;, &#8220;*&#8221; o &#8220;/&#8221;.</li>
<li>Despues se puede enviar un positivo de 1 a 8 cifras. El usuario podría equivocarse y enviar en vez de &#8220;3762&#8221; algo como &#8220;37a62&#8221;. En ese caso se asume que el parámetro es 0.</li>
<li>Despues se envía un segundo positivo de 1 a 8 cifras igual que el anterior.</li>
<li>Cuando se haya procesado todo el servidor contestará al cliente con un positivo de 1 a 12 cifras.</li>
</ul>
<p>Antes de empezar crear el código que permita procesar estos parámetros complejos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServidorCalculo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerNumero</span><span class="o">(</span><span class="n">String</span> <span class="n">linea</span><span class="o">){</span>
                <span class="cm">/* 1. Comprobar si es un número</span>
<span class="cm">                 * 2. Ver si el número es correcto (32a75)</span>
<span class="cm">                 * 3. Ver si tiene de 1 a 8 cifras</span>
<span class="cm">                 */</span>
                <span class="kt">int</span> <span class="n">numero</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">numero</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="cm">/* Si el número es mayor de 100 millones no</span>
<span class="cm">                 * es válido tampoco</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">numero</span><span class="o">&gt;=</span><span class="mi">100000000</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">numero</span><span class="o">;</span>

        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">(){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Arrancado el servidor&quot;</span><span class="o">);</span>

                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>

                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Así, el código completo del servidor sería:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServidorCalculo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerNumero</span><span class="o">(</span><span class="n">String</span> <span class="n">linea</span><span class="o">){</span>
                <span class="cm">/* 1. Comprobar si es un número</span>
<span class="cm">                 * 2. Ver si el número es correcto (32a75)</span>
<span class="cm">                 * 3. Ver si tiene de 1 a 8 cifras</span>
<span class="cm">                 */</span>
                <span class="kt">int</span> <span class="n">numero</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">numero</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="cm">/* Si el número es mayor de 100 millones no</span>
<span class="cm">                 * es válido tampoco</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">numero</span><span class="o">&gt;=</span><span class="mi">100000000</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">numero</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calcular</span><span class="o">(</span><span class="n">String</span> <span class="n">op</span><span class="o">,</span> <span class="n">String</span> <span class="n">n1</span><span class="o">,</span> <span class="n">String</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="kt">char</span> <span class="n">simbolo</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num1</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n1</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num2</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n2</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">simbolo</span><span class="o">==</span><span class="sc">&#39;+&#39;</span><span class="o">){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">num1</span><span class="o">+</span><span class="n">num2</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Arrancado el servidor&quot;</span><span class="o">);</span>
                <span class="n">ServerSocket</span> <span class="n">socketEscucha</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">socketEscucha</span><span class="o">=</span><span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">9876</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;No se pudo poner un socket &quot;</span><span class="o">+</span>
                                        <span class="s">&quot;a escuchar en TCP 9876&quot;</span><span class="o">);</span>
                        <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="n">Socket</span> <span class="n">conexion</span><span class="o">=</span><span class="n">socketEscucha</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion recibida!&quot;</span><span class="o">);</span>
                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">conexion</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">bf</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">=</span><span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">num1</span><span class="o">=</span><span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">num2</span><span class="o">=</span><span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="cm">/* Calculamos el resultado*/</span>
                        <span class="n">Integer</span> <span class="n">result</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">calcular</span><span class="o">(</span><span class="n">linea</span><span class="o">,</span> <span class="n">num1</span><span class="o">,</span> <span class="n">num2</span><span class="o">);</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">conexion</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                        <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
                        <span class="n">pw</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
                        <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Y el cliente sería:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClienteCalculo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedReader</span> <span class="nf">getFlujo</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">is</span><span class="o">){</span>
                <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">bfr</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="cm">/**</span>
<span class="cm">         * @param args</span>
<span class="cm">         * @throws IOException</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span>
                                <span class="n">InetSocketAddress</span><span class="o">(</span><span class="s">&quot;10.13.0.20&quot;</span><span class="o">,</span> <span class="mi">9876</span><span class="o">);</span>
                <span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">=</span>
                                <span class="n">ClienteCalculo</span><span class="o">.</span><span class="na">getFlujo</span><span class="o">(</span>
                                                <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
                <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">=</span><span class="k">new</span>
                                <span class="n">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;+\n&quot;</span><span class="o">);</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;42\n&quot;</span><span class="o">);</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;84\n&quot;</span><span class="o">);</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">resultado</span><span class="o">=</span><span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span>
                        <span class="o">(</span><span class="s">&quot;El resultado fue:&quot;</span><span class="o">+</span><span class="n">resultado</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="utilizacion-de-hilos-en-la-programacion-de-aplicaciones-en-red">
<h3>Utilización de hilos en la programación de aplicaciones en red.<a class="headerlink" href="#utilizacion-de-hilos-en-la-programacion-de-aplicaciones-en-red" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En el caso de aplicaciones que necesiten aceptar varias conexiones <strong>habrá que mover todo el código de gestión de peticiones a una clase que implemente Runnable</strong></p>
<p>Ahora el servidor será así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
        <span class="n">Socket</span> <span class="n">conexion</span><span class="o">=</span><span class="n">socketEscucha</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion recibida&quot;</span><span class="o">);</span>
        <span class="n">Peticion</span> <span class="n">p</span><span class="o">=</span><span class="k">new</span> <span class="n">Peticion</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>
        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Pero ahora tendremos una clase Petición como esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Peticion</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">;</span>
        <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">;</span>
        <span class="n">Socket</span> <span class="n">socket</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Peticion</span><span class="o">(</span><span class="n">Socket</span> <span class="n">socket</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">socket</span><span class="o">=</span><span class="n">socket</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerNumero</span><span class="o">(</span><span class="n">String</span> <span class="n">linea</span><span class="o">){</span>
                <span class="cm">/* 1. Comprobar si es un número</span>
<span class="cm">                 * 2. Ver si el número es correcto (32a75)</span>
<span class="cm">                 * 3. Ver si tiene de 1 a 8 cifras</span>
<span class="cm">                 */</span>
                <span class="kt">int</span> <span class="n">numero</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">numero</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="cm">/* Si el número es mayor de 100 millones no</span>
<span class="cm">                 * es válido tampoco</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">numero</span><span class="o">&gt;=</span><span class="mi">100000000</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">numero</span><span class="o">;</span>

        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calcular</span><span class="o">(</span><span class="n">String</span> <span class="n">op</span><span class="o">,</span> <span class="n">String</span> <span class="n">n1</span><span class="o">,</span> <span class="n">String</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="kt">char</span> <span class="n">simbolo</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num1</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n1</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num2</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n2</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">simbolo</span><span class="o">==</span><span class="sc">&#39;+&#39;</span><span class="o">){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">num1</span><span class="o">+</span><span class="n">num2</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">bfr</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                        <span class="n">pw</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">;</span>
                        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                                <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="n">String</span> <span class="n">num1</span><span class="o">=</span><span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="n">String</span> <span class="n">num2</span><span class="o">=</span><span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="cm">/* Calculamos el resultado*/</span>
                                <span class="n">Integer</span> <span class="n">result</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">calcular</span><span class="o">(</span><span class="n">linea</span><span class="o">,</span> <span class="n">num1</span><span class="o">,</span> <span class="n">num2</span><span class="o">);</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;El servidor dio resultado:&quot;</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
                                <span class="n">pw</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
                                <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                        <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="ejercicio-servicio-de-ordenacion">
<h4>Ejercicio: servicio de ordenación<a class="headerlink" href="#ejercicio-servicio-de-ordenacion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Crear una arquitectura cliente/servidor que permita a un cliente, enviar dos cadenas a un servidor para saber cual de ellas va antes que otra:</p>
<ul class="simple">
<li>Un cliente puede enviar las cadenas &#8220;hola&#8221;, &#8220;mundo&#8221;. El servidor comprobará que en el diccionario la primera va antes que la segunda, por lo cual contestará &#8220;hola&#8221;, &#8220;mundo&#8221;.</li>
<li>Si el cliente enviase &#8220;mundo&#8221;, &#8220;hola&#8221; el servidor debe devolver la respuesta &#8220;hola&#8221;, &#8220;mundo&#8221;.</li>
</ul>
<p>Debido a posibles mejoras futuras, se espera que el servidor sea capaz de saber qué versión del protocolo se maneja. Esto es debido a que en el futuro se espera lanzar una versión 2 del protocolo en la que se puedan enviar varias cadenas seguidas.</p>
<p>Crear el protocolo, el código Java del cliente y el código Java del servidor con capacidad para procesar muchas peticiones a la vez (multihilo).</p>
<p>Se debe aceptar que un cliente que ya tenga un socket abierto envíe todas las parejas de cadenas que desee.</p>
</div>
<div class="section" id="una-clase-protocolo">
<h4>Una clase Protocolo<a class="headerlink" href="#una-clase-protocolo" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Dado que los protocolos pueden ser variables puede ser útil encapsular el comportamiento del protocolo en una pequeña clase separada:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Protocolo</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">terminador</span><span class="o">=</span><span class="s">&quot;\n&quot;</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMensajeVersion</span><span class="o">(</span><span class="kt">int</span> <span class="n">version</span><span class="o">){</span>
                <span class="n">Integer</span> <span class="n">i</span><span class="o">=</span><span class="n">version</span><span class="o">;</span>
                <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="n">terminador</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNumVersion</span><span class="o">(</span><span class="n">String</span> <span class="n">mensaje</span><span class="o">){</span>
                <span class="n">Integer</span> <span class="n">num</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">mensaje</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">num</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMensaje</span><span class="o">(</span><span class="n">String</span> <span class="n">cadena</span><span class="o">){</span>
                <span class="k">return</span> <span class="n">cadena</span><span class="o">+</span><span class="n">terminador</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="una-clase-con-funciones-de-utilidad">
<h4>Una clase con funciones de utilidad<a class="headerlink" href="#una-clase-con-funciones-de-utilidad" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Algunas operaciones son muy sencillas, pero muy engorrosas. Alargan el código innecesariamente y lo hacen más difícil de entender. Si además se realizan a menudo puede ser interesante empaquetar toda la funcionalidad en una clase.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Utilidades</span> <span class="o">{</span>
        <span class="cm">/* Obtiene un flujo de escritura</span>
<span class="cm">        a partir de un socket*/</span>
        <span class="kd">public</span> <span class="n">PrintWriter</span> <span class="nf">getFlujoEscritura</span>
                <span class="o">(</span><span class="n">Socket</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">pw</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="cm">/* Obtiene un flujo de lectura</span>
<span class="cm">        a partir de un socket*/</span>
        <span class="kd">public</span> <span class="n">BufferedReader</span>
                <span class="nf">getFlujoLectura</span><span class="o">(</span><span class="n">Socket</span> <span class="n">s</span><span class="o">)</span>
                                <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">bfr</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-peticion">
<h4>La clase Petición<a class="headerlink" href="#la-clase-peticion" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Peticion</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
        <span class="n">Socket</span> <span class="n">conexionParaAtender</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Peticion</span> <span class="o">(</span> <span class="n">Socket</span> <span class="n">s</span> <span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">conexionParaAtender</span><span class="o">=</span><span class="n">s</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">PrintWriter</span> <span class="n">flujoEscritura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoEscritura</span><span class="o">(</span>
                                                <span class="k">this</span><span class="o">.</span><span class="na">conexionParaAtender</span>
                                                <span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">flujoLectura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoLectura</span><span class="o">(</span>
                                                <span class="n">conexionParaAtender</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">protocolo</span><span class="o">=</span>
                                        <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="kt">int</span> <span class="n">numVersion</span><span class="o">=</span>
                                        <span class="n">Protocolo</span><span class="o">.</span><span class="na">getNumVersion</span><span class="o">(</span><span class="n">protocolo</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">numVersion</span><span class="o">==</span><span class="mi">1</span><span class="o">){</span>
                                <span class="n">String</span> <span class="n">linea1</span><span class="o">=</span>
                                                <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="n">String</span> <span class="n">linea2</span><span class="o">=</span>
                                                <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="c1">//Linea 1 va despues en el</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">linea1</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">linea2</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">){</span>
                                         <span class="n">dicc</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea2</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea1</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea1</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea2</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                                <span class="o">}</span>
                        <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;No se pudo crear algún flujo&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-servidor">
<h4>La clase Servidor<a class="headerlink" href="#la-clase-servidor" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServidorOrdenacion</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">ServerSocket</span> <span class="n">socket</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">9876</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;No se pudo arrancar&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Servidor esperando&quot;</span><span class="o">);</span>
                        <span class="n">Socket</span> <span class="n">conexionCliente</span><span class="o">=</span>
                                        <span class="n">socket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Alguien conectó&quot;</span><span class="o">);</span>
                        <span class="n">Peticion</span> <span class="n">p</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">Peticion</span><span class="o">(</span><span class="n">conexionCliente</span><span class="o">);</span>
                        <span class="n">Thread</span> <span class="n">hiloAsociado</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
                        <span class="n">hiloAsociado</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span> <span class="c1">// Fin del método escuchar</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span>  <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argumentos</span><span class="o">){</span>
                <span class="n">ServidorOrdenacion</span> <span class="n">s</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">ServidorOrdenacion</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">s</span><span class="o">.</span><span class="na">escuchar</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;No se pudo arrancar&quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; el cliente o el serv&quot;</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-cliente">
<h4>La clase Cliente<a class="headerlink" href="#la-clase-cliente" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cliente</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ordenar</span><span class="o">(</span><span class="n">String</span> <span class="n">s1</span><span class="o">,</span> <span class="n">String</span> <span class="n">s2</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span><span class="s">&quot;10.13.0.20&quot;</span><span class="o">,</span> <span class="mi">9876</span><span class="o">);</span>
                <span class="n">Socket</span> <span class="n">conexion</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">conexion</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion establecida&quot;</span><span class="o">);</span>
                <span class="cm">/* Ahora hay que crear flujos de salida, enviar</span>
<span class="cm">                 * cadenas por allí y esperar los resultados.</span>
<span class="cm">                 */</span>
                <span class="k">try</span><span class="o">{</span>

                        <span class="n">BufferedReader</span> <span class="n">flujoLectura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoLectura</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>
                        <span class="n">PrintWriter</span> <span class="n">flujoEscritura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoEscritura</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>

                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>
                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span><span class="o">);</span>
                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s2</span><span class="o">);</span>
                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">linea1</span><span class="o">=</span><span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">linea2</span><span class="o">=</span><span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;El servidor devolvió &quot;</span><span class="o">+</span>
                                        <span class="n">linea1</span> <span class="o">+</span> <span class="s">&quot; y &quot;</span><span class="o">+</span><span class="n">linea2</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>

                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Cliente</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">Cliente</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">c</span><span class="o">.</span><span class="na">ordenar</span><span class="o">(</span><span class="s">&quot;aaa&quot;</span><span class="o">,</span> <span class="s">&quot;bbb&quot;</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fallo la conexion o &quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;los flujos&quot;</span><span class="o">);</span>
                <span class="o">}</span> <span class="c1">//Fin del catch</span>
        <span class="o">}</span> <span class="c1">//Fin del main</span>
<span class="o">}</span> <span class="c1">//Fin de la clase</span>
</pre></div>
</div>
</div>
<div class="section" id="ampliacion">
<h4>Ampliación<a class="headerlink" href="#ampliacion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Finalmente la empresa va a necesitar una versión mejorada del servidor que permita a otros cliente enviar un número de palabras y luego las palabras. Se desea hacer todo sin romper la compatibilidad con los clientes viejos. Mostrar el código Java del servidor y del cliente.</p>
<p>En el servidor se añade este código extra a la hora de comprobar el protocolo:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="n">numVersion</span><span class="o">==</span><span class="mi">2</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Llegó un v2&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">lineaCantidadPalabras</span><span class="o">=</span>
        <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">numPalabras</span><span class="o">=</span>
                <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span>
                <span class="o">(</span><span class="n">lineaCantidadPalabras</span><span class="o">);</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">palabras</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">numPalabras</span><span class="o">];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">numPalabras</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">palabras</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span>
                        <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">palabras</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">ordenar</span><span class="o">(</span><span class="n">palabras</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">palabras</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">palabras</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Y finalmente solo habría que implementar un método en la petición que reciba un vector de <code class="docutils literal"><span class="pre">String</span></code> (las palabras) y devuelva el mismo vector pero ordenado.</p>
</div>
</div>
</div>
<span id="document-textos/tema4"></span><div class="section" id="generacion-de-servicios-en-red">
<h2>﻿Generación de servicios en red<a class="headerlink" href="#generacion-de-servicios-en-red" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="protocolos-estandar-de-comunicacion-en-red-a-nivel-de-aplicacion">
<h3>Protocolos estándar de comunicación en red a nivel de aplicación<a class="headerlink" href="#protocolos-estandar-de-comunicacion-en-red-a-nivel-de-aplicacion" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="telnet">
<h4>Telnet<a class="headerlink" href="#telnet" title="Enlazar permanentemente con este título">¶</a></h4>
</div>
<div class="section" id="ftp">
<h4>FTP<a class="headerlink" href="#ftp" title="Enlazar permanentemente con este título">¶</a></h4>
</div>
<div class="section" id="http">
<h4>HTTP<a class="headerlink" href="#http" title="Enlazar permanentemente con este título">¶</a></h4>
</div>
<div class="section" id="pop3">
<h4>POP3<a class="headerlink" href="#pop3" title="Enlazar permanentemente con este título">¶</a></h4>
</div>
<div class="section" id="smtp">
<h4>SMTP<a class="headerlink" href="#smtp" title="Enlazar permanentemente con este título">¶</a></h4>
</div>
</div>
<div class="section" id="librerias-de-clases-y-componentes">
<h3>Librerías de clases y componentes.<a class="headerlink" href="#librerias-de-clases-y-componentes" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="utilizacion-de-objetos-predefinidos">
<h3>Utilización de objetos predefinidos.<a class="headerlink" href="#utilizacion-de-objetos-predefinidos" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="propiedades-de-los-objetos-predefinidos">
<h3>Propiedades de los objetos predefinidos.<a class="headerlink" href="#propiedades-de-los-objetos-predefinidos" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="metodos-y-eventos-de-los-objetos-predefinidos">
<h3>Métodos y eventos de los objetos predefinidos.<a class="headerlink" href="#metodos-y-eventos-de-los-objetos-predefinidos" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="establecimiento-y-finalizacion-de-conexiones">
<h3>Establecimiento y finalización de conexiones.<a class="headerlink" href="#establecimiento-y-finalizacion-de-conexiones" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="transmision-de-informacion">
<h3>Transmisión de información.<a class="headerlink" href="#transmision-de-informacion" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="programacion-de-aplicaciones-cliente">
<h3>Programación de aplicaciones cliente.<a class="headerlink" href="#programacion-de-aplicaciones-cliente" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="programacion-de-servidores">
<h3>Programación de servidores.<a class="headerlink" href="#programacion-de-servidores" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="implementacion-de-comunicaciones-simultaneas">
<h3>Implementación de comunicaciones simultáneas.<a class="headerlink" href="#implementacion-de-comunicaciones-simultaneas" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="documentacion">
<h3>Documentación.<a class="headerlink" href="#documentacion" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="depuracion">
<h3>Depuración.<a class="headerlink" href="#depuracion" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="monitorizacion-de-tiempos-de-respuesta">
<h3>Monitorización de tiempos de respuesta.<a class="headerlink" href="#monitorizacion-de-tiempos-de-respuesta" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
</div>
<span id="document-textos/tema5"></span><div class="section" id="utilizacion-de-tecnicas-de-programacion-segura">
<h2>﻿Utilización de técnicas de programación segura<a class="headerlink" href="#utilizacion-de-tecnicas-de-programacion-segura" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="introduccion">
<h3>Introducción<a class="headerlink" href="#introduccion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En general, cuando se envía algo a través de sockets se envía como &#8220;texto plano&#8221;, es decir, no sabemos si hay alguien usando un sniffer en la red y por tanto no sabemos si alguien está capturando los datos.</p>
<p>En general, cualquier sistema que pretenda ser seguro necesitará usar cifrado.</p>
</div>
<div class="section" id="practicas-de-programacion-segura">
<h3>Prácticas de programación segura.<a class="headerlink" href="#practicas-de-programacion-segura" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para enviar mensajes cifrados se necesita algún mecanismo o algoritmo para convertir un texto normal en uno más difícil de comprender.</p>
<p>El esquema general de todos los métodos es tener código como el siguiente:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">cifrar</span> <span class="o">(</span><span class="n">String</span> <span class="n">texto</span><span class="o">,</span> <span class="n">String</span> <span class="n">clave</span><span class="o">)</span>
<span class="o">{</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="n">String</span> <span class="nf">descifrar</span><span class="o">(</span><span class="n">String</span> <span class="n">texto</span><span class="o">,</span><span class="n">String</span> <span class="n">clave</span><span class="o">)</span>
<span class="o">{</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="metodo-cesar">
<h4>Método César<a class="headerlink" href="#metodo-cesar" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Si el alfabeto es el siguiente:</p>
<p>ABCDEFGHIJKLMNÑOPQRSTUVWXYZ0123456789-
BCDEFGHIJKLMNÑOPQRSTUVWXYZ0123456789-A</p>
<p>El mensaje HOLA MUNDO, con clave 1 sería así</p>
<blockquote>
<div>HOLAMUNDO
IPMBNVÑEP</div></blockquote>
<p>El descifrado simplemente implicaría el método inverso. Si el desplazamiento es un valor distinto de 1, lo único que hay que hacer es construir el alfabeto rotado tantas veces como el desplazamiento</p>
<p>Esta clase implementa un sistema de rotado básico para poder efectuar</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cifrador</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">alfabeto</span><span class="o">=</span>
                        <span class="s">&quot;ABCDEFGHIJKLMNÑOPQRSTUVWXYZ&quot;</span><span class="o">+</span>
                        <span class="s">&quot;0123456789 &quot;</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">alfabetoCifrado</span><span class="o">;</span>
        <span class="cm">/* Dada una cadena como</span>
<span class="cm">         * &quot;ABC&quot; y un número (p.ej 2)</span>
<span class="cm">         * devuelve la cadena rotada a la izq</span>
<span class="cm">         * tantas veces como indique el numero,</span>
<span class="cm">         * en este caso &quot;CAB&quot;</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">rotar</span><span class="o">(</span><span class="n">String</span> <span class="n">cad</span><span class="o">,</span><span class="kt">int</span> <span class="n">numVeces</span><span class="o">){</span>
                <span class="kt">char</span><span class="o">[]</span> <span class="n">resultado</span><span class="o">=</span><span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">cad</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cad</span><span class="o">.</span><span class="na">length</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                        <span class="kt">int</span> <span class="n">posParaExtraer</span><span class="o">=(</span><span class="n">i</span><span class="o">+</span><span class="n">numVeces</span><span class="o">)%</span><span class="n">cad</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
                        <span class="n">resultado</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">cad</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">posParaExtraer</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">String</span> <span class="n">cadResultado</span><span class="o">=</span><span class="n">String</span><span class="o">.</span><span class="na">copyValueOf</span><span class="o">(</span><span class="n">resultado</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">cadResultado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">cifrar</span>
                <span class="o">(</span><span class="n">String</span> <span class="n">mensaje</span><span class="o">,</span> <span class="n">String</span> <span class="n">clave</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">mensajeCifrado</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">;</span>

                <span class="k">return</span> <span class="n">mensajeCifrado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">descifrar</span>
                <span class="o">(</span><span class="n">String</span> <span class="n">mensajeCifrado</span><span class="o">,</span> <span class="n">String</span> <span class="n">clave</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">mensajeDescifrado</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">;</span>

                <span class="k">return</span> <span class="n">mensajeDescifrado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Cifrador</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">Cifrador</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">cad</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="na">rotar</span><span class="o">(</span><span class="s">&quot;ABCDEFG&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cad</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="criptografia-de-clave-publica-y-clave-privada">
<h3>Criptografía de clave pública y clave privada.<a class="headerlink" href="#criptografia-de-clave-publica-y-clave-privada" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los principales sistemas modernos de seguridad utilizan dos claves ,una para cifrar y otra para descifrar. Esto se puede usar de diversas formas.</p>
</div>
<div class="section" id="principales-aplicaciones-de-la-criptografia">
<h3>Principales aplicaciones de la criptografía.<a class="headerlink" href="#principales-aplicaciones-de-la-criptografia" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li>Mensajería segura: todo el mundo da su clave de cifrado pero conserva la de descifrado. Si queremos enviar un mensaje a alguien cogemos su clave de cifrado y ciframos el mensaje que le enviamos. Solo él podrá descifrarlo.</li>
<li>Firma digital: pilar del comercio electrónico. Permite verificar que un archivo no ha sido modificado.</li>
<li>Mensajería segura: en este tipo de mensajería se intenta evitar que un atacante (quizá con un <em>sniffer</em>) consiga descifrar nuestros mensajes.</li>
<li>Autenticación: los sistemas de autenticación intentan resolver una cuestión clave en la informática: <strong>verificar que una máquina es quien dice ser</strong></li>
</ul>
</div>
<div class="section" id="protocolos-criptograficos">
<h3>Protocolos criptográficos.<a class="headerlink" href="#protocolos-criptograficos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En realidad protocolos criptográficos hay muchos, y suelen dividirse en sistemas simétricos o asimétricos.</p>
<ul class="simple">
<li>Los sistemas simétricos son aquellos basados en una función que convierte un mensaje en otro mensaje cifrado. Si se desea descifrar algo se aplica el proceso inverso con la misma clave que se usó.</li>
<li>Los sistemas asimétricos utilizan una clave de cifrado y otra de descifrado. Aunque se tenga una clave es matemáticamente imposible averiguar la otra clave por lo que se puede dar a todo el mundo una de las claves (llamada habitualmente <strong>clave pública</strong>) y conservar la otra (llamada <strong>clave privada</strong>). Además, podemos usar las claves para lo que queramos y por ejemplo en unos casos cifraremos con la clave pública y en otros tal vez cifremos con la clave privada.</li>
</ul>
<p>Hoy por hoy, las mayores garantías las ofrecen los asimétricos, de los cuales hay varios sistemas. El inconveniente que pueden tener los asimétricos es que son más lentos computacionalmente.</p>
<p>En este curso usaremos el cifrado asimétrico RSA.</p>
</div>
<div class="section" id="encriptacion-de-informacion">
<h3>Encriptación de información.<a class="headerlink" href="#encriptacion-de-informacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El siguiente código muestra como crear una clase que permita cifrar y descifrar textos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GestorCifrado</span> <span class="o">{</span>
        <span class="n">KeyPair</span> <span class="n">claves</span><span class="o">;</span>
        <span class="n">KeyPairGenerator</span> <span class="n">generadorClaves</span><span class="o">;</span>
        <span class="n">Cipher</span> <span class="n">cifrador</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">GestorCifrado</span><span class="o">()</span>
                        <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                        <span class="n">NoSuchPaddingException</span><span class="o">{</span>
                <span class="n">generadorClaves</span><span class="o">=</span>
                                <span class="n">KeyPairGenerator</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;RSA&quot;</span><span class="o">);</span>
                <span class="cm">/*Usaremos una longitud de clave</span>
<span class="cm">                 * de 1024 bits */</span>
                <span class="n">generadorClaves</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span><span class="mi">1024</span><span class="o">);</span>
                <span class="n">claves</span><span class="o">=</span><span class="n">generadorClaves</span><span class="o">.</span><span class="na">generateKeyPair</span><span class="o">();</span>
                <span class="n">cifrador</span><span class="o">=</span><span class="n">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;RSA&quot;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">PublicKey</span> <span class="nf">getPublica</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">claves</span><span class="o">.</span><span class="na">getPublic</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">PrivateKey</span> <span class="nf">getPrivada</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">claves</span><span class="o">.</span><span class="na">getPrivate</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">cifrar</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">paraCifrar</span><span class="o">,</span>
                        <span class="n">Key</span> <span class="n">claveCifrado</span>
                        <span class="o">)</span> <span class="kd">throws</span> <span class="n">InvalidKeyException</span><span class="o">,</span>
                        <span class="n">IllegalBlockSizeException</span><span class="o">,</span>
                        <span class="n">BadPaddingException</span><span class="o">{</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">resultado</span><span class="o">;</span>
                <span class="cm">/* Se pone el cifrador en modo cifrado*/</span>
                <span class="n">cifrador</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">ENCRYPT_MODE</span><span class="o">,</span>
                                <span class="n">claveCifrado</span><span class="o">);</span>
                <span class="n">resultado</span><span class="o">=</span><span class="n">cifrador</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">paraCifrar</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">descifrar</span><span class="o">(</span>
                        <span class="kt">byte</span><span class="o">[]</span> <span class="n">paraDescifrar</span><span class="o">,</span>
                        <span class="n">Key</span> <span class="n">claveDescifrado</span><span class="o">)</span>
                                        <span class="kd">throws</span> <span class="n">InvalidKeyException</span><span class="o">,</span>
                                        <span class="n">IllegalBlockSizeException</span><span class="o">,</span>
                                        <span class="n">BadPaddingException</span><span class="o">{</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">resultado</span><span class="o">;</span>
                <span class="cm">/* Se pone el cifrador en modo descifrado*/</span>
                <span class="n">cifrador</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span>
                                <span class="n">claveDescifrado</span><span class="o">);</span>
                <span class="n">resultado</span><span class="o">=</span><span class="n">cifrador</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">paraDescifrar</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>



        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
                        <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                        <span class="n">NoSuchPaddingException</span><span class="o">,</span>
                        <span class="n">InvalidKeyException</span><span class="o">,</span>
                        <span class="n">IllegalBlockSizeException</span><span class="o">,</span>
                        <span class="n">BadPaddingException</span><span class="o">,</span>
                        <span class="n">UnsupportedEncodingException</span>
        <span class="o">{</span>
                <span class="n">GestorCifrado</span> <span class="n">gestorCifrado</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">GestorCifrado</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">mensajeOriginal</span><span class="o">=</span><span class="s">&quot;Hola mundo&quot;</span><span class="o">;</span>
                <span class="n">Key</span> <span class="n">clavePublica</span><span class="o">=</span><span class="n">gestorCifrado</span><span class="o">.</span><span class="na">getPublica</span><span class="o">();</span>

                <span class="kt">byte</span><span class="o">[]</span> <span class="n">mensajeCifrado</span><span class="o">=</span>
                                <span class="n">gestorCifrado</span><span class="o">.</span><span class="na">cifrar</span><span class="o">(</span>
                                                <span class="n">mensajeOriginal</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span>
                                                <span class="n">clavePublica</span>
                <span class="o">);</span>
                <span class="n">String</span> <span class="n">cadCifrada</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">mensajeCifrado</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>

                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span>
                        <span class="o">(</span><span class="s">&quot;Cadena original:&quot;</span><span class="o">+</span><span class="n">mensajeOriginal</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span>
                        <span class="o">(</span><span class="s">&quot;Cadena cifrada:&quot;</span><span class="o">+</span><span class="n">cadCifrada</span><span class="o">);</span>

                <span class="cm">/* Cogemos la cadCifrada y la desciframos</span>
<span class="cm">                 * con la otra clave</span>
<span class="cm">                 */</span>
                <span class="n">Key</span> <span class="n">clavePrivada</span><span class="o">;</span>
                <span class="n">clavePrivada</span><span class="o">=</span><span class="n">gestorCifrado</span><span class="o">.</span><span class="na">getPrivada</span><span class="o">();</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">descifrada</span><span class="o">=</span>
                                <span class="n">gestorCifrado</span><span class="o">.</span><span class="na">descifrar</span><span class="o">(</span>
                                                <span class="n">mensajeCifrado</span><span class="o">,</span><span class="n">clavePrivada</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">mensajeDescifrado</span><span class="o">;</span>
                <span class="n">mensajeDescifrado</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">descifrada</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;El mensaje descifrado es:&quot;</span><span class="o">+</span>
                                                <span class="n">mensajeDescifrado</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los objetos que cifran y descifran en Java utilizan estrictamente objetos <code class="docutils literal"><span class="pre">byte[]</span></code>, que
son los que debemos manejar siempre. Las conversiones a <code class="docutils literal"><span class="pre">String</span></code> las hacemos nosotros para poder visualizar resultados.</p>
</div>
</div>
<div class="section" id="protocolos-seguros-de-comunicaciones">
<h3>Protocolos seguros de comunicaciones.<a class="headerlink" href="#protocolos-seguros-de-comunicaciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En general, ahora que ya conocemos sockets, el uso de servidores y clientes y el uso de la criptografía de clave asimétrica ya es posible crear aplicaciones que se comuniquen de forma muy segura.</p>
<p>En general, todo protocolo que queramos implementar dará estos pasos.</p>
<ol class="arabic simple">
<li>Todo cliente genera su pareja de claves.</li>
<li>Todo servidor genera su pareja de claves.</li>
<li>Cuando un cliente se conecte a un servidor, le envía su clave de cifrado y conserva la de descifrado.</li>
<li>Cuando un servidor recibe la conexión de un cliente recibe la clave de cifrado de dicho cliente.</li>
<li>El servidor envía su clave pública al cliente.</li>
<li>Ahora cliente y servidor pueden enviar mensajes al otro con la garantía de que solo servidor y cliente respectivamente pueden descifrar.</li>
</ol>
<p>En realidad se puede asegurar más el proceso haciendo que en el paso 5 el servidor cifre su propia clave pública con la clave pública del cliente. De esta forma, incluso aunque alguien robara la clave privada del cliente tampoco tendría demasiado, ya que tendría que robar la clave privada del servidor.</p>
</div>
<div class="section" id="programacion-de-aplicaciones-con-comunicaciones-seguras">
<h3>Programación de aplicaciones con comunicaciones seguras.<a class="headerlink" href="#programacion-de-aplicaciones-con-comunicaciones-seguras" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Por fortuna Java dispone de clases ya prefabricadas que facilitan enormemente el que dos aplicaciones intercambios datos de forma segura a través de una red. Se deben considerar los siguientes puntos:</p>
<ul class="simple">
<li>El servidor debe tener su propio certificado. Si no lo tenemos, se puede generar primero una pareja de claves con la herramienta <code class="docutils literal"><span class="pre">keytool</span></code>, como se muestra en la figura adjunta. La herramienta guardará la pareja de claves en un almacén (el cual tiene su propia clave). Despues generaremos un certificado a partir de esa pareja con <code class="docutils literal"><span class="pre">keytool</span> <span class="pre">-export</span> <span class="pre">-file</span> <span class="pre">certificadoservidor.cer</span> <span class="pre">-keystore</span> <span class="pre">almacenclaves</span></code>.</li>
<li>El código del servidor necesitará indicar el fichero donde se almacenan las claves y la clave para acceder a ese almacén.</li>
<li>El cliente necesita indicar que confía en el certificado del servidor. Dicho certificado del servidor puede estar guardado (por ejemplo) en el almacén de claves del cliente.</li>
<li>Aunque no suele hacerse también podría hacerse a la inversa y obligar al cliente a tener un certificado que el servidor pudiera importar, lo que aumentaría la seguridad.</li>
</ul>
<div class="figure align-center" id="id1" style="width: 50%">
<img alt="_images/generacion_clave.png" src="_images/generacion_clave.png" />
<p class="caption"><span class="caption-text">Generando la pareja de claves del servidor.</span></p>
</div>
<p>Los pasos desglosados implican ejecutar estos comandos en el servidor:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># El servidor genera una pareja de claves que se almacena en un</span>
<span class="c1">#fichero llamado &quot;clavesservidor&quot;. Dentro del fichero se indica</span>
<span class="c1">#un alias para poder referirnos a esa clave fácilmente</span>
<span class="n">keytool</span> <span class="o">-</span><span class="n">genkeypair</span> <span class="o">-</span><span class="n">keyalg</span> <span class="n">RSA</span>
     <span class="o">-</span><span class="n">alias</span> <span class="n">servidor</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavesservidor</span>

<span class="c1">#El servidor genera su &quot;certificado&quot;, es decir un fichero que</span>
<span class="c1">#de alguna forma indica quien es él. El certificado se almacena</span>
<span class="c1">#en un fichero llamado clavesservidor y a partir de él queremos</span>
<span class="c1">#generar el certificado de un alias que tiene que haber llamado servidor</span>
<span class="n">keytool</span> <span class="o">--</span><span class="n">exportcert</span> <span class="o">-</span><span class="n">alias</span> <span class="n">servidor</span>
     <span class="o">-</span><span class="n">file</span> <span class="n">servidor</span><span class="o">.</span><span class="n">cer</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavesservidor</span>
</pre></div>
</div>
<p>En el cliente daremos estos pasos:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Se genera una pareja de claves (en realidad no nos hace falta solo</span>
<span class="c1">#queremos tener un almacén de claves.</span>
<span class="n">keytool</span> <span class="o">-</span><span class="n">genkeypair</span> <span class="o">-</span><span class="n">keyalg</span> <span class="n">RSA</span> <span class="o">-</span><span class="n">alias</span> <span class="n">cliente</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavescliente</span>

<span class="c1">#Se importa el certificado del servidor indicando que pertenece a</span>
<span class="c1">#la lista de certificados confiables.</span>
<span class="n">keytool</span> <span class="o">-</span><span class="n">importcert</span> <span class="o">-</span><span class="n">trustcacerts</span> <span class="o">-</span><span class="n">alias</span> <span class="n">servidor</span> <span class="o">-</span><span class="n">file</span> <span class="n">servidor</span><span class="o">.</span><span class="n">cer</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavescliente</span>
</pre></div>
</div>
<p>Una vez creados los ficheros iniciales se deben dar los siguientes pasos en Java (servidor y cliente van por separado):</p>
<ol class="arabic simple">
<li>El servidor debe cargar su almacén de claves (el fichero <code class="docutils literal"><span class="pre">clavesservidor</span></code>)</li>
<li>Ese almacén (cargado en un objeto Java llamado <code class="docutils literal"><span class="pre">KeyStore</span></code>), se usará para crear un gestor de claves (objeto <code class="docutils literal"><span class="pre">KeyManager</span></code>), el cual se obtiene a partir de una &#8220;fábrica&#8221; llamada <code class="docutils literal"><span class="pre">KeyManagerFactory</span></code>.</li>
<li>Se creará un contexto SSL (objeto <code class="docutils literal"><span class="pre">SSLContext</span></code>) a partir de la fábrica comentada.</li>
<li>El objeto <code class="docutils literal"><span class="pre">SSLContext</span></code> permitirá crear una fábrica de sockets que será la que finalmente nos permita tener un <code class="docutils literal"><span class="pre">SSLServerSocket</span></code>, es decir un socket de servidor que usará cifrado.</li>
</ol>
<p>El código Java del servidor sería algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="nf">OtroServidor</span> <span class="o">(</span><span class="n">String</span> <span class="n">rutaAlmacen</span><span class="o">,</span> <span class="n">String</span> <span class="n">claveAlmacen</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">rutaAlmacen</span><span class="o">=</span><span class="n">rutaAlmacen</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">claveAlmacen</span><span class="o">=</span><span class="n">claveAlmacen</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">SSLServerSocket</span> <span class="nf">getServerSocketSeguro</span><span class="o">()</span>
                    <span class="kd">throws</span> <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                    <span class="n">CertificateException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span>
                    <span class="n">KeyManagementException</span><span class="o">,</span> <span class="n">UnrecoverableKeyException</span>
    <span class="o">{</span>
            <span class="n">SSLServerSocket</span> <span class="n">serverSocket</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
            <span class="cm">/* Paso 1, se carga el almacén de claves*/</span>
            <span class="n">FileInputStream</span> <span class="n">fichAlmacen</span><span class="o">=</span>
                            <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">rutaAlmacen</span><span class="o">);</span>
            <span class="cm">/* Paso 1.1, se crea un almacén del tipo por defecto</span>
<span class="cm">             * que es un JKS (Java Key Store), a día de hoy*/</span>
            <span class="n">KeyStore</span> <span class="n">almacen</span><span class="o">=</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getDefaultType</span><span class="o">());</span>
            <span class="n">almacen</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">fichAlmacen</span><span class="o">,</span> <span class="n">claveAlmacen</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
            <span class="cm">/* Paso 2: obtener una fábrica de KeyManagers que ofrezcan</span>
<span class="cm">             * soporte al algoritmo por defecto*/</span>
            <span class="n">KeyManagerFactory</span> <span class="n">fabrica</span><span class="o">=</span>
                            <span class="n">KeyManagerFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span>
                                <span class="n">KeyManagerFactory</span><span class="o">.</span><span class="na">getDefaultAlgorithm</span><span class="o">());</span>
            <span class="n">fabrica</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">almacen</span><span class="o">,</span> <span class="n">claveAlmacen</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
            <span class="cm">/* Paso 3:Intentamos obtener un contexto SSL</span>
<span class="cm">             * que ofrezca soporte a TLS (el sistema más</span>
<span class="cm">             * seguro hoy día) */</span>
            <span class="n">SSLContext</span> <span class="n">contextoSSL</span><span class="o">=</span><span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>
            <span class="n">contextoSSL</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">fabrica</span><span class="o">.</span><span class="na">getKeyManagers</span><span class="o">(),</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="cm">/* Paso 4: Se obtiene una fábrica de sockets que permita</span>
<span class="cm">             * obtener un SSLServerSocket */</span>
            <span class="n">SSLServerSocketFactory</span> <span class="n">fabricaSockets</span><span class="o">=</span>
                            <span class="n">contextoSSL</span><span class="o">.</span><span class="na">getServerSocketFactory</span><span class="o">();</span>
            <span class="n">serverSocket</span><span class="o">=</span>
                    <span class="o">(</span><span class="n">SSLServerSocket</span><span class="o">)</span>
                            <span class="n">fabricaSockets</span><span class="o">.</span><span class="na">createServerSocket</span><span class="o">(</span><span class="n">puerto</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">serverSocket</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">()</span>
        <span class="kd">throws</span> <span class="n">KeyManagementException</span><span class="o">,</span> <span class="n">UnrecoverableKeyException</span><span class="o">,</span>
            <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
            <span class="n">CertificateException</span><span class="o">,</span> <span class="n">IOException</span>
    <span class="o">{</span>
            <span class="n">SSLServerSocket</span> <span class="n">socketServidor</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">getServerSocketSeguro</span><span class="o">();</span>
            <span class="n">BufferedReader</span> <span class="n">entrada</span><span class="o">;</span>
            <span class="n">PrintWriter</span> <span class="n">salida</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                    <span class="n">Socket</span> <span class="n">connRecibida</span><span class="o">=</span><span class="n">socketServidor</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion segura recibida&quot;</span><span class="o">);</span>
                    <span class="n">entrada</span><span class="o">=</span>
                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span>
                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">connRecibida</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
                    <span class="n">salida</span><span class="o">=</span>
                        <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span>
                            <span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span>
                            <span class="n">connRecibida</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()));</span>
                    <span class="n">String</span> <span class="n">linea</span><span class="o">=</span><span class="n">entrada</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                    <span class="n">salida</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
                    <span class="n">salida</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
</div>
<p>En el cliente se tienen que dar algunos pasos parecidos:</p>
<ol class="arabic simple">
<li>En primer lugar se carga el almacén de claves del cliente (que contiene el certificado del servidor y que es la clave para poder &#8220;autenticar&#8221; el servidor)</li>
<li>El almacén del cliente se usará para crear un &#8220;gestor de confianza&#8221; (<code class="docutils literal"><span class="pre">TrustManager</span></code>) que Java usará para determinar si puede confiar o no en una conexión. Usaremos un <code class="docutils literal"><span class="pre">TrustManagerFactory</span></code> que usará el almacén del cliente para crear objetos que puedan gestionar la confianza.</li>
<li>Se creará un contexto SSL (<code class="docutils literal"><span class="pre">SSLContext</span></code>) que se basará en los <code class="docutils literal"><span class="pre">TrustManager</span></code> que pueda crear la fábrica.</li>
<li>A partir del contexto SSL el cliente ya puede crear un socket seguro (<code class="docutils literal"><span class="pre">SSLSocket</span></code>) que puede usar para conectar con el servidor de forma segura.</li>
</ol>
<p>El código del cliente sería algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OtroCliente</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">almacen</span><span class="o">=</span><span class="s">&quot;/home/usuario/clavescliente&quot;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">clave</span><span class="o">=</span><span class="s">&quot;abcdabcd&quot;</span><span class="o">;</span>
    <span class="n">SSLSocket</span> <span class="n">conexion</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">OtroCliente</span><span class="o">(</span><span class="n">String</span> <span class="n">ip</span><span class="o">,</span> <span class="kt">int</span> <span class="n">puerto</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="n">UnknownHostException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span>
                    <span class="n">KeyManagementException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                    <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">CertificateException</span><span class="o">{</span>

            <span class="n">conexion</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">obtenerSocket</span><span class="o">(</span><span class="n">ip</span><span class="o">,</span><span class="n">puerto</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/* Envía un mensaje de prueba para verificar que la conexión</span>
<span class="cm">     * SSL es correcta */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">conectar</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Iniciando..&quot;</span><span class="o">);</span>
            <span class="n">BufferedReader</span> <span class="n">entrada</span><span class="o">;</span>
            <span class="n">PrintWriter</span> <span class="n">salida</span><span class="o">;</span>
            <span class="n">entrada</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">conexion</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
            <span class="n">salida</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">conexion</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()));</span>
            <span class="cm">/* De esta linea se intenta averiguar la longitud*/</span>
            <span class="n">salida</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;1234567890&quot;</span><span class="o">);</span>
            <span class="n">salida</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="cm">/* Si todo va bien, el servidor nos contesta el numero*/</span>
            <span class="n">String</span> <span class="n">num</span><span class="o">=</span><span class="n">entrada</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">longitud</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;La longitud devuelta es:&quot;</span><span class="o">+</span><span class="n">longitud</span><span class="o">);</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">SSLSocket</span> <span class="nf">obtenerSocket</span><span class="o">(</span><span class="n">String</span> <span class="n">ip</span><span class="o">,</span> <span class="kt">int</span> <span class="n">puerto</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                    <span class="n">CertificateException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">KeyManagementException</span>
    <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Obteniendo socket&quot;</span><span class="o">);</span>
            <span class="n">SSLSocket</span> <span class="n">socket</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
            <span class="cm">/* Paso 1: se carga al almacén de claves</span>
<span class="cm">             * (que recordemos debe contener el</span>
<span class="cm">             * certificado del servidor)*/</span>
            <span class="n">KeyStore</span> <span class="n">almacenCliente</span><span class="o">=</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getDefaultType</span><span class="o">());</span>
            <span class="n">FileInputStream</span> <span class="n">ficheroAlmacenClaves</span><span class="o">=</span>
                            <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span> <span class="k">this</span><span class="o">.</span><span class="na">almacen</span> <span class="o">);</span>
            <span class="n">almacenCliente</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">ficheroAlmacenClaves</span><span class="o">,</span> <span class="n">clave</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Almacen cargado&quot;</span><span class="o">);</span>
            <span class="cm">/* Paso 2, crearemos una fabrica de gestores de confianza</span>
<span class="cm">             * que use el almacén cargado antes (que contiene el</span>
<span class="cm">             * certificado del servidor)</span>
<span class="cm">             */</span>
            <span class="n">TrustManagerFactory</span> <span class="n">fabricaGestoresConfianza</span><span class="o">=</span>
                            <span class="n">TrustManagerFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span>
                                            <span class="n">TrustManagerFactory</span><span class="o">.</span><span class="na">getDefaultAlgorithm</span><span class="o">());</span>
            <span class="n">fabricaGestoresConfianza</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">almacenCliente</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fabrica Trust creada&quot;</span><span class="o">);</span>
            <span class="cm">/*Paso 3: se crea el contexto SSL, que ofrezca</span>
<span class="cm">             * soporte al algoritmo TLS*/</span>
            <span class="n">SSLContext</span> <span class="n">contexto</span><span class="o">=</span><span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>
            <span class="n">contexto</span><span class="o">.</span><span class="na">init</span><span class="o">(</span>
                            <span class="kc">null</span><span class="o">,</span> <span class="n">fabricaGestoresConfianza</span><span class="o">.</span><span class="na">getTrustManagers</span><span class="o">(),</span> <span class="kc">null</span><span class="o">);</span>
            <span class="cm">/* Paso 4: Se crea un socket que conecte con el servidor*/</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Contexto creado&quot;</span><span class="o">);</span>
            <span class="n">SSLSocketFactory</span> <span class="n">fabricaSockets</span><span class="o">=</span>
                            <span class="n">contexto</span><span class="o">.</span><span class="na">getSocketFactory</span><span class="o">();</span>
            <span class="n">socket</span><span class="o">=(</span><span class="n">SSLSocket</span><span class="o">)</span> <span class="n">fabricaSockets</span><span class="o">.</span><span class="na">createSocket</span><span class="o">(</span><span class="n">ip</span><span class="o">,</span> <span class="n">puerto</span><span class="o">);</span>
            <span class="cm">/* Y devolvemos el socket*/</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Socket creado&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">socket</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="firmado-de-aplicaciones">
<h3>Firmado de aplicaciones<a class="headerlink" href="#firmado-de-aplicaciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Utilizando la criptografía de clave pública es posible &#8220;firmar&#8221; aplicaciones. El firmado es un mecanismo que permite al usuario de una aplicación el verificar que la aplicación no ha sido alterada desde que el programador la creó (virus o programas malignos, personal descontento con la empresa, etc...).</p>
<p>Antes de efectuar el firmado se debe disponer de un par de claves generadas con la herramienta <code class="docutils literal"><span class="pre">keytool</span></code> mencionada anteriormente. Supongamos que el almacén de claves está creado y que en él hay uno o varios <em>alias</em> creados. El proceso de firmado es el siguiente:</p>
<ol class="arabic simple">
<li>Crear la aplicación, que puede estar formada por un conjunto de clases pero que en última instancia tendrá un <code class="docutils literal"><span class="pre">main</span></code>.</li>
<li>Empaquetar la aplicación con <code class="docutils literal"><span class="pre">jar</span> <span class="pre">cfe</span> <span class="pre">Aplicacion.jar</span> <span class="pre">com.ies.Aplicacion</span> <span class="pre">DirectorioPaquete</span></code>. Este comando crea un fichero (<code class="docutils literal"><span class="pre">f</span></code>) JAR en el cual el punto de entrada (<code class="docutils literal"><span class="pre">e</span></code>) es la clase <code class="docutils literal"><span class="pre">com.ies.Aplicacion</span></code> (que es la que tendrá el <code class="docutils literal"><span class="pre">main</span></code>).</li>
<li>Puede comprobarse que la aplicación dentro del JAR se ejecuta correctamente con <code class="docutils literal"><span class="pre">java</span> <span class="pre">-jar</span> <span class="pre">Aplicacion.jar</span></code>.</li>
<li>Ahora se puede ejecutar <code class="docutils literal"><span class="pre">jarsigner</span> <span class="pre">Aplicacion.jar</span> <span class="pre">&lt;alias&gt;</span></code>.</li>
</ol>
<p>Con estos pasos se tiene un aplicación firmada que el usuario puede verificar si así lo desea. De hecho, si se extrae el contenido del JAR con <code class="docutils literal"><span class="pre">jar</span> <span class="pre">-xf</span> <span class="pre">Aplicacion.jar</span></code> se extraen los archivos <code class="docutils literal"><span class="pre">.class</span></code> y un fichero <code class="docutils literal"><span class="pre">META-INF/Manifest</span></code> que se puede abrir con un editor para ver que realmente está firmado.</p>
<p>Para que otras personas puedan comprobar que nuestra aplicacion es correcta los programadores deberemos exportar un certificado que los usuarios puedan importar para hacer el verificado. Recordemos que el comando es:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">keytool</span> <span class="o">-</span><span class="n">exportcert</span> <span class="o">-</span><span class="n">keystore</span> <span class="o">..</span>\<span class="n">Almacen</span><span class="o">.</span><span class="n">store</span> <span class="o">-</span><span class="n">file</span> <span class="n">Programador</span><span class="o">.</span><span class="n">cer</span> <span class="o">-</span><span class="n">alias</span> <span class="n">Programador</span>
</pre></div>
</div>
</div>
<div class="section" id="verificado-de-aplicaciones">
<h3>Verificado de aplicaciones<a class="headerlink" href="#verificado-de-aplicaciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Si ahora otro usuario desea ejecutar nuestra aplicación deberá importar nuestro certificado. El proceso de verificado es simple:</p>
<ol class="arabic simple">
<li>El usuario importa el certificado.</li>
<li>Ahora que tiene el certificado puede comprobar la aplicación con <code class="docutils literal"><span class="pre">jarsigner</span> <span class="pre">-verify</span> <span class="pre">Aplicacion.jar</span> <span class="pre">&lt;alias_del_programador&gt;</span></code></li>
</ol>
<p>El comando deberá responder con algo como <code class="docutils literal"><span class="pre">jar</span> <span class="pre">verified</span></code>. Sin embargo si no tenemos un certificado firmado por alguna autoridad de certificación (CA) la herramienta se quejará de que algunos criterios de seguridad no se cumplen.</p>
</div>
<div class="section" id="ejercicio">
<h3>Ejercicio<a class="headerlink" href="#ejercicio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Intenta extraer el archivo JAR y reemplaza el <code class="docutils literal"><span class="pre">.class</span></code> por alguna otra clase. Vuelve a crear el archivo .JAR y vuelve a intentar verificarlo, ¿qué ocurre?</p>
</div>
<div class="section" id="recordatorio">
<h3>Recordatorio<a class="headerlink" href="#recordatorio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Hemos hecho el proceso de firmado y verificado con <strong>certificados autofirmados</strong>, lo cual es útil para practicar pero <strong>completamente inútil desde el punto de vista de la seguridad</strong>. Para que un certificado sea seguro debemos hacer que previamente alguna autoridad de certificación nos lo firme primero (para lo cual suele ser habitual el tener que pagar).</p>
</div>
<div class="section" id="politica-de-seguridad">
<h3>Política de seguridad.<a class="headerlink" href="#politica-de-seguridad" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="programacion-de-mecanismos-de-control-de-acceso">
<h3>Programación de mecanismos de control de acceso.<a class="headerlink" href="#programacion-de-mecanismos-de-control-de-acceso" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
<div class="section" id="pruebas-y-depuracion">
<h3>Pruebas y depuración.<a class="headerlink" href="#pruebas-y-depuracion" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
</div>
<span id="document-textos/anexos"></span><div class="section" id="anexos">
<h2>Anexos<a class="headerlink" href="#anexos" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="la-clase-utilidadesficheros">
<h3>La clase <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code><a class="headerlink" href="#la-clase-utilidadesficheros" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A continuación se muestra el código completo de la clase <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code>:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UtilidadesFicheros</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedReader</span> <span class="nf">getBufferedReader</span><span class="o">(</span>
        <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span>
    <span class="n">FileNotFoundException</span> <span class="o">{</span>
        <span class="n">FileReader</span> <span class="n">lector</span><span class="o">;</span>
        <span class="n">lector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
        <span class="n">BufferedReader</span> <span class="n">bufferedReader</span><span class="o">;</span>
        <span class="n">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">lector</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bufferedReader</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">PrintWriter</span> <span class="nf">getPrintWriter</span><span class="o">(</span>
        <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">PrintWriter</span> <span class="n">printWriter</span><span class="o">;</span>
        <span class="n">FileWriter</span> <span class="n">fileWriter</span><span class="o">;</span>
        <span class="n">fileWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
        <span class="n">printWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">fileWriter</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">printWriter</span><span class="o">;</span>
        <span class="c1">//Fin de getPrintWriter</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLineasFichero</span><span class="o">(</span>
        <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">BufferedReader</span> <span class="n">bfr</span> <span class="o">=</span> <span class="n">getBufferedReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
        <span class="c1">//Leemos líneas del fichero...</span>
        <span class="n">String</span> <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">linea</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//Y las añadimos al array</span>
            <span class="n">lineas</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
            <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">//Fin del bucle que lee líneas</span>
        <span class="k">return</span> <span class="n">lineas</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//Fin de getLineasFichero</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">getSuma</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span>
                               <span class="n">listaNombresFichero</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">suma</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">lineaCantidad</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">cantidad</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">nombreFichero</span> <span class="o">:</span> <span class="n">listaNombresFichero</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">//Recuperamos todas las lineas</span>
                <span class="n">lineas</span> <span class="o">=</span> <span class="n">getLineasFichero</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
                <span class="c1">//Pero solo nos interesa la primera</span>
                <span class="n">lineaCantidad</span> <span class="o">=</span> <span class="n">lineas</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="c1">//Convertimos la linea a número</span>
                <span class="n">cantidad</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">lineaCantidad</span><span class="o">);</span>
                <span class="c1">//Y se incrementa la suma total</span>
                <span class="n">suma</span> <span class="o">=</span> <span class="n">suma</span> <span class="o">+</span> <span class="n">cantidad</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fallo al procesar el fichero &quot;</span>
                                   <span class="o">+</span> <span class="n">nombreFichero</span><span class="o">);</span>
                <span class="c1">//Fin del catch</span>
            <span class="o">}</span>
            <span class="c1">//Fin del for que recorre los nombres de fichero</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html#document-index">Tabla de Contenidos</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-textos/tema1">﻿Programación multiproceso</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#ejecutables-procesos-servicios">Ejecutables. Procesos. Servicios.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hilos">Hilos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-concurrente">Programación concurrente.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-paralela-y-distribuida">Programación paralela y distribuida.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creacion-de-procesos">Creación de procesos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#comunicacion-entre-procesos">Comunicación entre procesos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ejercicio">Ejercicio</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ejercicio-resuelto">Ejercicio resuelto</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#lanzamiento-de-los-procesos">Lanzamiento de los procesos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ejercicio-propuesto-i">Ejercicio propuesto (I)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#gestion-de-procesos">Gestión de procesos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#comandos-para-la-gestion-de-procesos-en-sistemas-libres-y-propietarios">Comandos para la gestión de procesos en sistemas libres y propietarios.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sincronizacion-entre-procesos">Sincronización entre procesos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#documentacion">Documentación</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#depuracion">Depuración.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#examen">Examen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-textos/tema2">﻿Programación multihilo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#recursos-compartidos-por-los-hilos">Recursos compartidos por los hilos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#estados-de-un-hilo-cambios-de-estado">Estados de un hilo. Cambios de estado.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#elementos-relacionados-con-la-programacion-de-hilos-librerias-y-clases">Elementos relacionados con la programación de hilos. Librerías y clases.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#gestion-de-hilos">Gestión de hilos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creacion-inicio-y-finalizacion">Creación, inicio y finalización.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sincronizacion-de-hilos">Sincronización de hilos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#informacion-entre-hilos">Información entre hilos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#prioridades-de-los-hilos">Prioridades de los hilos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#gestion-de-prioridades">Gestión de prioridades.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-de-aplicaciones-multihilo">Programación de aplicaciones multihilo.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#problema">Problema</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#solucion-completa-al-problema-de-los-filosofos">Solución completa al problema de los filósofos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Problema</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#una-mala-solucion-al-problema-de-los-barberos">Una (mala) solución al problema de los barberos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#problema-productores-y-consumidores">Problema: productores y consumidores.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#solucion">Solución</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ejercicio">Ejercicio</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#documentacion">Documentación.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#depuracion">Depuración.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-textos/tema3">﻿Programación de comunicaciones en red</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#comunicacion-entre-aplicaciones">Comunicación entre aplicaciones.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#roles-cliente-y-servidor">Roles cliente y servidor.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#recordatorio-de-los-flujos-en-java">Recordatorio de los flujos en Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#elementos-de-programacion-de-aplicaciones-en-red-librerias">Elementos de programación de aplicaciones en red. Librerías.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#funciones-y-objetos-de-las-librerias">Funciones y objetos de las librerías.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sockets">Sockets.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creacion-de-sockets">Creación de sockets.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#enlazado-y-establecimiento-de-conexiones">Enlazado y establecimiento de conexiones.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#utilizacion-de-sockets-para-la-transmision-y-recepcion-de-informacion">Utilización de sockets para la transmisión y recepción de información.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-de-aplicaciones-cliente-y-servidor">Programación de aplicaciones cliente y servidor.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#utilizacion-de-hilos-en-la-programacion-de-aplicaciones-en-red">Utilización de hilos en la programación de aplicaciones en red.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-textos/tema4">﻿Generación de servicios en red</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#protocolos-estandar-de-comunicacion-en-red-a-nivel-de-aplicacion">Protocolos estándar de comunicación en red a nivel de aplicación</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#librerias-de-clases-y-componentes">Librerías de clases y componentes.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#utilizacion-de-objetos-predefinidos">Utilización de objetos predefinidos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#propiedades-de-los-objetos-predefinidos">Propiedades de los objetos predefinidos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#metodos-y-eventos-de-los-objetos-predefinidos">Métodos y eventos de los objetos predefinidos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#establecimiento-y-finalizacion-de-conexiones">Establecimiento y finalización de conexiones.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#transmision-de-informacion">Transmisión de información.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-de-aplicaciones-cliente">Programación de aplicaciones cliente.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-de-servidores">Programación de servidores.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#implementacion-de-comunicaciones-simultaneas">Implementación de comunicaciones simultáneas.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#documentacion">Documentación.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#depuracion">Depuración.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#monitorizacion-de-tiempos-de-respuesta">Monitorización de tiempos de respuesta.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-textos/tema5">﻿Utilización de técnicas de programación segura</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduccion">Introducción</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#practicas-de-programacion-segura">Prácticas de programación segura.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#criptografia-de-clave-publica-y-clave-privada">Criptografía de clave pública y clave privada.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#principales-aplicaciones-de-la-criptografia">Principales aplicaciones de la criptografía.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#protocolos-criptograficos">Protocolos criptográficos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#encriptacion-de-informacion">Encriptación de información.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#protocolos-seguros-de-comunicaciones">Protocolos seguros de comunicaciones.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-de-aplicaciones-con-comunicaciones-seguras">Programación de aplicaciones con comunicaciones seguras.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#firmado-de-aplicaciones">Firmado de aplicaciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#verificado-de-aplicaciones">Verificado de aplicaciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ejercicio">Ejercicio</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#recordatorio">Recordatorio</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#politica-de-seguridad">Política de seguridad.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#programacion-de-mecanismos-de-control-de-acceso">Programación de mecanismos de control de acceso.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pruebas-y-depuracion">Pruebas y depuración.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-textos/anexos">Anexos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#la-clase-utilidadesficheros">La clase <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code></a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html#document-index">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, Oscar Gomez.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
    </div>

    

    
  </body>
</html>