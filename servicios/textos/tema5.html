<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Utilización de técnicas de programación segura &#8212; Apuntes de Lenguajes de Marcas v1.3</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="Apuntes de Lenguajes de Marcas v1.3" href="../index.html" />
    <link rel="next" title="Anexos" href="anexos.html" />
    <link rel="prev" title="Generación de servicios en red" href="tema4.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="utilizacion-de-tecnicas-de-programacion-segura">
<h1>Utilización de técnicas de programación segura<a class="headerlink" href="#utilizacion-de-tecnicas-de-programacion-segura" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En general, cuando se envía algo a través de sockets se envía como &#8220;texto plano&#8221;, es decir, no sabemos si hay alguien usando un sniffer en la red y por tanto no sabemos si alguien está capturando los datos.</p>
<p>En general, cualquier sistema que pretenda ser seguro necesitará usar cifrado.</p>
</div>
<div class="section" id="practicas-de-programacion-segura">
<h2>Prácticas de programación segura.<a class="headerlink" href="#practicas-de-programacion-segura" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para enviar mensajes cifrados se necesita algún mecanismo o algoritmo para convertir un texto normal en uno más difícil de comprender.</p>
<p>El esquema general de todos los métodos es tener código como el siguiente:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">cifrar</span> <span class="o">(</span><span class="n">String</span> <span class="n">texto</span><span class="o">,</span> <span class="n">String</span> <span class="n">clave</span><span class="o">)</span>
<span class="o">{</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="n">String</span> <span class="nf">descifrar</span><span class="o">(</span><span class="n">String</span> <span class="n">texto</span><span class="o">,</span><span class="n">String</span> <span class="n">clave</span><span class="o">)</span>
<span class="o">{</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="metodo-cesar">
<h3>Método César<a class="headerlink" href="#metodo-cesar" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Si el alfabeto es el siguiente:</p>
<p>ABCDEFGHIJKLMNÑOPQRSTUVWXYZ0123456789-
BCDEFGHIJKLMNÑOPQRSTUVWXYZ0123456789-A</p>
<p>El mensaje HOLA MUNDO, con clave 1 sería así</p>
<blockquote>
<div>HOLAMUNDO
IPMBNVÑEP</div></blockquote>
<p>El descifrado simplemente implicaría el método inverso. Si el desplazamiento es un valor distinto de 1, lo único que hay que hacer es construir el alfabeto rotado tantas veces como el desplazamiento</p>
<p>Esta clase implementa un sistema de rotado básico para poder efectuar</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cifrador</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">alfabeto</span><span class="o">=</span>
                        <span class="s">&quot;ABCDEFGHIJKLMNÑOPQRSTUVWXYZ&quot;</span><span class="o">+</span>
                        <span class="s">&quot;0123456789 &quot;</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">alfabetoCifrado</span><span class="o">;</span>
        <span class="cm">/* Dada una cadena como</span>
<span class="cm">         * &quot;ABC&quot; y un número (p.ej 2)</span>
<span class="cm">         * devuelve la cadena rotada a la izq</span>
<span class="cm">         * tantas veces como indique el numero,</span>
<span class="cm">         * en este caso &quot;CAB&quot;</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">rotar</span><span class="o">(</span><span class="n">String</span> <span class="n">cad</span><span class="o">,</span><span class="kt">int</span> <span class="n">numVeces</span><span class="o">){</span>
                <span class="kt">char</span><span class="o">[]</span> <span class="n">resultado</span><span class="o">=</span><span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">cad</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cad</span><span class="o">.</span><span class="na">length</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                        <span class="kt">int</span> <span class="n">posParaExtraer</span><span class="o">=(</span><span class="n">i</span><span class="o">+</span><span class="n">numVeces</span><span class="o">)%</span><span class="n">cad</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
                        <span class="n">resultado</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">cad</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">posParaExtraer</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">String</span> <span class="n">cadResultado</span><span class="o">=</span><span class="n">String</span><span class="o">.</span><span class="na">copyValueOf</span><span class="o">(</span><span class="n">resultado</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">cadResultado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">cifrar</span>
                <span class="o">(</span><span class="n">String</span> <span class="n">mensaje</span><span class="o">,</span> <span class="n">String</span> <span class="n">clave</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">mensajeCifrado</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">;</span>

                <span class="k">return</span> <span class="n">mensajeCifrado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">descifrar</span>
                <span class="o">(</span><span class="n">String</span> <span class="n">mensajeCifrado</span><span class="o">,</span> <span class="n">String</span> <span class="n">clave</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">mensajeDescifrado</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">;</span>

                <span class="k">return</span> <span class="n">mensajeDescifrado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Cifrador</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">Cifrador</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">cad</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="na">rotar</span><span class="o">(</span><span class="s">&quot;ABCDEFG&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cad</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="criptografia-de-clave-publica-y-clave-privada">
<h2>Criptografía de clave pública y clave privada.<a class="headerlink" href="#criptografia-de-clave-publica-y-clave-privada" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los principales sistemas modernos de seguridad utilizan dos claves ,una para cifrar y otra para descifrar. Esto se puede usar de diversas formas.</p>
</div>
<div class="section" id="principales-aplicaciones-de-la-criptografia">
<h2>Principales aplicaciones de la criptografía.<a class="headerlink" href="#principales-aplicaciones-de-la-criptografia" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li>Mensajería segura: todo el mundo da su clave de cifrado pero conserva la de descifrado. Si queremos enviar un mensaje a alguien cogemos su clave de cifrado y ciframos el mensaje que le enviamos. Solo él podrá descifrarlo.</li>
<li>Firma digital: pilar del comercio electrónico. Permite verificar que un archivo no ha sido modificado.</li>
<li>Mensajería segura: en este tipo de mensajería se intenta evitar que un atacante (quizá con un <em>sniffer</em>) consiga descifrar nuestros mensajes.</li>
<li>Autenticación: los sistemas de autenticación intentan resolver una cuestión clave en la informática: <strong>verificar que una máquina es quien dice ser</strong></li>
</ul>
</div>
<div class="section" id="protocolos-criptograficos">
<h2>Protocolos criptográficos.<a class="headerlink" href="#protocolos-criptograficos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En realidad protocolos criptográficos hay muchos, y suelen dividirse en sistemas simétricos o asimétricos.</p>
<ul class="simple">
<li>Los sistemas simétricos son aquellos basados en una función que convierte un mensaje en otro mensaje cifrado. Si se desea descifrar algo se aplica el proceso inverso con la misma clave que se usó.</li>
<li>Los sistemas asimétricos utilizan una clave de cifrado y otra de descifrado. Aunque se tenga una clave es matemáticamente imposible averiguar la otra clave por lo que se puede dar a todo el mundo una de las claves (llamada habitualmente <strong>clave pública</strong>) y conservar la otra (llamada <strong>clave privada</strong>). Además, podemos usar las claves para lo que queramos y por ejemplo en unos casos cifraremos con la clave pública y en otros tal vez cifremos con la clave privada.</li>
</ul>
<p>Hoy por hoy, las mayores garantías las ofrecen los asimétricos, de los cuales hay varios sistemas. El inconveniente que pueden tener los asimétricos es que son más lentos computacionalmente.</p>
<p>En este curso usaremos el cifrado asimétrico RSA.</p>
</div>
<div class="section" id="encriptacion-de-informacion">
<h2>Encriptación de información.<a class="headerlink" href="#encriptacion-de-informacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El siguiente código muestra como crear una clase que permita cifrar y descifrar textos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GestorCifrado</span> <span class="o">{</span>
        <span class="n">KeyPair</span> <span class="n">claves</span><span class="o">;</span>
        <span class="n">KeyPairGenerator</span> <span class="n">generadorClaves</span><span class="o">;</span>
        <span class="n">Cipher</span> <span class="n">cifrador</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">GestorCifrado</span><span class="o">()</span>
                        <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                        <span class="n">NoSuchPaddingException</span><span class="o">{</span>
                <span class="n">generadorClaves</span><span class="o">=</span>
                                <span class="n">KeyPairGenerator</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;RSA&quot;</span><span class="o">);</span>
                <span class="cm">/*Usaremos una longitud de clave</span>
<span class="cm">                 * de 1024 bits */</span>
                <span class="n">generadorClaves</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span><span class="mi">1024</span><span class="o">);</span>
                <span class="n">claves</span><span class="o">=</span><span class="n">generadorClaves</span><span class="o">.</span><span class="na">generateKeyPair</span><span class="o">();</span>
                <span class="n">cifrador</span><span class="o">=</span><span class="n">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;RSA&quot;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">PublicKey</span> <span class="nf">getPublica</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">claves</span><span class="o">.</span><span class="na">getPublic</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">PrivateKey</span> <span class="nf">getPrivada</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">claves</span><span class="o">.</span><span class="na">getPrivate</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">cifrar</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">paraCifrar</span><span class="o">,</span>
                        <span class="n">Key</span> <span class="n">claveCifrado</span>
                        <span class="o">)</span> <span class="kd">throws</span> <span class="n">InvalidKeyException</span><span class="o">,</span>
                        <span class="n">IllegalBlockSizeException</span><span class="o">,</span>
                        <span class="n">BadPaddingException</span><span class="o">{</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">resultado</span><span class="o">;</span>
                <span class="cm">/* Se pone el cifrador en modo cifrado*/</span>
                <span class="n">cifrador</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">ENCRYPT_MODE</span><span class="o">,</span>
                                <span class="n">claveCifrado</span><span class="o">);</span>
                <span class="n">resultado</span><span class="o">=</span><span class="n">cifrador</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">paraCifrar</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">descifrar</span><span class="o">(</span>
                        <span class="kt">byte</span><span class="o">[]</span> <span class="n">paraDescifrar</span><span class="o">,</span>
                        <span class="n">Key</span> <span class="n">claveDescifrado</span><span class="o">)</span>
                                        <span class="kd">throws</span> <span class="n">InvalidKeyException</span><span class="o">,</span>
                                        <span class="n">IllegalBlockSizeException</span><span class="o">,</span>
                                        <span class="n">BadPaddingException</span><span class="o">{</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">resultado</span><span class="o">;</span>
                <span class="cm">/* Se pone el cifrador en modo descifrado*/</span>
                <span class="n">cifrador</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span>
                                <span class="n">claveDescifrado</span><span class="o">);</span>
                <span class="n">resultado</span><span class="o">=</span><span class="n">cifrador</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">paraDescifrar</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>



        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
                        <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                        <span class="n">NoSuchPaddingException</span><span class="o">,</span>
                        <span class="n">InvalidKeyException</span><span class="o">,</span>
                        <span class="n">IllegalBlockSizeException</span><span class="o">,</span>
                        <span class="n">BadPaddingException</span><span class="o">,</span>
                        <span class="n">UnsupportedEncodingException</span>
        <span class="o">{</span>
                <span class="n">GestorCifrado</span> <span class="n">gestorCifrado</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">GestorCifrado</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">mensajeOriginal</span><span class="o">=</span><span class="s">&quot;Hola mundo&quot;</span><span class="o">;</span>
                <span class="n">Key</span> <span class="n">clavePublica</span><span class="o">=</span><span class="n">gestorCifrado</span><span class="o">.</span><span class="na">getPublica</span><span class="o">();</span>

                <span class="kt">byte</span><span class="o">[]</span> <span class="n">mensajeCifrado</span><span class="o">=</span>
                                <span class="n">gestorCifrado</span><span class="o">.</span><span class="na">cifrar</span><span class="o">(</span>
                                                <span class="n">mensajeOriginal</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span>
                                                <span class="n">clavePublica</span>
                <span class="o">);</span>
                <span class="n">String</span> <span class="n">cadCifrada</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">mensajeCifrado</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>

                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span>
                        <span class="o">(</span><span class="s">&quot;Cadena original:&quot;</span><span class="o">+</span><span class="n">mensajeOriginal</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span>
                        <span class="o">(</span><span class="s">&quot;Cadena cifrada:&quot;</span><span class="o">+</span><span class="n">cadCifrada</span><span class="o">);</span>

                <span class="cm">/* Cogemos la cadCifrada y la desciframos</span>
<span class="cm">                 * con la otra clave</span>
<span class="cm">                 */</span>
                <span class="n">Key</span> <span class="n">clavePrivada</span><span class="o">;</span>
                <span class="n">clavePrivada</span><span class="o">=</span><span class="n">gestorCifrado</span><span class="o">.</span><span class="na">getPrivada</span><span class="o">();</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">descifrada</span><span class="o">=</span>
                                <span class="n">gestorCifrado</span><span class="o">.</span><span class="na">descifrar</span><span class="o">(</span>
                                                <span class="n">mensajeCifrado</span><span class="o">,</span><span class="n">clavePrivada</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">mensajeDescifrado</span><span class="o">;</span>
                <span class="n">mensajeDescifrado</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">descifrada</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;El mensaje descifrado es:&quot;</span><span class="o">+</span>
                                                <span class="n">mensajeDescifrado</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los objetos que cifran y descifran en Java utilizan estrictamente objetos <code class="docutils literal"><span class="pre">byte[]</span></code>, que
son los que debemos manejar siempre. Las conversiones a <code class="docutils literal"><span class="pre">String</span></code> las hacemos nosotros para poder visualizar resultados.</p>
</div>
</div>
<div class="section" id="protocolos-seguros-de-comunicaciones">
<h2>Protocolos seguros de comunicaciones.<a class="headerlink" href="#protocolos-seguros-de-comunicaciones" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En general, ahora que ya conocemos sockets, el uso de servidores y clientes y el uso de la criptografía de clave asimétrica ya es posible crear aplicaciones que se comuniquen de forma muy segura.</p>
<p>En general, todo protocolo que queramos implementar dará estos pasos.</p>
<ol class="arabic simple">
<li>Todo cliente genera su pareja de claves.</li>
<li>Todo servidor genera su pareja de claves.</li>
<li>Cuando un cliente se conecte a un servidor, le envía su clave de cifrado y conserva la de descifrado.</li>
<li>Cuando un servidor recibe la conexión de un cliente recibe la clave de cifrado de dicho cliente.</li>
<li>El servidor envía su clave pública al cliente.</li>
<li>Ahora cliente y servidor pueden enviar mensajes al otro con la garantía de que solo servidor y cliente respectivamente pueden descifrar.</li>
</ol>
<p>En realidad se puede asegurar más el proceso haciendo que en el paso 5 el servidor cifre su propia clave pública con la clave pública del cliente. De esta forma, incluso aunque alguien robara la clave privada del cliente tampoco tendría demasiado, ya que tendría que robar la clave privada del servidor.</p>
</div>
<div class="section" id="programacion-de-aplicaciones-con-comunicaciones-seguras">
<h2>Programación de aplicaciones con comunicaciones seguras.<a class="headerlink" href="#programacion-de-aplicaciones-con-comunicaciones-seguras" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Por fortuna Java dispone de clases ya prefabricadas que facilitan enormemente el que dos aplicaciones intercambios datos de forma segura a través de una red. Se deben considerar los siguientes puntos:</p>
<ul class="simple">
<li>El servidor debe tener su propio certificado. Si no lo tenemos, se puede generar primero una pareja de claves con la herramienta <code class="docutils literal"><span class="pre">keytool</span></code>, como se muestra en la figura adjunta. La herramienta guardará la pareja de claves en un almacén (el cual tiene su propia clave). Despues generaremos un certificado a partir de esa pareja con <code class="docutils literal"><span class="pre">keytool</span> <span class="pre">-export</span> <span class="pre">-file</span> <span class="pre">certificadoservidor.cer</span> <span class="pre">-keystore</span> <span class="pre">almacenclaves</span></code>.</li>
<li>El código del servidor necesitará indicar el fichero donde se almacenan las claves y la clave para acceder a ese almacén.</li>
<li>El cliente necesita indicar que confía en el certificado del servidor. Dicho certificado del servidor puede estar guardado (por ejemplo) en el almacén de claves del cliente.</li>
<li>Aunque no suele hacerse también podría hacerse a la inversa y obligar al cliente a tener un certificado que el servidor pudiera importar, lo que aumentaría la seguridad.</li>
</ul>
<div class="figure align-center" id="id1" style="width: 50%">
<img alt="../_images/generacion_clave.png" src="../_images/generacion_clave.png" />
<p class="caption"><span class="caption-text">Generando la pareja de claves del servidor.</span></p>
</div>
<p>Los pasos desglosados implican ejecutar estos comandos en el servidor:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># El servidor genera una pareja de claves que se almacena en un</span>
<span class="c1">#fichero llamado &quot;clavesservidor&quot;. Dentro del fichero se indica</span>
<span class="c1">#un alias para poder referirnos a esa clave fácilmente</span>
<span class="n">keytool</span> <span class="o">-</span><span class="n">genkeypair</span> <span class="o">-</span><span class="n">keyalg</span> <span class="n">RSA</span>
     <span class="o">-</span><span class="n">alias</span> <span class="n">servidor</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavesservidor</span>

<span class="c1">#El servidor genera su &quot;certificado&quot;, es decir un fichero que</span>
<span class="c1">#de alguna forma indica quien es él. El certificado se almacena</span>
<span class="c1">#en un fichero llamado clavesservidor y a partir de él queremos</span>
<span class="c1">#generar el certificado de un alias que tiene que haber llamado servidor</span>
<span class="n">keytool</span> <span class="o">--</span><span class="n">exportcert</span> <span class="o">-</span><span class="n">alias</span> <span class="n">servidor</span>
     <span class="o">-</span><span class="n">file</span> <span class="n">servidor</span><span class="o">.</span><span class="n">cer</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavesservidor</span>
</pre></div>
</div>
<p>En el cliente daremos estos pasos:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Se genera una pareja de claves (en realidad no nos hace falta solo</span>
<span class="c1">#queremos tener un almacén de claves.</span>
<span class="n">keytool</span> <span class="o">-</span><span class="n">genkeypair</span> <span class="o">-</span><span class="n">keyalg</span> <span class="n">RSA</span> <span class="o">-</span><span class="n">alias</span> <span class="n">cliente</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavescliente</span>

<span class="c1">#Se importa el certificado del servidor indicando que pertenece a</span>
<span class="c1">#la lista de certificados confiables.</span>
<span class="n">keytool</span> <span class="o">-</span><span class="n">importcert</span> <span class="o">-</span><span class="n">trustcacerts</span> <span class="o">-</span><span class="n">alias</span> <span class="n">servidor</span> <span class="o">-</span><span class="n">file</span> <span class="n">servidor</span><span class="o">.</span><span class="n">cer</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">clavescliente</span>
</pre></div>
</div>
<p>Una vez creados los ficheros iniciales se deben dar los siguientes pasos en Java (servidor y cliente van por separado):</p>
<ol class="arabic simple">
<li>El servidor debe cargar su almacén de claves (el fichero <code class="docutils literal"><span class="pre">clavesservidor</span></code>)</li>
<li>Ese almacén (cargado en un objeto Java llamado <code class="docutils literal"><span class="pre">KeyStore</span></code>), se usará para crear un gestor de claves (objeto <code class="docutils literal"><span class="pre">KeyManager</span></code>), el cual se obtiene a partir de una &#8220;fábrica&#8221; llamada <code class="docutils literal"><span class="pre">KeyManagerFactory</span></code>.</li>
<li>Se creará un contexto SSL (objeto <code class="docutils literal"><span class="pre">SSLContext</span></code>) a partir de la fábrica comentada.</li>
<li>El objeto <code class="docutils literal"><span class="pre">SSLContext</span></code> permitirá crear una fábrica de sockets que será la que finalmente nos permita tener un <code class="docutils literal"><span class="pre">SSLServerSocket</span></code>, es decir un socket de servidor que usará cifrado.</li>
</ol>
<p>El código Java del servidor sería algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="nf">OtroServidor</span> <span class="o">(</span><span class="n">String</span> <span class="n">rutaAlmacen</span><span class="o">,</span> <span class="n">String</span> <span class="n">claveAlmacen</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">rutaAlmacen</span><span class="o">=</span><span class="n">rutaAlmacen</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">claveAlmacen</span><span class="o">=</span><span class="n">claveAlmacen</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">SSLServerSocket</span> <span class="nf">getServerSocketSeguro</span><span class="o">()</span>
                    <span class="kd">throws</span> <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                    <span class="n">CertificateException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span>
                    <span class="n">KeyManagementException</span><span class="o">,</span> <span class="n">UnrecoverableKeyException</span>
    <span class="o">{</span>
            <span class="n">SSLServerSocket</span> <span class="n">serverSocket</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
            <span class="cm">/* Paso 1, se carga el almacén de claves*/</span>
            <span class="n">FileInputStream</span> <span class="n">fichAlmacen</span><span class="o">=</span>
                            <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">rutaAlmacen</span><span class="o">);</span>
            <span class="cm">/* Paso 1.1, se crea un almacén del tipo por defecto</span>
<span class="cm">             * que es un JKS (Java Key Store), a día de hoy*/</span>
            <span class="n">KeyStore</span> <span class="n">almacen</span><span class="o">=</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getDefaultType</span><span class="o">());</span>
            <span class="n">almacen</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">fichAlmacen</span><span class="o">,</span> <span class="n">claveAlmacen</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
            <span class="cm">/* Paso 2: obtener una fábrica de KeyManagers que ofrezcan</span>
<span class="cm">             * soporte al algoritmo por defecto*/</span>
            <span class="n">KeyManagerFactory</span> <span class="n">fabrica</span><span class="o">=</span>
                            <span class="n">KeyManagerFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span>
                                <span class="n">KeyManagerFactory</span><span class="o">.</span><span class="na">getDefaultAlgorithm</span><span class="o">());</span>
            <span class="n">fabrica</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">almacen</span><span class="o">,</span> <span class="n">claveAlmacen</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
            <span class="cm">/* Paso 3:Intentamos obtener un contexto SSL</span>
<span class="cm">             * que ofrezca soporte a TLS (el sistema más</span>
<span class="cm">             * seguro hoy día) */</span>
            <span class="n">SSLContext</span> <span class="n">contextoSSL</span><span class="o">=</span><span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>
            <span class="n">contextoSSL</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">fabrica</span><span class="o">.</span><span class="na">getKeyManagers</span><span class="o">(),</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="cm">/* Paso 4: Se obtiene una fábrica de sockets que permita</span>
<span class="cm">             * obtener un SSLServerSocket */</span>
            <span class="n">SSLServerSocketFactory</span> <span class="n">fabricaSockets</span><span class="o">=</span>
                            <span class="n">contextoSSL</span><span class="o">.</span><span class="na">getServerSocketFactory</span><span class="o">();</span>
            <span class="n">serverSocket</span><span class="o">=</span>
                    <span class="o">(</span><span class="n">SSLServerSocket</span><span class="o">)</span>
                            <span class="n">fabricaSockets</span><span class="o">.</span><span class="na">createServerSocket</span><span class="o">(</span><span class="n">puerto</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">serverSocket</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">()</span>
        <span class="kd">throws</span> <span class="n">KeyManagementException</span><span class="o">,</span> <span class="n">UnrecoverableKeyException</span><span class="o">,</span>
            <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
            <span class="n">CertificateException</span><span class="o">,</span> <span class="n">IOException</span>
    <span class="o">{</span>
            <span class="n">SSLServerSocket</span> <span class="n">socketServidor</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">getServerSocketSeguro</span><span class="o">();</span>
            <span class="n">BufferedReader</span> <span class="n">entrada</span><span class="o">;</span>
            <span class="n">PrintWriter</span> <span class="n">salida</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                    <span class="n">Socket</span> <span class="n">connRecibida</span><span class="o">=</span><span class="n">socketServidor</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion segura recibida&quot;</span><span class="o">);</span>
                    <span class="n">entrada</span><span class="o">=</span>
                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span>
                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">connRecibida</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
                    <span class="n">salida</span><span class="o">=</span>
                        <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span>
                            <span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span>
                            <span class="n">connRecibida</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()));</span>
                    <span class="n">String</span> <span class="n">linea</span><span class="o">=</span><span class="n">entrada</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                    <span class="n">salida</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
                    <span class="n">salida</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
</div>
<p>En el cliente se tienen que dar algunos pasos parecidos:</p>
<ol class="arabic simple">
<li>En primer lugar se carga el almacén de claves del cliente (que contiene el certificado del servidor y que es la clave para poder &#8220;autenticar&#8221; el servidor)</li>
<li>El almacén del cliente se usará para crear un &#8220;gestor de confianza&#8221; (<code class="docutils literal"><span class="pre">TrustManager</span></code>) que Java usará para determinar si puede confiar o no en una conexión. Usaremos un <code class="docutils literal"><span class="pre">TrustManagerFactory</span></code> que usará el almacén del cliente para crear objetos que puedan gestionar la confianza.</li>
<li>Se creará un contexto SSL (<code class="docutils literal"><span class="pre">SSLContext</span></code>) que se basará en los <code class="docutils literal"><span class="pre">TrustManager</span></code> que pueda crear la fábrica.</li>
<li>A partir del contexto SSL el cliente ya puede crear un socket seguro (<code class="docutils literal"><span class="pre">SSLSocket</span></code>) que puede usar para conectar con el servidor de forma segura.</li>
</ol>
<p>El código del cliente sería algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OtroCliente</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">almacen</span><span class="o">=</span><span class="s">&quot;/home/usuario/clavescliente&quot;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">clave</span><span class="o">=</span><span class="s">&quot;abcdabcd&quot;</span><span class="o">;</span>
    <span class="n">SSLSocket</span> <span class="n">conexion</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">OtroCliente</span><span class="o">(</span><span class="n">String</span> <span class="n">ip</span><span class="o">,</span> <span class="kt">int</span> <span class="n">puerto</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="n">UnknownHostException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span>
                    <span class="n">KeyManagementException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                    <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">CertificateException</span><span class="o">{</span>

            <span class="n">conexion</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">obtenerSocket</span><span class="o">(</span><span class="n">ip</span><span class="o">,</span><span class="n">puerto</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/* Envía un mensaje de prueba para verificar que la conexión</span>
<span class="cm">     * SSL es correcta */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">conectar</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Iniciando..&quot;</span><span class="o">);</span>
            <span class="n">BufferedReader</span> <span class="n">entrada</span><span class="o">;</span>
            <span class="n">PrintWriter</span> <span class="n">salida</span><span class="o">;</span>
            <span class="n">entrada</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">conexion</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
            <span class="n">salida</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">conexion</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()));</span>
            <span class="cm">/* De esta linea se intenta averiguar la longitud*/</span>
            <span class="n">salida</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;1234567890&quot;</span><span class="o">);</span>
            <span class="n">salida</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="cm">/* Si todo va bien, el servidor nos contesta el numero*/</span>
            <span class="n">String</span> <span class="n">num</span><span class="o">=</span><span class="n">entrada</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">longitud</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;La longitud devuelta es:&quot;</span><span class="o">+</span><span class="n">longitud</span><span class="o">);</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">SSLSocket</span> <span class="nf">obtenerSocket</span><span class="o">(</span><span class="n">String</span> <span class="n">ip</span><span class="o">,</span> <span class="kt">int</span> <span class="n">puerto</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="n">KeyStoreException</span><span class="o">,</span> <span class="n">NoSuchAlgorithmException</span><span class="o">,</span>
                    <span class="n">CertificateException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">KeyManagementException</span>
    <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Obteniendo socket&quot;</span><span class="o">);</span>
            <span class="n">SSLSocket</span> <span class="n">socket</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
            <span class="cm">/* Paso 1: se carga al almacén de claves</span>
<span class="cm">             * (que recordemos debe contener el</span>
<span class="cm">             * certificado del servidor)*/</span>
            <span class="n">KeyStore</span> <span class="n">almacenCliente</span><span class="o">=</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KeyStore</span><span class="o">.</span><span class="na">getDefaultType</span><span class="o">());</span>
            <span class="n">FileInputStream</span> <span class="n">ficheroAlmacenClaves</span><span class="o">=</span>
                            <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span> <span class="k">this</span><span class="o">.</span><span class="na">almacen</span> <span class="o">);</span>
            <span class="n">almacenCliente</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">ficheroAlmacenClaves</span><span class="o">,</span> <span class="n">clave</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Almacen cargado&quot;</span><span class="o">);</span>
            <span class="cm">/* Paso 2, crearemos una fabrica de gestores de confianza</span>
<span class="cm">             * que use el almacén cargado antes (que contiene el</span>
<span class="cm">             * certificado del servidor)</span>
<span class="cm">             */</span>
            <span class="n">TrustManagerFactory</span> <span class="n">fabricaGestoresConfianza</span><span class="o">=</span>
                            <span class="n">TrustManagerFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span>
                                            <span class="n">TrustManagerFactory</span><span class="o">.</span><span class="na">getDefaultAlgorithm</span><span class="o">());</span>
            <span class="n">fabricaGestoresConfianza</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">almacenCliente</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fabrica Trust creada&quot;</span><span class="o">);</span>
            <span class="cm">/*Paso 3: se crea el contexto SSL, que ofrezca</span>
<span class="cm">             * soporte al algoritmo TLS*/</span>
            <span class="n">SSLContext</span> <span class="n">contexto</span><span class="o">=</span><span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>
            <span class="n">contexto</span><span class="o">.</span><span class="na">init</span><span class="o">(</span>
                            <span class="kc">null</span><span class="o">,</span> <span class="n">fabricaGestoresConfianza</span><span class="o">.</span><span class="na">getTrustManagers</span><span class="o">(),</span> <span class="kc">null</span><span class="o">);</span>
            <span class="cm">/* Paso 4: Se crea un socket que conecte con el servidor*/</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Contexto creado&quot;</span><span class="o">);</span>
            <span class="n">SSLSocketFactory</span> <span class="n">fabricaSockets</span><span class="o">=</span>
                            <span class="n">contexto</span><span class="o">.</span><span class="na">getSocketFactory</span><span class="o">();</span>
            <span class="n">socket</span><span class="o">=(</span><span class="n">SSLSocket</span><span class="o">)</span> <span class="n">fabricaSockets</span><span class="o">.</span><span class="na">createSocket</span><span class="o">(</span><span class="n">ip</span><span class="o">,</span> <span class="n">puerto</span><span class="o">);</span>
            <span class="cm">/* Y devolvemos el socket*/</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Socket creado&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">socket</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="firmado-de-aplicaciones">
<h2>Firmado de aplicaciones<a class="headerlink" href="#firmado-de-aplicaciones" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Utilizando la criptografía de clave pública es posible &#8220;firmar&#8221; aplicaciones. El firmado es un mecanismo que permite al usuario de una aplicación el verificar que la aplicación no ha sido alterada desde que el programador la creó (virus o programas malignos, personal descontento con la empresa, etc...).</p>
<p>Antes de efectuar el firmado se debe disponer de un par de claves generadas con la herramienta <code class="docutils literal"><span class="pre">keytool</span></code> mencionada anteriormente. Supongamos que el almacén de claves está creado y que en él hay uno o varios <em>alias</em> creados. El proceso de firmado es el siguiente:</p>
<ol class="arabic simple">
<li>Crear la aplicación, que puede estar formada por un conjunto de clases pero que en última instancia tendrá un <code class="docutils literal"><span class="pre">main</span></code>.</li>
<li>Empaquetar la aplicación con <code class="docutils literal"><span class="pre">jar</span> <span class="pre">cfe</span> <span class="pre">Aplicacion.jar</span> <span class="pre">com.ies.Aplicacion</span> <span class="pre">DirectorioPaquete</span></code>. Este comando crea un fichero (<code class="docutils literal"><span class="pre">f</span></code>) JAR en el cual el punto de entrada (<code class="docutils literal"><span class="pre">e</span></code>) es la clase <code class="docutils literal"><span class="pre">com.ies.Aplicacion</span></code> (que es la que tendrá el <code class="docutils literal"><span class="pre">main</span></code>).</li>
<li>Puede comprobarse que la aplicación dentro del JAR se ejecuta correctamente con <code class="docutils literal"><span class="pre">java</span> <span class="pre">-jar</span> <span class="pre">Aplicacion.jar</span></code>.</li>
<li>Ahora se puede ejecutar <code class="docutils literal"><span class="pre">jarsigner</span> <span class="pre">Aplicacion.jar</span> <span class="pre">&lt;alias&gt;</span></code>.</li>
</ol>
<p>Con estos pasos se tiene un aplicación firmada que el usuario puede verificar si así lo desea. De hecho, si se extrae el contenido del JAR con <code class="docutils literal"><span class="pre">jar</span> <span class="pre">-xf</span> <span class="pre">Aplicacion.jar</span></code> se extraen los archivos <code class="docutils literal"><span class="pre">.class</span></code> y un fichero <code class="docutils literal"><span class="pre">META-INF/Manifest</span></code> que se puede abrir con un editor para ver que realmente está firmado.</p>
<p>Para que otras personas puedan comprobar que nuestra aplicacion es correcta los programadores deberemos exportar un certificado que los usuarios puedan importar para hacer el verificado. Recordemos que el comando es:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">keytool</span> <span class="o">-</span><span class="n">exportcert</span> <span class="o">-</span><span class="n">keystore</span> <span class="o">..</span>\<span class="n">Almacen</span><span class="o">.</span><span class="n">store</span> <span class="o">-</span><span class="n">file</span> <span class="n">Programador</span><span class="o">.</span><span class="n">cer</span> <span class="o">-</span><span class="n">alias</span> <span class="n">Programador</span>
</pre></div>
</div>
</div>
<div class="section" id="verificado-de-aplicaciones">
<h2>Verificado de aplicaciones<a class="headerlink" href="#verificado-de-aplicaciones" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si ahora otro usuario desea ejecutar nuestra aplicación deberá importar nuestro certificado. El proceso de verificado es simple:</p>
<ol class="arabic simple">
<li>El usuario importa el certificado.</li>
<li>Ahora que tiene el certificado puede comprobar la aplicación con <code class="docutils literal"><span class="pre">jarsigner</span> <span class="pre">-verify</span> <span class="pre">Aplicacion.jar</span> <span class="pre">&lt;alias_del_programador&gt;</span></code></li>
</ol>
<p>El comando deberá responder con algo como <code class="docutils literal"><span class="pre">jar</span> <span class="pre">verified</span></code>. Sin embargo si no tenemos un certificado firmado por alguna autoridad de certificación (CA) la herramienta se quejará de que algunos criterios de seguridad no se cumplen.</p>
</div>
<div class="section" id="ejercicio">
<h2>Ejercicio<a class="headerlink" href="#ejercicio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Intenta extraer el archivo JAR y reemplaza el <code class="docutils literal"><span class="pre">.class</span></code> por alguna otra clase. Vuelve a crear el archivo .JAR y vuelve a intentar verificarlo, ¿qué ocurre?</p>
</div>
<div class="section" id="recordatorio">
<h2>Recordatorio<a class="headerlink" href="#recordatorio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Hemos hecho el proceso de firmado y verificado con <strong>certificados autofirmados</strong>, lo cual es útil para practicar pero <strong>completamente inútil desde el punto de vista de la seguridad</strong>. Para que un certificado sea seguro debemos hacer que previamente alguna autoridad de certificación nos lo firme primero (para lo cual suele ser habitual el tener que pagar).</p>
</div>
<div class="section" id="politica-de-seguridad">
<h2>Política de seguridad.<a class="headerlink" href="#politica-de-seguridad" title="Enlazar permanentemente con este título">¶</a></h2>
</div>
<div class="section" id="programacion-de-mecanismos-de-control-de-acceso">
<h2>Programación de mecanismos de control de acceso.<a class="headerlink" href="#programacion-de-mecanismos-de-control-de-acceso" title="Enlazar permanentemente con este título">¶</a></h2>
</div>
<div class="section" id="pruebas-y-depuracion">
<h2>Pruebas y depuración.<a class="headerlink" href="#pruebas-y-depuracion" title="Enlazar permanentemente con este título">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Tabla de Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">Utilización de técnicas de programación segura</a><ul>
<li><a class="reference internal" href="#introduccion">Introducción</a></li>
<li><a class="reference internal" href="#practicas-de-programacion-segura">Prácticas de programación segura.</a><ul>
<li><a class="reference internal" href="#metodo-cesar">Método César</a></li>
</ul>
</li>
<li><a class="reference internal" href="#criptografia-de-clave-publica-y-clave-privada">Criptografía de clave pública y clave privada.</a></li>
<li><a class="reference internal" href="#principales-aplicaciones-de-la-criptografia">Principales aplicaciones de la criptografía.</a></li>
<li><a class="reference internal" href="#protocolos-criptograficos">Protocolos criptográficos.</a></li>
<li><a class="reference internal" href="#encriptacion-de-informacion">Encriptación de información.</a></li>
<li><a class="reference internal" href="#protocolos-seguros-de-comunicaciones">Protocolos seguros de comunicaciones.</a></li>
<li><a class="reference internal" href="#programacion-de-aplicaciones-con-comunicaciones-seguras">Programación de aplicaciones con comunicaciones seguras.</a></li>
<li><a class="reference internal" href="#firmado-de-aplicaciones">Firmado de aplicaciones</a></li>
<li><a class="reference internal" href="#verificado-de-aplicaciones">Verificado de aplicaciones</a></li>
<li><a class="reference internal" href="#ejercicio">Ejercicio</a></li>
<li><a class="reference internal" href="#recordatorio">Recordatorio</a></li>
<li><a class="reference internal" href="#politica-de-seguridad">Política de seguridad.</a></li>
<li><a class="reference internal" href="#programacion-de-mecanismos-de-control-de-acceso">Programación de mecanismos de control de acceso.</a></li>
<li><a class="reference internal" href="#pruebas-y-depuracion">Pruebas y depuración.</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tema4.html" title="capítulo anterior">Generación de servicios en red</a></li>
      <li>Next: <a href="anexos.html" title="próximo capítulo">Anexos</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/textos/tema5.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Ir a" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Oscar Gomez.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/textos/tema5.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>