<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programación multiproceso &#8212; Apuntes de Lenguajes de Marcas v1.3</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="Apuntes de Lenguajes de Marcas v1.3" href="../index.html" />
    <link rel="next" title="Programación multihilo" href="tema2.html" />
    <link rel="prev" title="Programacion de servicios y procesos" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="programacion-multiproceso">
<h1>Programación multiproceso<a class="headerlink" href="#programacion-multiproceso" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="ejecutables-procesos-servicios">
<h2>Ejecutables. Procesos. Servicios.<a class="headerlink" href="#ejecutables-procesos-servicios" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="ejecutables">
<h3>Ejecutables<a class="headerlink" href="#ejecutables" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un ejecutable es un archivo con la estructura necesaria para que el sistema operativo pueda poner en marcha el programa que hay dentro. En Windows, los ejecutables suelen ser archivos con la extension .EXE.</p>
<p>Se pueden utilizar &#8220;desensambladores&#8221; para averiguar la secuencia de instrucciones que hay en un EXE. Incluso existen desensambladores en línea como <a class="reference external" href="http://onlinedisassembler.com">http://onlinedisassembler.com</a></p>
<p>Sin embargo, Java genera ficheros .JAR o .CLASS. Estos ficheros <em>no son ejecutables</em> sino que son archivos que el intérprete de JAVA (el archivo <code class="docutils literal"><span class="pre">java.exe</span></code>) leerá y ejecutará.</p>
<p>El intérprete toma el programa y lo traduce a instrucciones del microprocesador en el que estemos, que puede ser x86 o un x64 o lo que sea. Ese proceso se hace &#8220;al instante&#8221; o JIT (Just-In-Time).</p>
<p>Un archivo .CLASS puede desensamblarse utilizando el comando <code class="docutils literal"><span class="pre">javap</span> <span class="pre">-c</span> <span class="pre">&lt;archivo.class&gt;</span></code> . Cuando se hace así, se obtiene un listado de &#8220;instrucciones&#8221; que no se corresponden con las instrucciones del microprocesador, sino con &#8220;instrucciones virtuales de Java&#8221;. El intérprte Java (el archivo <code class="docutils literal"><span class="pre">java.exe</span></code>) traducirá en el momento del arranque dichas instrucciones virtuales Java a instrucciones reales del microprocesador.</p>
<p>Este último aspecto es el esgrimido por Java para defender que su ejecución puede ser más rápida que la de un EXE, ya que Java puede averiguar en qué microprocesador se está ejecutando y así generar el código más óptimo posible.</p>
<p>Un EXE puede que no contenga las instrucciones de los microprocesadores más modernos. Como todos son compatibles no es un gran problema, sin embargo, puede que no aprovechemos al 100% la capacidad de nuestro micro.</p>
</div>
<div class="section" id="procesos">
<h3>Procesos<a class="headerlink" href="#procesos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Es un archivo que está en ejecución y bajo el control del sistema operativo. Un proceso puede atravesar diversas etapas en su &#8220;ciclo de vida&#8221;. Los estados en los que puede estar son:</p>
<ul class="simple">
<li>En ejecución: está dentro del microprocesador.</li>
<li>Pausado/detenido/en espera: el proceso tiene que seguir en ejecución pero en ese momento el S.O tomó la decisión de dejar paso a otro.</li>
<li>Interrumpido: el proceso tiene que seguir en ejecución pero <em>el usuario</em> ha decidido interrumpir la ejecución.</li>
<li>Existen otros estados pero ya son muy dependientes del sistema operativo concreto.</li>
</ul>
</div>
<div class="section" id="servicios">
<h3>Servicios<a class="headerlink" href="#servicios" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un servicio es un proceso que no muestra ninguna ventana ni gráfico en pantalla porque no está pensado para que el usuario lo maneje directamente.</p>
<p>Habitualmente, un servicio es un programa que atiende a otro programa.</p>
</div>
</div>
<div class="section" id="hilos">
<h2>Hilos.<a class="headerlink" href="#hilos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Un hilo es un concepto más avanzado que un proceso: al hablar de procesos cada uno tiene su propio espacio en memoria. Si abrimos 20 procesos cada uno de ellos consume 20x de memoria RAM. Un hilo es un proceso mucho más ligero, en el que el código y los datos se comparten de una forma distinta.</p>
<p>Un proceso no tiene acceso a los datos de otro procesos. Sin embargo un hilo sí accede a los datos de otro hilo. Esto complicará algunas cuestiones a la hora de programar.</p>
</div>
<div class="section" id="programacion-concurrente">
<h2>Programación concurrente.<a class="headerlink" href="#programacion-concurrente" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La programación concurrente es la parte de la programación que se ocupa de crear programas que pueden tener varios procesos/hilos que colaboran para ejecutar un trabajo y aprovechar al máximo el rendimiento de sistemas multinúcleo.</p>
</div>
<div class="section" id="programacion-paralela-y-distribuida">
<h2>Programación paralela y distribuida.<a class="headerlink" href="#programacion-paralela-y-distribuida" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Dentro de la programación concurrente tenemos la paralela y la distribuida:</p>
<ul class="simple">
<li>En general se denomina &#8220;programación paralela&#8221; a la creación de software que se ejecuta siempre en un solo ordenador (con varios núcleos o no)</li>
<li>Se denomina &#8220;programación distribuida&#8221; a la creación de software que se ejecuta en ordenadores distintos y que se comunican a través de una red.</li>
</ul>
</div>
<div class="section" id="creacion-de-procesos">
<h2>Creación de procesos.<a class="headerlink" href="#creacion-de-procesos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En Java es posible crear procesos utilizando algunas clases que el entorno ofrece para esta tarea. En este tema, veremos en profundidad la clase ProcessBuilder.</p>
<p>El ejemplo siguiente muestra como lanzar un proceso de Acrobat Reader:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LanzadorProcesos</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ejecutar</span><span class="o">(</span><span class="n">String</span> <span class="n">ruta</span><span class="o">){</span>

                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="n">ruta</span><span class="o">);</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>

        <span class="o">}</span>
        <span class="cm">/**</span>
<span class="cm">         * @param args</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">ruta</span><span class="o">=</span>
                        <span class="s">&quot;C:\\Program Files (x86)\\Adobe\\Reader 11.0\\Reader\\AcroRd32.exe&quot;</span><span class="o">;</span>
                <span class="n">LanzadorProcesos</span> <span class="n">lp</span><span class="o">=</span><span class="k">new</span> <span class="n">LanzadorProcesos</span><span class="o">();</span>
                <span class="n">lp</span><span class="o">.</span><span class="na">ejecutar</span><span class="o">(</span><span class="n">ruta</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Finalizado&quot;</span><span class="o">);</span>
        <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Supongamos que necesitamos crear un programa que aproveche al máximo el número de CPUs para realizar alguna tarea intensiva. Supongamos que dicha tarea consiste en sumar números.</p>
<p>Enunciado: crear una clase Java que sea capaz de sumar todos los números comprendidos entre dos valores incluyendo ambos valores.</p>
<p>Para resolverlo crearemos una clase <code class="docutils literal"><span class="pre">Sumador</span></code> que tenga un método que acepte dos números <code class="docutils literal"><span class="pre">n1</span></code> y <code class="docutils literal"><span class="pre">n2</span></code> y que devuelva la suma de todo el intervalor.</p>
<p>Además, incluiremos un método <code class="docutils literal"><span class="pre">main</span></code> que ejecute la operación de suma tomando los números de la línea de comandos (es decir, se pasan como argumentos al main).</p>
<p>El código de dicha clase podría ser algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.ies</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sumador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumar</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n2</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">resultado</span><span class="o">+</span><span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Sumador</span> <span class="n">s</span><span class="o">=</span><span class="k">new</span> <span class="n">Sumador</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">n1</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">n2</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">sumar</span><span class="o">(</span><span class="n">n1</span><span class="o">,</span> <span class="n">n2</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">resultado</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Para ejecutar este programa desde dentro de Eclipse es necesario indicar que deseamos enviar <em>argumentos</em> al programa. Por ejemplo, si deseamos sumar los números del 2 al 10, deberemos ir a la venta &#8220;Run configuration&#8221; y en la pestaña &#8220;Arguments&#8221; indicar los argumentos (que en este caso son los dos números a indicar).</p>
<div class="figure align-center" id="id1" style="width: 50%">
<img alt="../_images/configuraciones.png" src="../_images/configuraciones.png" />
<p class="caption"><span class="caption-text">Modificando los argumentos del programa</span></p>
</div>
<p>Una vez hecha la prueba de la clase sumador, le quitamos el main, y crearemos una clase que sea capaz de lanzar varios procesos. La clase <code class="docutils literal"><span class="pre">Sumador</span></code> se quedará así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sumador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sumar</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n2</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">resultado</span><span class="o">+</span><span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Y ahora tendremos una clase que lanza procesos de esta forma:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.ies</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lanzador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lanzarSumador</span><span class="o">(</span><span class="n">Integer</span> <span class="n">n1</span><span class="o">,</span>
                        <span class="n">Integer</span> <span class="n">n2</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">clase</span><span class="o">=</span><span class="s">&quot;com.ies.Sumador&quot;</span><span class="o">;</span>
                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span>
                                        <span class="s">&quot;java&quot;</span><span class="o">,</span><span class="n">clase</span><span class="o">,</span>
                                        <span class="n">n1</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span>
                                        <span class="n">n2</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Lanzador</span> <span class="n">l</span><span class="o">=</span><span class="k">new</span> <span class="n">Lanzador</span><span class="o">();</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">51</span><span class="o">);</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">51</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Ok&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="comunicacion-entre-procesos">
<h2>Comunicación entre procesos.<a class="headerlink" href="#comunicacion-entre-procesos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las operaciones multiproceso pueden implicar que sea necesario comunicar información entre muchos procesos, lo que obliga a la necesidad de utilizar mecanismos específicos de comunicación que ofrecerá Java o a diseñar alguno separado que evite los problemas que puedan aparecer.</p>
<p>En el ejemplo, el segundo proceso suele sobreescribir el resultado del primero, así que modificaremos el código del lanzador para que cada proceso use su propio fichero de resultados.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lanzador</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lanzarSumador</span><span class="o">(</span><span class="n">Integer</span> <span class="n">n1</span><span class="o">,</span>
                        <span class="n">Integer</span> <span class="n">n2</span><span class="o">,</span> <span class="n">String</span> <span class="n">fichResultado</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">clase</span><span class="o">=</span><span class="s">&quot;com.ies.Sumador&quot;</span><span class="o">;</span>
                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span>
                                        <span class="s">&quot;java&quot;</span><span class="o">,</span><span class="n">clase</span><span class="o">,</span>
                                        <span class="n">n1</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span>
                                        <span class="n">n2</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>

                        <span class="n">pb</span><span class="o">.</span><span class="na">redirectError</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;errores.txt&quot;</span><span class="o">));</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">redirectOutput</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fichResultado</span><span class="o">));</span>
                        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="n">Lanzador</span> <span class="n">l</span><span class="o">=</span><span class="k">new</span> <span class="n">Lanzador</span><span class="o">();</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="s">&quot;result1.txt&quot;</span><span class="o">);</span>
                <span class="n">l</span><span class="o">.</span><span class="na">lanzarSumador</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span> <span class="s">&quot;result2.txt&quot;</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Ok&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Cuando se lanza un programa desde Eclipse no ocurre lo mismo que cuando se lanza desde Windows. Eclipse trabaja con unos directorios predefinidos y puede ser necesario indicar a nuestro programa cual es la ruta donde hay que buscar algo.</p>
<p>Usando el método <code class="docutils literal"><span class="pre">.directory(new</span> <span class="pre">File(&quot;c:\\dir\\))</span></code> se puede indicar a Java donde está el archivo que se desea ejecutar.</p>
</div>
<div class="section" id="ejercicio">
<h2>Ejercicio<a class="headerlink" href="#ejercicio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Crear un programa que permita parametrizar el lanzamiento de sumadores, que vuelque el contenido de las sumas en ficheros y que permita al programa principal recuperar las sumas de los ficheros parciales.</p>
<p>En el listado siguiente se muestra la clase Sumador</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">es.ies.multiproceso</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sumador</span> <span class="o">{</span>
        <span class="cm">/** Suma todos los valores incluidos</span>
<span class="cm">         * entre dos valores</span>
<span class="cm">         * @param n1 Limite 1</span>
<span class="cm">         * @param n2 Limite 2</span>
<span class="cm">         * @return La suma de dichos valores</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">sumar</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">suma</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">n1</span><span class="o">&gt;</span><span class="n">n2</span><span class="o">){</span>
                        <span class="kt">int</span> <span class="n">aux</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span>
                        <span class="n">n1</span><span class="o">=</span><span class="n">n2</span><span class="o">;</span>
                        <span class="n">n2</span><span class="o">=</span><span class="n">aux</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">n2</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">suma</span><span class="o">=</span><span class="n">suma</span><span class="o">+</span><span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">n1</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">n2</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">suma</span><span class="o">=</span><span class="n">sumar</span><span class="o">(</span><span class="n">n1</span><span class="o">,</span> <span class="n">n2</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">suma</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>En el listado siguiente se muestra la clase Main</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">NUM_PROCESOS</span><span class="o">=</span><span class="mi">4</span><span class="o">;</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PREFIJO_FICHEROS</span><span class="o">=</span><span class="s">&quot;fich&quot;</span><span class="o">;</span>


        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">lanzarSumador</span><span class="o">(</span>
                        <span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">,</span><span class="n">String</span> <span class="n">fichResultados</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">String</span> <span class="n">comando</span><span class="o">;</span>
                <span class="n">comando</span><span class="o">=</span><span class="s">&quot;es.ies.multiproceso.Sumador&quot;</span><span class="o">;</span>

                <span class="n">File</span> <span class="n">directorioSumador</span><span class="o">;</span>
                <span class="n">directorioSumador</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;C:\\Users\\&quot;</span><span class="o">+</span>
                <span class="s">&quot;ogomez\\workspace\\&quot;</span><span class="o">+</span>
                <span class="s">&quot;MultiProceso1\\bin\\&quot;</span><span class="o">);</span>
                <span class="n">File</span> <span class="n">fichResultado</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fichResultados</span><span class="o">);</span>
                <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
                <span class="n">pb</span><span class="o">=</span><span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="s">&quot;java&quot;</span><span class="o">,</span>
                                <span class="n">comando</span><span class="o">,</span>
                                <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">n1</span><span class="o">),</span>
                                <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">n2</span><span class="o">)</span> <span class="o">);</span>
                <span class="n">pb</span><span class="o">.</span><span class="na">directory</span><span class="o">(</span><span class="n">directorioSumador</span><span class="o">);</span>
                <span class="n">pb</span><span class="o">.</span><span class="na">redirectOutput</span><span class="o">(</span><span class="n">fichResultado</span><span class="o">);</span>
                <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getResultadoFichero</span><span class="o">(</span>
                        <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">){</span>

                <span class="kt">int</span> <span class="n">suma</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">FileInputStream</span> <span class="n">fichero</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span>
                                                        <span class="n">nombreFichero</span><span class="o">);</span>
                        <span class="n">InputStreamReader</span> <span class="n">fir</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span>
                                                        <span class="n">fichero</span><span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">fir</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">suma</span><span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                        <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;No se pudo abrir &quot;</span><span class="o">+</span><span class="n">nombreFichero</span><span class="o">);</span>

                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;No hay nada en &quot;</span><span class="o">+</span><span class="n">nombreFichero</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
        <span class="o">}</span>


        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getSumaTotal</span><span class="o">(</span><span class="kt">int</span> <span class="n">numFicheros</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">sumaTotal</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">NUM_PROCESOS</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">sumaTotal</span><span class="o">+=</span><span class="n">getResultadoFichero</span><span class="o">(</span>
                                <span class="n">PREFIJO_FICHEROS</span><span class="o">+</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">sumaTotal</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="cm">/* Recibe dos parámetros y hará</span>
<span class="cm">         * la suma de los valores comprendidos</span>
<span class="cm">         * entre ambos parametros</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span><span class="o">{</span>
                <span class="kt">int</span> <span class="n">n1</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">n2</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
                <span class="kt">int</span> <span class="n">salto</span><span class="o">=(</span> <span class="n">n2</span> <span class="o">/</span> <span class="n">NUM_PROCESOS</span> <span class="o">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">NUM_PROCESOS</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;n1:&quot;</span><span class="o">+</span><span class="n">n1</span><span class="o">);</span>
                        <span class="kt">int</span> <span class="n">resultadoSumaConSalto</span><span class="o">=</span><span class="n">n1</span><span class="o">+</span><span class="n">salto</span><span class="o">;</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;n2:&quot;</span><span class="o">+</span><span class="n">resultadoSumaConSalto</span><span class="o">);</span>
                        <span class="n">lanzarSumador</span><span class="o">(</span><span class="n">n1</span><span class="o">,</span> <span class="n">n1</span><span class="o">+</span><span class="n">salto</span> <span class="o">,</span>
                                        <span class="n">PREFIJO_FICHEROS</span><span class="o">+</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                        <span class="n">n1</span><span class="o">=</span><span class="n">n1</span> <span class="o">+</span> <span class="n">salto</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Suma lanzada...&quot;</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">sumaTotal</span><span class="o">=</span><span class="n">getSumaTotal</span><span class="o">(</span><span class="n">NUM_PROCESOS</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;La suma total es:&quot;</span><span class="o">+</span>
                                                <span class="n">sumaTotal</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ejercicio-resuelto">
<h2>Ejercicio resuelto<a class="headerlink" href="#ejercicio-resuelto" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Crear un programa que sea capaz de contar cuantas vocales hay en un fichero. El programa padre debe lanzar cinco procesos hijo, donde cada uno de ellos se ocupará de contar una vocal concreta (que puede ser minúscula o mayúscula). Cada subproceso que cuenta vocales deberá dejar el resultado en un fichero. El programa padre se ocupará de recuperar los resultados de los ficheros, sumar todos los subtotales y mostrar el resultado final en pantalla.</p>
<div class="section" id="operaciones-con-ficheros">
<h3>Operaciones con ficheros<a class="headerlink" href="#operaciones-con-ficheros" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Tanto en este ejercicio como en muchos otros vamos a necesitar realizar ciertas operaciones con ficheros. Para aumentar nuestra productividad utilizaremos una clase llamada <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code> que nos permita realizar ciertas tareas como las siguientes:</p>
<ul class="simple">
<li>Obtener un objeto <code class="docutils literal"><span class="pre">BufferedReader</span></code> a partir de un nombre de fichero de tipo <code class="docutils literal"><span class="pre">String</span></code>. Llamaremos a este método <code class="docutils literal"><span class="pre">getBufferedReader</span></code> y lo utilizaremos para poder manejar un fichero mediante una clase de muy alto nivel que nos facilita la lectura de ficheros. En el listado adjunto se puede consultar dicho método.</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedReader</span> <span class="nf">getBufferedReader</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">FileNotFoundException</span> <span class="o">{</span>
    <span class="n">FileReader</span> <span class="n">lector</span><span class="o">;</span>
    <span class="n">lector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="n">BufferedReader</span> <span class="n">bufferedReader</span><span class="o">;</span>
    <span class="n">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">lector</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">bufferedReader</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li>De la misma forma crearemos un método <code class="docutils literal"><span class="pre">getPrintWriter</span></code> que nos devuelva un objeto de la clase <code class="docutils literal"><span class="pre">PrintWriter</span></code> para poder realizar fácilmente operaciones de escritura en ficheros. En el listado adjunto se muestra el código.</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">PrintWriter</span> <span class="nf">getPrintWriter</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">PrintWriter</span> <span class="n">printWriter</span><span class="o">;</span>
    <span class="n">FileWriter</span> <span class="n">fileWriter</span><span class="o">;</span>
    <span class="n">fileWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="n">printWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">fileWriter</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">printWriter</span><span class="o">;</span>
<span class="c1">//Fin de getPrintWriter</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li>Aunque nos estamos anticipando, puede ser útil tener un método que dado un nombre de fichero nos devuelva un <code class="docutils literal"><span class="pre">ArrayList&lt;String&gt;</span></code> con todas las líneas que hay en el fichero. <strong>En este ejercicio no lo usaremos</strong>. Este método podría implementarse así:</li>
</ul>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLineasFichero</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">BufferedReader</span> <span class="n">bfr</span> <span class="o">=</span> <span class="n">getBufferedReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="c1">//Leemos líneas del fichero...</span>
    <span class="n">String</span> <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">linea</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//Y las añadimos al array</span>
        <span class="n">lineas</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
        <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//Fin del bucle que lee líneas</span>
    <span class="k">return</span> <span class="n">lineas</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="procesado-de-ficheros">
<h3>Procesado de ficheros<a class="headerlink" href="#procesado-de-ficheros" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Necesitaremos una clase <code class="docutils literal"><span class="pre">ProcesadorFichero</span></code> que nos permita procesar los ficheros de la forma pedida. Antes de crear un programa multiproceso empezaremos por crear una clase simple que nos resuelva este problema.</p>
<p>Dicha clase tendrá un método <code class="docutils literal"><span class="pre">hacerRecuento</span></code> que resuelva el problema de contar el número de apariciones en un fichero dejando el total de apariciones en un fichero de salida distintos. En el código adjunto podemos ver como podría implementarse dicho método.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getLineasFichero</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">BufferedReader</span> <span class="n">bfr</span> <span class="o">=</span> <span class="n">getBufferedReader</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
    <span class="c1">//Leemos líneas del fichero...</span>
    <span class="n">String</span> <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">linea</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//Y las añadimos al array</span>
        <span class="n">lineas</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
        <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//Fin del bucle que lee líneas</span>
    <span class="k">return</span> <span class="n">lineas</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>La clase <code class="docutils literal"><span class="pre">ProcesadorFichero</span></code> será lanzada desde otra clase que llamaremos <code class="docutils literal"><span class="pre">Lanzador</span></code>. Nuestra <code class="docutils literal"><span class="pre">ProcesadorFichero</span></code> recogerá en su método <code class="docutils literal"><span class="pre">main</span></code> los siguientes parámetros:</p>
<ol class="arabic simple">
<li>El nombre del fichero a procesar. Lo llamaremos <code class="docutils literal"><span class="pre">nombreFicheroEntrada</span></code> y estará en la posición 0 de los argumentos.</li>
<li>La letra de la que hay que hacer el recuento de apariciones. La llamaremos <code class="docutils literal"><span class="pre">letra</span></code> y estará en la posición 1.</li>
<li>El nombre del fichero donde se dejarán los resultados. Lo llamaremos <code class="docutils literal"><span class="pre">nombreFicheroResultado</span></code> y estará en la posición 1 de los argumentos.</li>
</ol>
<p>El código del main se muestra a continuación.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">	 * Dado un fichero pasado como argumento, contará cuantas</span>
<span class="cm">	 * apariciones hay de una cierta vocal (pasada como argumento)</span>
<span class="cm">	 * y dejará la cantidad en otro fichero (también pasado como</span>
<span class="cm">	 * argumento)</span>
<span class="cm">	 * @throws IOException</span>
<span class="cm">	 * @throws FileNotFoundException  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">FileNotFoundException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">nombreFicheroEntrada</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">letra</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">nombreFicheroResultado</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    <span class="n">hacerRecuento</span><span class="o">(</span><span class="n">nombreFicheroEntrada</span><span class="o">,</span> <span class="n">letra</span><span class="o">,</span> <span class="n">nombreFicheroResultado</span><span class="o">);</span>
<span class="c1">//Fin del main</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lanzamiento-de-los-procesos">
<h2>Lanzamiento de los procesos<a class="headerlink" href="#lanzamiento-de-los-procesos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La clase <code class="docutils literal"><span class="pre">Lanzador</span></code> tendrá un método <code class="docutils literal"><span class="pre">main</span></code> que se encargará de varias cosas:</p>
<ol class="arabic simple">
<li>Recoger el primer parámetro (<code class="docutils literal"><span class="pre">args[0]</span></code>), que contendrá el fichero a procesar.</li>
<li>Recoger el segundo parámetro, que contendrá el directorio de <code class="docutils literal"><span class="pre">CLASSPATH</span></code> donde habrá que buscar la clase <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code>.</li>
<li>Recoger el tercer parámetro, que contendrá el directorio donde habrá que buscar la clase <code class="docutils literal"><span class="pre">ProcesadorFicheros</span></code>.</li>
<li>Una vez recogidos los parámetros, se lanzarán los procesos utilizando la clase <code class="docutils literal"><span class="pre">ProcessBuilder</span></code>.</li>
<li>Los procesos se ejecutarán y después recogeremos los resultados de los ficheros.</li>
</ol>
<p>En el código siguiente puede verse el método <code class="docutils literal"><span class="pre">main</span></code> de esta clase <code class="docutils literal"><span class="pre">Lanzador</span></code>. La recogida de resultados se deja como ejercicio:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">ficheroEntrada</span><span class="o">;</span>
    <span class="n">ficheroEntrada</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">classpathUtilidades</span><span class="o">;</span>
    <span class="n">classpathUtilidades</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">classpathProcesadorFichero</span><span class="o">;</span>
    <span class="n">classpathProcesadorFichero</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">vocales</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;A&quot;</span><span class="o">,</span> <span class="s">&quot;E&quot;</span><span class="o">,</span> <span class="s">&quot;I&quot;</span><span class="o">,</span> <span class="s">&quot;O&quot;</span><span class="o">,</span> <span class="s">&quot;U&quot;</span> <span class="o">};</span>
    <span class="n">String</span> <span class="n">classPath</span><span class="o">;</span>
    <span class="n">classPath</span> <span class="o">=</span> <span class="n">classpathProcesadorFichero</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">classpathUtilidades</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Usando classpath:&quot;</span> <span class="o">+</span> <span class="n">classPath</span><span class="o">);</span>
    <span class="cm">/* Se lanzan los procesos*/</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vocales</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fichErrores</span> <span class="o">=</span> <span class="s">&quot;Errores_&quot;</span> <span class="o">+</span> <span class="n">vocales</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span>
                             <span class="s">&quot;.txt&quot;</span><span class="o">;</span>
        <span class="n">ProcessBuilder</span> <span class="n">pb</span><span class="o">;</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="s">&quot;java&quot;</span><span class="o">,</span> <span class="s">&quot;-cp&quot;</span><span class="o">,</span> <span class="n">classPath</span><span class="o">,</span>
                                <span class="s">&quot;com.ies.ProcesadorFichero&quot;</span><span class="o">,</span> <span class="n">ficheroEntrada</span><span class="o">,</span>
                                <span class="n">vocales</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">vocales</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span><span class="o">);</span>
        <span class="c1">//Si hay algún error, almacenarlo en un fichero</span>
        <span class="n">pb</span><span class="o">.</span><span class="na">redirectError</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fichErrores</span><span class="o">));</span>
        <span class="n">pb</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">//Fin del for</span>
    <span class="o">}</span>
    <span class="cm">/* Esperamos un poco*/</span>
    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
    <span class="cm">/* La recogida de resultados se deja como</span>
<span class="cm">    		 * ejercicio al lector. ;) */</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ejercicio-propuesto-i">
<h2>Ejercicio propuesto (I)<a class="headerlink" href="#ejercicio-propuesto-i" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Se desea crear un programa que procese ficheros aprovechando el paralelismo de la máquina. Se tienen cinco ficheros con los siguientes nombres:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">informatica.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">gerencia.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">contabilidad.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">comercio.txt</span></code></li>
<li><code class="docutils literal"><span class="pre">rrhh.txt</span></code></li>
</ul>
<p>En cada fichero hay una lista de cantidades enteras que representa las contabilidades de distintos departamentos. Hay una cantidad en cada línea. Se desea que el programa creado sume la cantidad total que suman todas las cantidades de los cinco ficheros haciendo uso del paralelismo.</p>
<div class="section" id="solucion-al-ejercicio-propuesto-i">
<h3>Solución al ejercicio propuesto (I)<a class="headerlink" href="#solucion-al-ejercicio-propuesto-i" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Este ejercicio es bastante parecido al anterior, con la salvedad de que ahora necesitaremos sumar cantidades en lugar de buscar elementos. Por lo demás,  también generaremos un fichero de resultados por cada fichero de datos y los llamaremos igual pero añadiendo la extensión &#8221;.res&#8221;. Es decir, la suma de las cantidades de <code class="docutils literal"><span class="pre">informatica.txt</span></code> se dejará en <code class="docutils literal"><span class="pre">informatica.txt.res</span></code>.</p>
<p>Una vez generados todos los fichero <code class="docutils literal"><span class="pre">Resultado</span></code> tendremos que sumar todas las cantidades de estos ficheros. Su estructura es muy simple, todos contienen una única línea con una cantidad. Dado que esta operación de sumar cantidades almacenadas en distintos ficheros es una operación muy habitual, añadiremos un método a <code class="docutils literal"><span class="pre">UtilidadesFicheros</span></code> que se encargue de hacer esta operación. Obsérvese que usaremos tipos de datos <code class="docutils literal"><span class="pre">long</span></code> y no <code class="docutils literal"><span class="pre">int</span></code> dado que no sabemos como de grandes serán las cantidades a procesar.</p>
<p>A continuación se muestra el código de este método.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">//Fin de getLineasFichero</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">getSuma</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span>
                           <span class="n">listaNombresFichero</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">suma</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lineas</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">lineaCantidad</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">cantidad</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">nombreFichero</span> <span class="o">:</span> <span class="n">listaNombresFichero</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">//Recuperamos todas las lineas</span>
            <span class="n">lineas</span> <span class="o">=</span> <span class="n">getLineasFichero</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
            <span class="c1">//Pero solo nos interesa la primera</span>
            <span class="n">lineaCantidad</span> <span class="o">=</span> <span class="n">lineas</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="c1">//Convertimos la linea a número</span>
            <span class="n">cantidad</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">lineaCantidad</span><span class="o">);</span>
            <span class="c1">//Y se incrementa la suma total</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="n">suma</span> <span class="o">+</span> <span class="n">cantidad</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fallo al procesar el fichero &quot;</span>
                               <span class="o">+</span> <span class="n">nombreFichero</span><span class="o">);</span>
            <span class="c1">//Fin del catch</span>
        <span class="o">}</span>
        <span class="c1">//Fin del for que recorre los nombres de fichero</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Una vez creado este método que usaremos al final, pasemos a crear una clase <code class="docutils literal"><span class="pre">ProcesadorContabilidad</span></code> que leerá un fichero, sumará las cantidades y las dejará en el fichero de resultados. Esta clase solo tendrá un método <code class="docutils literal"><span class="pre">main</span></code> que realizará esta tarea.</p>
<p>Como nuestro programa está formado por varias clases que están dispersas por distintos directorios, nuestro <code class="docutils literal"><span class="pre">main</span></code> tomará el <code class="docutils literal"><span class="pre">CLASSPATH</span></code> de los argumentos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">nombreFichero</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span> <span class="n">nombreFicheroResultado</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cantidades</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">//Extraemos las cantidades</span>
        <span class="n">cantidades</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getLineasFichero</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
        <span class="c1">//Y las sumamos una por una</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">lineaCantidad</span> <span class="o">:</span> <span class="n">cantidades</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">cantidad</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">lineaCantidad</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">cantidad</span><span class="o">;</span>
            <span class="c1">//Fin del for que recorre las cantidades</span>
        <span class="o">}</span>
        <span class="c1">//Almacenamos el total en un fichero</span>
        <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">;</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getPrintWriter</span><span class="o">(</span><span class="n">nombreFicheroResultado</span><span class="o">);</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span><span class="c1">//Fin del try</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;No se pudo procesar el fichero &quot;</span>
        <span class="o">+</span> <span class="n">nombreFichero</span><span class="o">);</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="c1">//Fin del main</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Por último, solo queda crear la clase <code class="docutils literal"><span class="pre">Lanzador</span></code> que recogerá los nombres de fichero que hay que sumar y lanzará un proceso de la clase <code class="docutils literal"><span class="pre">ProcesadorContabilidad</span></code> para cada uno de ellos. Por último, sumará todos los resultados y los dejará en un fichero que llamaremos (por ejemplo) <code class="docutils literal"><span class="pre">Resultado_global.txt</span></code></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">classpath</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">ficheros</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;informatica.txt&quot;</span><span class="o">,</span> <span class="s">&quot;gerencia.txt&quot;</span><span class="o">,</span> <span class="s">&quot;contabilidad.txt&quot;</span><span class="o">,</span> <span class="s">&quot;comercio.txt&quot;</span><span class="o">,</span> <span class="s">&quot;rrhh.txt&quot;</span> <span class="o">};</span>
    <span class="c1">//Los nombres de los ficheros de resultados</span>
    <span class="c1">//se generarán y luego se almacenarán aquí</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">ficherosResultado</span><span class="o">;</span>
    <span class="n">ficherosResultado</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">ficheros</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="cm">/* Lanzamos los procesos*/</span>
    <span class="n">ProcessBuilder</span><span class="o">[]</span> <span class="n">constructores</span><span class="o">;</span>
    <span class="n">constructores</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">[</span><span class="n">ficheros</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ficheros</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fichResultado</span><span class="o">,</span> <span class="n">fichErrores</span><span class="o">;</span>
        <span class="n">fichResultado</span> <span class="o">=</span> <span class="n">ficheros</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">SUFIJO_RESULTADO</span><span class="o">;</span>
        <span class="n">fichErrores</span> <span class="o">=</span> <span class="n">ficheros</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="n">SUFIJO_ERRORES</span><span class="o">;</span>
        <span class="n">ficherosResultado</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">fichResultado</span><span class="o">;</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">();</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">command</span><span class="o">(</span><span class="s">&quot;java&quot;</span><span class="o">,</span> <span class="s">&quot;-cp&quot;</span><span class="o">,</span> <span class="n">classpath</span><span class="o">,</span>
                                 <span class="s">&quot;com.ies.ProcesadorContabilidad&quot;</span><span class="o">,</span> <span class="n">ficheros</span><span class="o">[</span><span class="n">i</span><span class="o">],</span>
                                 <span class="n">fichResultado</span><span class="o">);</span>
        <span class="c1">//El fichero de errores se generará, aunque</span>
        <span class="c1">//puede que vacío</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">redirectError</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span>
                                           <span class="n">fichErrores</span><span class="o">));</span>
        <span class="n">constructores</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">//Fin del for que recorre los ficheros</span>
    <span class="o">}</span>
    <span class="c1">//Calculamos las sumas de cantidades</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getSuma</span><span class="o">(</span><span class="n">ficherosResultado</span><span class="o">);</span>
    <span class="c1">//Y las almacenamos</span>
    <span class="n">PrintWriter</span> <span class="n">pw</span> <span class="o">=</span> <span class="n">UtilidadesFicheros</span><span class="o">.</span><span class="na">getPrintWriter</span><span class="o">(</span><span class="n">RESULTADOS_GLOBALES</span><span class="o">);</span>
    <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
    <span class="n">pw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="c1">//Fin del main</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="gestion-de-procesos">
<h2>Gestión de procesos.<a class="headerlink" href="#gestion-de-procesos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La gestión de procesos se realiza de dos formas <strong>muy distintas</strong> en función de los dos grandes sistemas operativos: Windows y Linux.</p>
<ul class="simple">
<li>En Windows toda la gestión de procesos se realiza desde el &#8220;Administrador de tareas&#8221; al cual se accede con Ctrl+Alt+Supr. Existen otros programas más sofisticados que proporcionan algo más de información sobre los procesos, como Process Explorer (antes conocido con el nombre de ProcessViewer).</li>
</ul>
</div>
<div class="section" id="comandos-para-la-gestion-de-procesos-en-sistemas-libres-y-propietarios">
<h2>Comandos para la gestión de procesos en sistemas libres y propietarios.<a class="headerlink" href="#comandos-para-la-gestion-de-procesos-en-sistemas-libres-y-propietarios" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En sistemas Windows, no existen apenas comandos para gestionar procesos. Puede obligarse al sistema operativo a arrancar la aplicación asociada a un archivo con el comando <code class="docutils literal"><span class="pre">START</span></code>. Es decir, si se ejecuta lo siguiente:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">START</span> <span class="n">documento</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>se abrirá el visor de archivos PDF el cual cargará automáticamente el fichero <code class="docutils literal"><span class="pre">documento.pdf</span></code></p>
<p>En GNU/Linux se puede utilizar un terminal de consola para la gestión de procesos, lo que implica que no solo se pueden arrancar procesos si no tambien detenerlos, reanudarlos, terminarlos y modificar su prioridad de ejecución.</p>
<ul class="simple">
<li>Para arrancar un proceso, simplemente tenemos que escribir el nombre del comando correspondiente. Desde GNU/Linux se pueden controlar los servicios que se ejecutan con un comando llamado <code class="docutils literal"><span class="pre">service</span></code>. Por ejemplo, se puede usar <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">stop</span></code> para parar el servidor web y <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">start</span></code> para volver a ponerlo en marcha. También se puede reiniciar un servicio (tal vez para que relea un fichero de configuración que hemos cambiado) con <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">restart</span></code>.</li>
<li>Se puede detener y/o terminar un proceso con el comando <code class="docutils literal"><span class="pre">kill</span></code>. Se puede usar este comando para <strong>terminar un proceso</strong> sin guardar nada usando <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-SIGKILL</span> <span class="pre">&lt;numproceso&gt;</span></code> o <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-9</span> <span class="pre">&lt;numproceso&gt;</span></code>. Se puede pausar un proceso con <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-SIGSTOP</span> <span class="pre">&lt;numproceso&gt;</span></code> y rearrancarlo con <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-SIGCONT</span></code></li>
<li>Se puede enviar un proceso a segundo plano con comandos como <code class="docutils literal"><span class="pre">bg</span></code> o al arrancar el proceso escribir el nombre del comando terminado en <code class="docutils literal"><span class="pre">&amp;</span></code>.</li>
<li>Se puede devolver un proceso a primer plano con el comando <code class="docutils literal"><span class="pre">fg</span></code>.</li>
</ul>
<div class="section" id="prioridades">
<h3>Prioridades<a class="headerlink" href="#prioridades" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En sistemas como GNU/Linux se puede modificar la prioridad con que se ejecuta un proceso. Esto implica dos posibilidades</p>
<ul class="simple">
<li>Si pensamos que un programa que necesitamos ejecutar es muy importante podemos darle más prioridad para que reciba &#8220;más turnos&#8221; del planificador.</li>
<li>Y por el contrario, si pensamos que un programa no es muy necesario podemos quitarle prioridad y reservar &#8220;más turnos de planificador&#8221; para otros posibles procesos.</li>
</ul>
<p>El comando <code class="docutils literal"><span class="pre">nice</span></code> permite indicar prioridades entre -20 y 19. El -20 implica que un proceso reciba la <strong>máxima prioridad</strong>, y el 19 supone asignar la <strong>mínima prioridad</strong></p>
</div>
</div>
<div class="section" id="sincronizacion-entre-procesos">
<h2>Sincronización entre procesos.<a class="headerlink" href="#sincronizacion-entre-procesos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Cuando se lanza más de un proceso de una misma sección de código no se sabe qué proceso ejecutará qué instrucción en un cierto momento, lo que es muy peligroso:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span><span class="n">j</span><span class="o">;</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">2</span><span class="o">){</span>
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
        <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
<span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Ok&quot;</span><span class="o">);</span>
<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">;</span>
<span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</pre></div>
</div>
<p>Si dos o más procesos avanzan por esta sección de código es perfectamente posible que unas veces nuestro programa multiproceso se ejecute bien y otras no.</p>
<p>En todo programa multiproceso pueden encontrarse estas zonas de código &#8220;peligrosas&#8221; que deben protegerse especialmente utilizando ciertos mecanismos. El nombre global para todos los lenguajes es denominar a estos trozos &#8220;secciones críticas&#8221;.</p>
<div class="section" id="mecanismos-para-controlar-secciones-criticas">
<h3>Mecanismos para controlar secciones críticas<a class="headerlink" href="#mecanismos-para-controlar-secciones-criticas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los mecanismos más típicos son los ofrecidos por UNIX/Windows:</p>
<ul class="simple">
<li>Semáforos.</li>
<li>Colas de mensajes.</li>
<li>Tuberías (pipes)</li>
<li>Bloques de memoria compartida.</li>
</ul>
<p>En realidad algunos de estos mecanismos se utilizan más para intercomunicar procesos, aunque para los programadores Java la forma de resolver el problema de la &#8220;sección crítica&#8221; es más simple.</p>
<p>En Java, si el programador piensa que un trozo de código es peligroso puede ponerle la palabra clave <code class="docutils literal"><span class="pre">synchronized</span></code> y la máquina virtual Java protege el código automáticamente.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span>    <span class="cm">/* La máquina virtual Java evitará que más de un proceso/hilo acceda a este método*/</span>
    <span class="kd">synchronized</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actualizarPension</span><span class="o">(</span><span class="kt">int</span> <span class="n">nuevoValor</span><span class="o">){</span>
            <span class="cm">/*..trozo de código largo omitido*/</span>
            <span class="k">this</span><span class="o">.</span><span class="na">pension</span><span class="o">=</span><span class="n">nuevoValor</span>
    <span class="o">}</span>


    <span class="cm">/* Otro ejemplo, ahora no hemos protegido un método entero,</span>
<span class="cm">sino solo un pequeño trozo de código.*/</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="cm">/* Código omitido*/</span>
            <span class="kd">synchronized</span> <span class="o">{</span>
                    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">;</span>
                    <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="documentacion">
<h2>Documentación<a class="headerlink" href="#documentacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para hacer la documentación tradicionalmente hemos usado JavaDOC. Sin embargo, las versiones más modernas de Java incluyen las <strong>anotaciones</strong>.</p>
<p>Una anotación es un texto que pueden utilizar otras herramientas (no solo el Javadoc) para comprender mejor qué hace ese código o como documentarlo.</p>
<p>Cualquiera puede crear sus propias anotaciones simplemente definiéndolas como un interfaz Java. Sin embargo tendremos que programar nuestras propias clases para extraer la información que proporcionan dichas anotaciones.</p>
</div>
<div class="section" id="depuracion">
<h2>Depuración.<a class="headerlink" href="#depuracion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>¿Como se depura un programa multiproceso/multihilo? Por desgracia puede ser muy difícil:</p>
<ol class="arabic simple">
<li>No todos los depuradores son capaces.</li>
<li>A veces cuando un depurador interviene en un proceso puede ocurrir que el resto de procesos consigan ejecutarse en el orden correcto y dar lugar a que el programa parezca que funciona bien.</li>
<li>Un error muy típico es la <code class="docutils literal"><span class="pre">NullPointerException</span></code>, que en muchos casos se deben a la utilización de referencias Java no inicializadas o incluso a la devolución de valores NULL que luego no se comprueban en alguna parte del código.</li>
<li>Se puede usar el método <code class="docutils literal"><span class="pre">redirectError</span></code> pasándole un objeto de tipo <code class="docutils literal"><span class="pre">File</span></code> para que los mensajes de error vayan a un fichero.</li>
<li>Se debe recordar que la &#8220;visión&#8221; que tiene Eclipse del sistema puede ser <strong>muy diferente</strong> de la visión que tiene el proceso lanzado. Un problema muy común es que el proceso lanzado no encuentre clases, lo que obligará a indicar el <code class="docutils literal"><span class="pre">CLASSPATH</span></code>.</li>
<li>Un buen método para determinar errores consiste en utilizar el entorno de consola para lanzar comandos para ver &#8220;como es el sistema&#8221; que ve un proceso fuera de Eclipse (o de cualquier otro entorno).</li>
</ol>
<p>En general todos los fallos en un programa multiproceso vienen derivado de no usar <code class="docutils literal"><span class="pre">synchronized</span></code> de la forma correcta.</p>
</div>
<div class="section" id="examen">
<h2>Examen<a class="headerlink" href="#examen" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Fecha por determinar</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Tabla de Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">Programación multiproceso</a><ul>
<li><a class="reference internal" href="#ejecutables-procesos-servicios">Ejecutables. Procesos. Servicios.</a><ul>
<li><a class="reference internal" href="#ejecutables">Ejecutables</a></li>
<li><a class="reference internal" href="#procesos">Procesos</a></li>
<li><a class="reference internal" href="#servicios">Servicios</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hilos">Hilos.</a></li>
<li><a class="reference internal" href="#programacion-concurrente">Programación concurrente.</a></li>
<li><a class="reference internal" href="#programacion-paralela-y-distribuida">Programación paralela y distribuida.</a></li>
<li><a class="reference internal" href="#creacion-de-procesos">Creación de procesos.</a></li>
<li><a class="reference internal" href="#comunicacion-entre-procesos">Comunicación entre procesos.</a></li>
<li><a class="reference internal" href="#ejercicio">Ejercicio</a></li>
<li><a class="reference internal" href="#ejercicio-resuelto">Ejercicio resuelto</a><ul>
<li><a class="reference internal" href="#operaciones-con-ficheros">Operaciones con ficheros</a></li>
<li><a class="reference internal" href="#procesado-de-ficheros">Procesado de ficheros</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lanzamiento-de-los-procesos">Lanzamiento de los procesos</a></li>
<li><a class="reference internal" href="#ejercicio-propuesto-i">Ejercicio propuesto (I)</a><ul>
<li><a class="reference internal" href="#solucion-al-ejercicio-propuesto-i">Solución al ejercicio propuesto (I)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gestion-de-procesos">Gestión de procesos.</a></li>
<li><a class="reference internal" href="#comandos-para-la-gestion-de-procesos-en-sistemas-libres-y-propietarios">Comandos para la gestión de procesos en sistemas libres y propietarios.</a><ul>
<li><a class="reference internal" href="#prioridades">Prioridades</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sincronizacion-entre-procesos">Sincronización entre procesos.</a><ul>
<li><a class="reference internal" href="#mecanismos-para-controlar-secciones-criticas">Mecanismos para controlar secciones críticas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#documentacion">Documentación</a></li>
<li><a class="reference internal" href="#depuracion">Depuración.</a></li>
<li><a class="reference internal" href="#examen">Examen</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="capítulo anterior">Programacion de servicios y procesos</a></li>
      <li>Next: <a href="tema2.html" title="próximo capítulo">Programación multihilo</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/textos/tema1.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Ir a" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Oscar Gomez.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/textos/tema1.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>