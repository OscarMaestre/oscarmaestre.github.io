<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programación de comunicaciones en red &#8212; Apuntes de Lenguajes de Marcas v1.3</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="Apuntes de Lenguajes de Marcas v1.3" href="../index.html" />
    <link rel="next" title="Generación de servicios en red" href="tema4.html" />
    <link rel="prev" title="Programación multihilo" href="tema2.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="programacion-de-comunicaciones-en-red">
<h1>Programación de comunicaciones en red<a class="headerlink" href="#programacion-de-comunicaciones-en-red" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="comunicacion-entre-aplicaciones">
<h2>Comunicación entre aplicaciones.<a class="headerlink" href="#comunicacion-entre-aplicaciones" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En Java toda la comunicación vista en primer curso de DAM consiste en dos cosas</p>
<ul class="simple">
<li>Entrada/salida por consola: con las clases <code class="docutils literal"><span class="pre">System.in</span></code> o <code class="docutils literal"><span class="pre">System.out</span></code>.</li>
<li>Lectura/escritura en ficheros: con las clases File y similares.</li>
</ul>
<p>Se puede avanzar un paso más utilizando Java para enviar datos a través de Internet a otro programa Java remoto, que es lo que haremos en este capítulo.</p>
</div>
<div class="section" id="roles-cliente-y-servidor">
<h2>Roles cliente y servidor.<a class="headerlink" href="#roles-cliente-y-servidor" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Cuando se hacen programas Java que se comuniquen lo habitual es que uno o varios actúen de cliente y uno o varios actúen de servidores.</p>
<ul class="simple">
<li>Servidor: espera peticiones, recibe datos de entrada y devuelve respuestas.</li>
<li>Cliente: genera peticiones, las envía a un servidor y espera respuestas.</li>
</ul>
<p>Un factor fundamental en los servidores es que tienen que ser capaces de procesar varias peticiones a la vez: <strong>deben ser multihilo</strong>.</p>
<p>Su arquitectura típica es la siguiente:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
        <span class="n">peticion</span><span class="o">=</span><span class="n">esperarPeticion</span><span class="o">();</span>
        <span class="n">hiloAsociado</span><span class="o">=</span><span class="k">new</span> <span class="n">Hilo</span><span class="o">();</span>
        <span class="n">hiloAsociado</span><span class="o">.</span><span class="na">atender</span><span class="o">(</span><span class="n">peticion</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="recordatorio-de-los-flujos-en-java">
<h2>Recordatorio de los flujos en Java<a class="headerlink" href="#recordatorio-de-los-flujos-en-java" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="inputstreams-y-outputstreams">
<h3>InputStreams y OutputStreams<a class="headerlink" href="#inputstreams-y-outputstreams" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Manejan bytes a secas. Por ejemplo, si queremos leer un fichero byte a byte usaremos <code class="docutils literal"><span class="pre">FileInputStream</span></code> y si queremos escribir usaremos <code class="docutils literal"><span class="pre">FileOutputStream</span></code>.</p>
<p>Son operaciones a muy bajo nivel que usaremos muy pocas veces (por ejemplo, solo si quisiéramos cambiar el primer byte de un archivo). En general usaremos otras clases más cómodas de usar.</p>
</div>
<div class="section" id="readers-y-writers">
<h3>Readers y Writers<a class="headerlink" href="#readers-y-writers" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En lugar de manejar <em>bytes</em> manejan <em>caracteres</em> (recordemos que hoy en día y con Unicode una letra como la <em>ñ</em> en realidad podría ocupar más de un byte).</p>
<p>Así, cuando queramos leer letras de un archivo usaremos clases como <code class="docutils literal"><span class="pre">FileReader</span></code> y <code class="docutils literal"><span class="pre">FileWriter</span></code>.</p>
<p>Las clases <code class="docutils literal"><span class="pre">Readers</span></code> y <code class="docutils literal"><span class="pre">Writers</span></code> en realidad se apoyan sobre las <code class="docutils literal"><span class="pre">InputStreams</span></code> y <code class="docutils literal"><span class="pre">OutputStreams</span></code>.</p>
<p>A veces nos interesará mezclar conceptos y por ejemplo poder tener una clase que use caracteres cuando a lo mejor Java nos ha dado una clase que usa bytes. Así, por ejemplo <code class="docutils literal"><span class="pre">InputStreamReader</span></code> puede coger un objeto que lea bytes y nos devolverá caracteres. De la misma forma <code class="docutils literal"><span class="pre">OutputStreamWriter</span></code> coge letras y devuelve los bytes que la componen.</p>
</div>
<div class="section" id="bufferedreaders-y-printwriters">
<h3><code class="docutils literal"><span class="pre">BufferedReaders</span></code> y <code class="docutils literal"><span class="pre">PrintWriters</span></code><a class="headerlink" href="#bufferedreaders-y-printwriters" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando trabajamos con caracteres (que recordemos pueden tener varios bytes) normalmente no trabajamos de uno en uno. Es más frecuente usar <strong>líneas</strong> que se leen y escriben de una sola vez. Así por ejemplo, la clase <code class="docutils literal"><span class="pre">PrintWriter</span></code> tiene un método <code class="docutils literal"><span class="pre">print(ln)</span></code> que puede imprimir elementos complejos como <code class="docutils literal"><span class="pre">floats</span></code> o cadenas largas.</p>
<p>Además, Java ofrece clases que gestionan automáticamente los <em>buffers</em> por nosotros lo que nos da más comodidad y eficiencia. Por ello es muy habitual hacer cosas como esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">lectorEficiente</span> <span class="o">=</span> <span class="k">new</span>
        <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="s">&quot;fich1.txt&quot;</span><span class="o">));</span>
<span class="n">escritorEficiente</span> <span class="o">=</span> <span class="k">new</span>
        <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">&quot;fich2.txt&quot;</span><span class="o">));</span>
</pre></div>
</div>
<p>En el primer caso creamos un objeto <code class="docutils literal"><span class="pre">FileReader</span></code> que es capaz de leer caracteres de <code class="docutils literal"><span class="pre">fich1.txt</span></code>. Como esto nos parece poco práctico creamos otro objeto a partir del primero de tipo <code class="docutils literal"><span class="pre">BufferedReader</span></code> que nos permitirá leer bloques enteros de texto.</p>
<p>De hecho, si se comprueba la ayuda de la clase <code class="docutils literal"><span class="pre">FileReader</span></code> se verá que solo hay un método <code class="docutils literal"><span class="pre">read</span></code> que devuelve un <code class="docutils literal"><span class="pre">int</span></code>, es decir el siguiente <strong>carácter</strong> disponible, lo que hace que el método sea muy incómodo. Sin embargo <code class="docutils literal"><span class="pre">BufferedReader</span></code> nos resuelve esta incomodidad permitiéndonos trabajar con líneas.</p>
</div>
</div>
<div class="section" id="elementos-de-programacion-de-aplicaciones-en-red-librerias">
<h2>Elementos de programación de aplicaciones en red. Librerías.<a class="headerlink" href="#elementos-de-programacion-de-aplicaciones-en-red-librerias" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En Java toda la infraestructura de clases para trabajar con redes está en el paquete <code class="docutils literal"><span class="pre">java.net</span></code>.</p>
<p>En muchos casos nuestros programas empezarán con la sentencia <code class="docutils literal"><span class="pre">import</span> <span class="pre">java.net.*</span></code> pero muchos entornos (como Eclipse) son capaces de importar automáticamente las clases necesarias.</p>
<div class="section" id="la-clase-url">
<h3>La clase URL<a class="headerlink" href="#la-clase-url" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La clase URL permite gestionar accesos a URLs del tipo <code class="docutils literal"><span class="pre">http://marca.com/fichero.html</span></code> y descargar cosas con bastante sencillez.</p>
<p>Al crear un objeto URL se debe capturar la excepción <code class="docutils literal"><span class="pre">MalformedURLException</span></code> que sucede cuando hay algún error en la URL, como por ejemplo escribir <code class="docutils literal"><span class="pre">htp://marca.com</span></code> en lugar de <code class="docutils literal"><span class="pre">http://marca.com</span></code> (obsérvese que el primero tiene un sola t en http en lugar de dos).</p>
<p>La clase URL nos ofrece un método <code class="docutils literal"><span class="pre">openStream</span></code> que nos devuelve un flujo básico de bytes. Podemos crear objetos más sofisticados para leer bloques como muestra el programa siguiente:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GestorDescargas</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">descargarArchivo</span><span class="o">(</span>
                        <span class="n">String</span> <span class="n">url_descargar</span><span class="o">,</span>
                        <span class="n">String</span> <span class="n">nombreArchivo</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Descargando &quot;</span>
                                <span class="o">+</span><span class="n">url_descargar</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">URL</span> <span class="n">laUrl</span><span class="o">=</span><span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">url_descargar</span><span class="o">);</span>
                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">laUrl</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
                        <span class="n">InputStreamReader</span> <span class="n">reader</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">bReader</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
                        <span class="n">FileWriter</span> <span class="n">escritorFichero</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">nombreArchivo</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">;</span>
                        <span class="k">while</span> <span class="o">((</span><span class="n">linea</span><span class="o">=</span><span class="n">bReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())!=</span><span class="kc">null</span><span class="o">){</span>
                                <span class="n">escritorFichero</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">escritorFichero</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">bReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;URL mal escrita!&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;Fallo en la lectura del fichero&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argumentos</span><span class="o">){</span>
                <span class="n">GestorDescargas</span> <span class="n">gd</span><span class="o">=</span><span class="k">new</span> <span class="n">GestorDescargas</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">base</span><span class="o">=</span>
                        <span class="s">&quot;http://10.13.0.20:8000&quot;</span><span class="o">+</span>
                                        <span class="s">&quot;/ServiciosProcesos/textos/&quot;</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">String</span> <span class="n">url</span><span class="o">=</span><span class="n">base</span><span class="o">+</span><span class="s">&quot;tema&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">&quot;.rst&quot;</span><span class="o">;</span>
                        <span class="n">gd</span><span class="o">.</span><span class="na">descargarArchivo</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="repaso-de-redes">
<h2>Repaso de redes<a class="headerlink" href="#repaso-de-redes" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En redes el protocolo IP es el responsable de dos cuestiones fundamentales:</p>
<ul class="simple">
<li>Establecer un sistema de direcciones universal (direcciones IP)</li>
<li>Establecer los mecanismos de enrutado.</li>
</ul>
<p>Como programadores el segundo no nos interesa, pero el primero será absolutamente fundamental para contactar con programas que estén en una ubicación remota.</p>
<p>Una ubicación remota <em>siempre</em> tendrá una dirección
IP pero <em>solo a veces tendrá un nombre DNS</em>. Para nosotros no habrá diferencia ya que si es necesario el sistema operativo traducirá de nombre DNS a IP.</p>
<p>Otro elemento necesario en la comunicación en redes es el uso de un puerto de un cierto protocolo:</p>
<ul class="simple">
<li>TCP: ofrece fiabilidad a los programas.</li>
<li>UDP: ofrece velocidad sacrificando la fiabilidad.</li>
</ul>
<p>A partir de ahora cuando usemos un número de puerto habrá que comprobar si ese número ya está usado.</p>
<p>Por ejemplo, es mala idea que nuestros servidores usen el puerto 80 TCP para aceptar peticiones, probablemente ya esté en uso.
Antes de usar un puerto en una aplicación comercial deberíamos consultar la lista de &#8220;IANA assigned ports&#8221;.</p>
<p>En líneas generales se pueden usar los puertos desde 1024 TCP a 49151 TCP, pero deberíamos comprobar que el número que elegimos no sea un número usado por un puerto de alguna aplicación que haya en la empresa.</p>
<p>En las prácticas de clase usaremos el 9876 TCP. Si se desea conectar desde el instituto con algún programa ejecutado en casa se deberá &#8220;abrir el puerto 9876 TCP&#8221;. Abrir un puerto consiste en configurar el router para que <strong>SÍ ACEPTE TRÁFICO INICIADO DESDE EL EXTERIOR</strong> cosa que no hace nunca por motivos de protección.</p>
</div>
<div class="section" id="funciones-y-objetos-de-las-librerias">
<h2>Funciones y objetos de las librerías.<a class="headerlink" href="#funciones-y-objetos-de-las-librerias" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La clase URL proporciona un mecanismo muy sencillo pero por desgracia completamente atado al protocolo de las URL.</p>
<p>Java ofrece otros objetos que permiten tener un mayor control sobre lo que se envía o recibe a través de la red. Por desgracia esto implica que en muchos casos tendremos solo flujos de bajo nivel (streams).</p>
<p>En concreto Java ofrece dos elementos fundamentales para crear programas que usen redes</p>
<ul class="simple">
<li>Sockets</li>
<li>ServerSockets</li>
</ul>
</div>
<div class="section" id="sockets">
<h2>Sockets.<a class="headerlink" href="#sockets" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Un <em>socket</em> es un objeto Java que nos permite contactar con un programa o servidor remoto. Dicho objeto nos proporcionará flujos de entrada y/o salida y podremos comunicarnos con dicho programa.</p>
<p>Existe otro tipo de sockets, los <em>ServerSocket</em>. Se utilizan para crear programas que acepten conexiones o peticiones.</p>
<p>Todos los objetos mencionados en este tema están en el paquete <code class="docutils literal"><span class="pre">java.net</span></code>.</p>
</div>
<div class="section" id="creacion-de-sockets">
<h2>Creación de sockets.<a class="headerlink" href="#creacion-de-sockets" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En el siguiente código puede verse el proceso básico de creación de un socket. En los párrafos siguientes explicaremos el significado de los bloques de código.:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Conector</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">destino</span><span class="o">=</span><span class="s">&quot;www.google.com&quot;</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">puertoDestino</span><span class="o">=</span><span class="mi">80</span><span class="o">;</span>
                <span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span>
                                <span class="n">destino</span><span class="o">,</span> <span class="n">puertoDestino</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                        <span class="c1">//Si llegamos aquí es que la conexión</span>
                        <span class="c1">//sí se hizo.</span>

                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>


                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;No se pudo establecer la conexion &quot;</span><span class="o">+</span>
                                <span class="s">&quot; o hubo un fallo al leer datos.&quot;</span>
                        <span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Para poder crear un socket primero necesitamos una dirección con la que contactar. Toda dirección está formada por dirección IP (o DNS) y un puerto. En nuestro caso intentaremos contactar con <code class="docutils literal"><span class="pre">www.google.com:80</span></code>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">destino</span><span class="o">=</span><span class="s">&quot;www.google.com&quot;</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">puertoDestino</span><span class="o">=</span><span class="mi">80</span><span class="o">;</span>
<span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
<span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span>
        <span class="n">InetSocketAddress</span><span class="o">(</span>
                        <span class="n">destino</span><span class="o">,</span> <span class="n">puertoDestino</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="enlazado-y-establecimiento-de-conexiones">
<h2>Enlazado y establecimiento de conexiones.<a class="headerlink" href="#enlazado-y-establecimiento-de-conexiones" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El paso crítico para iniciar la comunicación es llamar al método <code class="docutils literal"><span class="pre">connect</span></code>. Este método puede disparar una excepción del tipo <code class="docutils literal"><span class="pre">IOException</span></code> que puede significar dos cosas:</p>
<ul class="simple">
<li>La conexión no se pudo establecer.</li>
<li>Aunque la conexión se estableció no fue posible leer o escribir datos.</li>
</ul>
<p>Así, la conexión debería realizarse así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">{</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
        <span class="c1">//Si llegamos aquí es que la conexión</span>
        <span class="c1">//sí se hizo.</span>

        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>

<span class="o">}</span>  <span class="c1">//Fin del try</span>
<span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                <span class="s">&quot;No se pudo establecer la conexion &quot;</span><span class="o">+</span>
                <span class="s">&quot; o hubo un fallo al leer datos.&quot;</span>
        <span class="o">);</span>
<span class="o">}</span> <span class="c1">//Fin del catch IOException</span>
</pre></div>
</div>
</div>
<div class="section" id="utilizacion-de-sockets-para-la-transmision-y-recepcion-de-informacion">
<h2>Utilización de sockets para la transmisión y recepción de información.<a class="headerlink" href="#utilizacion-de-sockets-para-la-transmision-y-recepcion-de-informacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La clase <code class="docutils literal"><span class="pre">Socket</span></code> tiene dos métodos llamados <code class="docutils literal"><span class="pre">getInputStream</span></code> y <code class="docutils literal"><span class="pre">getOutputSream</span></code> que nos permiten obtener <em>flujos orientados a bytes</em>. Recordemos que es posible crear nuestros propios flujos, con más métodos que ofrecen más comodidad.</p>
<div class="section" id="el-ejemplo-completo">
<h3>El ejemplo completo<a class="headerlink" href="#el-ejemplo-completo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Podemos contactar con un programa cualquiera escrito en cualquier lenguaje y enviar las peticiones de acuerdo a un protocolo. Nuestro programa podrá leer las respuestas independientemente de como fuera el servidor.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Conector</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Iniciando...&quot;</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">destino</span><span class="o">=</span><span class="s">&quot;10.8.0.253&quot;</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">puertoDestino</span><span class="o">=</span><span class="mi">80</span><span class="o">;</span>
                <span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span>
                                <span class="n">destino</span><span class="o">,</span> <span class="n">puertoDestino</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                        <span class="c1">//Si llegamos aquí es que la conexión</span>
                        <span class="c1">//sí se hizo.</span>

                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>

                        <span class="c1">//Flujos que manejan caracteres</span>
                        <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">OutputStreamWriter</span> <span class="n">osw</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>

                        <span class="c1">//Flujos de líneas</span>
                        <span class="n">BufferedReader</span> <span class="n">bReader</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                        <span class="n">PrintWriter</span> <span class="n">pWriter</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">osw</span><span class="o">);</span>


                        <span class="n">pWriter</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;GET /index.html&quot;</span><span class="o">);</span>
                        <span class="n">pWriter</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">;</span>
                        <span class="n">FileWriter</span> <span class="n">escritorArchivo</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">&quot;resultado.txt&quot;</span><span class="o">);</span>
                        <span class="k">while</span> <span class="o">((</span><span class="n">linea</span><span class="o">=</span><span class="n">bReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">){</span>
                                <span class="n">escritorArchivo</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">escritorArchivo</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">pWriter</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">bReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">isr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">osw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;No se pudo establecer la conexion &quot;</span><span class="o">+</span>
                                <span class="s">&quot; o hubo un fallo al leer datos.&quot;</span>
                        <span class="o">);</span>
                <span class="o">}</span> <span class="c1">//Fin del catch</span>
        <span class="o">}</span> <span class="c1">//Fin del main</span>
<span class="o">}</span> <span class="c1">//Fin de la clase Conector</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="programacion-de-aplicaciones-cliente-y-servidor">
<h2>Programación de aplicaciones cliente y servidor.<a class="headerlink" href="#programacion-de-aplicaciones-cliente-y-servidor" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Al crear aplicaciones cliente y servidor puede ocurrir que tengamos que implementar varias operaciones:</p>
<ul class="simple">
<li>Si tenemos que programar el servidor <strong>deberemos definir un protocolo</strong> de acceso a ese servidor.</li>
<li>Si tenemos que programar solo el cliente <strong>necesitaremos conocer el protocolo de acceso</strong> a ese servidor.</li>
<li>Si tenemos que programar los dos tendremos que empezar por <strong>definir el protocolo de comunicación entre ambos</strong>.</li>
</ul>
<p>En el ejemplo siguiente puede verse un ejemplo para Python 3 que implementa un servidor de cálculo. El servidor tiene un protocolo muy rígido (demasiado) que consiste en lo siguiente:</p>
<ol class="arabic simple">
<li>El servidor espera que primero envíen la operación que puede ser <code class="docutils literal"><span class="pre">+</span></code> o <code class="docutils literal"><span class="pre">-</span></code>. La operación debe terminar con un fin de línea UNIX (<code class="docutils literal"><span class="pre">\n</span></code>)</li>
<li>Despues acepta un número de dos cifras (ni una ni tres) terminado en un fín de línea UNIX.</li>
<li>Despues acepta un segundo número de dos cifras terminado en un fin de línea UNIX.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socketserver</span>
<span class="n">TAM_MAXIMO_PARAMETROS</span><span class="o">=</span><span class="mi">64</span>
<span class="n">PUERTO</span><span class="o">=</span><span class="mi">9876</span>
<span class="k">class</span> <span class="nc">GestorConexion</span><span class="p">(</span>
        <span class="n">socketserver</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">leer_cadena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">LONGITUD</span><span class="p">):</span>
                <span class="n">cadena</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">LONGITUD</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">cadena</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">convertir_a_cadena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">calcular_resultado</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
                <span class="n">n1</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
                <span class="n">n2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>

                <span class="n">op</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">convertir_a_cadena</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="s2">&quot;+&quot;</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">n1</span><span class="o">+</span><span class="n">n2</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">==</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">n1</span><span class="o">-</span><span class="n">n2</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="sd">&quot;&quot;&quot;Controlador de evento &#39;NuevaConexion&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">direccion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">operacion</span>   <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">leer_cadena</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">num1</span>        <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">leer_cadena</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">num2</span>        <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">leer_cadena</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">print</span> <span class="p">(</span><span class="n">direccion</span><span class="o">+</span><span class="s2">&quot; pregunta:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">operacion</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num2</span><span class="p">))</span>

                <span class="n">resultado</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calcular_resultado</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="n">operacion</span><span class="p">,</span> <span class="n">num2</span><span class="p">)</span>
                <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Devolviendo a &quot;</span> <span class="o">+</span> <span class="n">direccion</span><span class="o">+</span><span class="s2">&quot; el resultado &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">resultado</span><span class="p">))</span>
                <span class="n">bytes_resultado</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resultado</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">bytes_resultado</span><span class="p">)</span>
<span class="n">servidor</span><span class="o">=</span><span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">((</span><span class="s2">&quot;10.13.0.20&quot;</span><span class="p">,</span> <span class="mi">9876</span><span class="p">),</span> <span class="n">GestorConexion</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Servidor en marcha.&quot;</span><span class="p">)</span>
<span class="n">servidor</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div>
<p>La comunicación Java con el servidor sería algo así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bSuma</span><span class="o">=</span><span class="s">&quot;+\n&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">bOp1</span><span class="o">=</span><span class="s">&quot;42\n&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">bOp2</span><span class="o">=</span><span class="s">&quot;34\n&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>

<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bSuma</span><span class="o">);</span>
<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bOp1</span><span class="o">);</span>
<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bOp2</span><span class="o">);</span>
<span class="n">os</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
<span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span>
        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
<span class="n">String</span> <span class="n">cadenaRecibida</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Recibido:&quot;</span><span class="o">+</span>
                <span class="n">cadenaRecibida</span><span class="o">);</span>

<span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</pre></div>
</div>
<div class="section" id="ejemplo-de-servidor-java">
<h3>Ejemplo de servidor Java<a class="headerlink" href="#ejemplo-de-servidor-java" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Supongamos que se nos pide crear un servidor de operaciones de cálculo que sea menos estricto que el anterior:</p>
<ul class="simple">
<li>Cualquier parámetro que envíe el usuario debe ir terminado en un fin de línea UNIX (<code class="docutils literal"><span class="pre">\n</span></code>).</li>
<li>El usuario enviará primero un símbolo &#8220;+&#8221;, &#8220;-&#8221;, &#8220;*&#8221; o &#8220;/&#8221;.</li>
<li>Despues se puede enviar un positivo de 1 a 8 cifras. El usuario podría equivocarse y enviar en vez de &#8220;3762&#8221; algo como &#8220;37a62&#8221;. En ese caso se asume que el parámetro es 0.</li>
<li>Despues se envía un segundo positivo de 1 a 8 cifras igual que el anterior.</li>
<li>Cuando el servidor haya recogido todos los parámetros contestará al cliente con un positivo de 1 a 16 cifras.</li>
</ul>
<p>Antes de empezar crear el código que permita procesar estos parámetros complejos.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServidorCalculo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerNumero</span><span class="o">(</span><span class="n">String</span> <span class="n">linea</span><span class="o">){</span>
                <span class="cm">/* 1. Comprobar si es un número</span>
<span class="cm">                 * 2. Ver si el número es correcto (32a75)</span>
<span class="cm">                 * 3. Ver si tiene de 1 a 8 cifras</span>
<span class="cm">                 */</span>
                <span class="kt">int</span> <span class="n">numero</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">numero</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="cm">/* Si el número es mayor de 100 millones no</span>
<span class="cm">                 * es válido tampoco</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">numero</span><span class="o">&gt;=</span><span class="mi">100000000</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">numero</span><span class="o">;</span>

        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">(){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Arrancado el servidor&quot;</span><span class="o">);</span>

                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>

                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Así, el código completo del servidor sería:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServidorCalculo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerNumero</span><span class="o">(</span><span class="n">String</span> <span class="n">linea</span><span class="o">){</span>
                <span class="cm">/* 1. Comprobar si es un número</span>
<span class="cm">                 * 2. Ver si el número es correcto (32a75)</span>
<span class="cm">                 * 3. Ver si tiene de 1 a 8 cifras</span>
<span class="cm">                 */</span>
                <span class="kt">int</span> <span class="n">numero</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">numero</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="cm">/* Si el número es mayor de 100 millones no</span>
<span class="cm">                 * es válido tampoco</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">numero</span><span class="o">&gt;=</span><span class="mi">100000000</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">numero</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calcular</span><span class="o">(</span><span class="n">String</span> <span class="n">op</span><span class="o">,</span> <span class="n">String</span> <span class="n">n1</span><span class="o">,</span> <span class="n">String</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="kt">char</span> <span class="n">simbolo</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num1</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n1</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num2</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n2</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">simbolo</span><span class="o">==</span><span class="sc">&#39;+&#39;</span><span class="o">){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">num1</span><span class="o">+</span><span class="n">num2</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Arrancado el servidor&quot;</span><span class="o">);</span>
                <span class="n">ServerSocket</span> <span class="n">socketEscucha</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">socketEscucha</span><span class="o">=</span><span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">9876</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;No se pudo poner un socket &quot;</span><span class="o">+</span>
                                        <span class="s">&quot;a escuchar en TCP 9876&quot;</span><span class="o">);</span>
                        <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="n">Socket</span> <span class="n">conexion</span><span class="o">=</span><span class="n">socketEscucha</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion recibida!&quot;</span><span class="o">);</span>
                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">conexion</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">bf</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">=</span><span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">num1</span><span class="o">=</span><span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">num2</span><span class="o">=</span><span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="cm">/* Calculamos el resultado*/</span>
                        <span class="n">Integer</span> <span class="n">result</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">calcular</span><span class="o">(</span><span class="n">linea</span><span class="o">,</span> <span class="n">num1</span><span class="o">,</span> <span class="n">num2</span><span class="o">);</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">conexion</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                        <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
                        <span class="n">pw</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
                        <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Y el cliente sería:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClienteCalculo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedReader</span> <span class="nf">getFlujo</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">is</span><span class="o">){</span>
                <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">bfr</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="cm">/**</span>
<span class="cm">         * @param args</span>
<span class="cm">         * @throws IOException</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span><span class="k">new</span>
                                <span class="n">InetSocketAddress</span><span class="o">(</span><span class="s">&quot;10.13.0.20&quot;</span><span class="o">,</span> <span class="mi">9876</span><span class="o">);</span>
                <span class="n">Socket</span> <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">socket</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">=</span>
                                <span class="n">ClienteCalculo</span><span class="o">.</span><span class="na">getFlujo</span><span class="o">(</span>
                                                <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
                <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">=</span><span class="k">new</span>
                                <span class="n">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;+\n&quot;</span><span class="o">);</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;42\n&quot;</span><span class="o">);</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;84\n&quot;</span><span class="o">);</span>
                <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">resultado</span><span class="o">=</span><span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span>
                        <span class="o">(</span><span class="s">&quot;El resultado fue:&quot;</span><span class="o">+</span><span class="n">resultado</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="utilizacion-de-hilos-en-la-programacion-de-aplicaciones-en-red">
<h2>Utilización de hilos en la programación de aplicaciones en red.<a class="headerlink" href="#utilizacion-de-hilos-en-la-programacion-de-aplicaciones-en-red" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En el caso de aplicaciones que necesiten aceptar varias conexiones <strong>habrá que mover todo el código de gestión de peticiones a una clase que implemente Runnable</strong></p>
<p>Ahora el servidor será así:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
        <span class="n">Socket</span> <span class="n">conexion</span><span class="o">=</span><span class="n">socketEscucha</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion recibida&quot;</span><span class="o">);</span>
        <span class="n">Peticion</span> <span class="n">p</span><span class="o">=</span><span class="k">new</span> <span class="n">Peticion</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>
        <span class="n">Thread</span> <span class="n">hilo</span><span class="o">=</span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Pero ahora tendremos una clase Petición como esta:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Peticion</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
        <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">;</span>
        <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">;</span>
        <span class="n">Socket</span> <span class="n">socket</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Peticion</span><span class="o">(</span><span class="n">Socket</span> <span class="n">socket</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">socket</span><span class="o">=</span><span class="n">socket</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerNumero</span><span class="o">(</span><span class="n">String</span> <span class="n">linea</span><span class="o">){</span>
                <span class="cm">/* 1. Comprobar si es un número</span>
<span class="cm">                 * 2. Ver si el número es correcto (32a75)</span>
<span class="cm">                 * 3. Ver si tiene de 1 a 8 cifras</span>
<span class="cm">                 */</span>
                <span class="kt">int</span> <span class="n">numero</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">numero</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">linea</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="cm">/* Si el número es mayor de 100 millones no</span>
<span class="cm">                 * es válido tampoco</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">numero</span><span class="o">&gt;=</span><span class="mi">100000000</span><span class="o">){</span>
                        <span class="n">numero</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">numero</span><span class="o">;</span>

        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calcular</span><span class="o">(</span><span class="n">String</span> <span class="n">op</span><span class="o">,</span> <span class="n">String</span> <span class="n">n1</span><span class="o">,</span> <span class="n">String</span> <span class="n">n2</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">resultado</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="kt">char</span> <span class="n">simbolo</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num1</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n1</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">num2</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerNumero</span><span class="o">(</span><span class="n">n2</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">simbolo</span><span class="o">==</span><span class="sc">&#39;+&#39;</span><span class="o">){</span>
                        <span class="n">resultado</span><span class="o">=</span><span class="n">num1</span><span class="o">+</span><span class="n">num2</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">resultado</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                        <span class="n">bfr</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                        <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                        <span class="n">pw</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">linea</span><span class="o">;</span>
                        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                                <span class="n">linea</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="n">String</span> <span class="n">num1</span><span class="o">=</span><span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="n">String</span> <span class="n">num2</span><span class="o">=</span><span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="cm">/* Calculamos el resultado*/</span>
                                <span class="n">Integer</span> <span class="n">result</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">calcular</span><span class="o">(</span><span class="n">linea</span><span class="o">,</span> <span class="n">num1</span><span class="o">,</span> <span class="n">num2</span><span class="o">);</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;El servidor dio resultado:&quot;</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
                                <span class="n">pw</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
                                <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                        <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="ejercicio-servicio-de-ordenacion">
<h3>Ejercicio: servicio de ordenación<a class="headerlink" href="#ejercicio-servicio-de-ordenacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Crear una arquitectura cliente/servidor que permita a un cliente, enviar dos cadenas a un servidor para saber cual de ellas va antes que otra:</p>
<ul class="simple">
<li>Un cliente puede enviar las cadenas &#8220;hola&#8221;, &#8220;mundo&#8221;. El servidor comprobará que en el diccionario la primera va antes que la segunda, por lo cual contestará &#8220;hola&#8221;, &#8220;mundo&#8221;.</li>
<li>Si el cliente enviase &#8220;mundo&#8221;, &#8220;hola&#8221; el servidor debe devolver la respuesta &#8220;hola&#8221;, &#8220;mundo&#8221;.</li>
</ul>
<p>Debido a posibles mejoras futuras, se espera que el servidor sea capaz de saber qué versión del protocolo se maneja. Esto es debido a que en el futuro se espera lanzar una versión 2 del protocolo en la que se puedan enviar varias cadenas seguidas.</p>
<p>Crear el protocolo, el código Java del cliente y el código Java del servidor con capacidad para procesar muchas peticiones a la vez (multihilo).</p>
<p>Se debe aceptar que un cliente que ya tenga un socket abierto envíe todas las parejas de cadenas que desee.</p>
</div>
<div class="section" id="una-clase-protocolo">
<h3>Una clase Protocolo<a class="headerlink" href="#una-clase-protocolo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Dado que los protocolos pueden ser variables puede ser útil encapsular el comportamiento del protocolo en una pequeña clase separada:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Protocolo</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">terminador</span><span class="o">=</span><span class="s">&quot;\n&quot;</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMensajeVersion</span><span class="o">(</span><span class="kt">int</span> <span class="n">version</span><span class="o">){</span>
                <span class="n">Integer</span> <span class="n">i</span><span class="o">=</span><span class="n">version</span><span class="o">;</span>
                <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="n">terminador</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNumVersion</span><span class="o">(</span><span class="n">String</span> <span class="n">mensaje</span><span class="o">){</span>
                <span class="n">Integer</span> <span class="n">num</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">mensaje</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">num</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMensaje</span><span class="o">(</span><span class="n">String</span> <span class="n">cadena</span><span class="o">){</span>
                <span class="k">return</span> <span class="n">cadena</span><span class="o">+</span><span class="n">terminador</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="una-clase-con-funciones-de-utilidad">
<h3>Una clase con funciones de utilidad<a class="headerlink" href="#una-clase-con-funciones-de-utilidad" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Algunas operaciones son muy sencillas, pero muy engorrosas. Alargan el código innecesariamente y lo hacen más difícil de entender. Si además se realizan a menudo puede ser interesante empaquetar toda la funcionalidad en una clase.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Utilidades</span> <span class="o">{</span>
        <span class="cm">/* Obtiene un flujo de escritura</span>
<span class="cm">        a partir de un socket*/</span>
        <span class="kd">public</span> <span class="n">PrintWriter</span> <span class="nf">getFlujoEscritura</span>
                <span class="o">(</span><span class="n">Socket</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">OutputStream</span> <span class="n">os</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">=</span><span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">pw</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="cm">/* Obtiene un flujo de lectura</span>
<span class="cm">        a partir de un socket*/</span>
        <span class="kd">public</span> <span class="n">BufferedReader</span>
                <span class="nf">getFlujoLectura</span><span class="o">(</span><span class="n">Socket</span> <span class="n">s</span><span class="o">)</span>
                                <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">InputStream</span> <span class="n">is</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                <span class="n">InputStreamReader</span> <span class="n">isr</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
                <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">isr</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">bfr</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-peticion">
<h3>La clase Petición<a class="headerlink" href="#la-clase-peticion" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Peticion</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
        <span class="n">Socket</span> <span class="n">conexionParaAtender</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Peticion</span> <span class="o">(</span> <span class="n">Socket</span> <span class="n">s</span> <span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">conexionParaAtender</span><span class="o">=</span><span class="n">s</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">PrintWriter</span> <span class="n">flujoEscritura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoEscritura</span><span class="o">(</span>
                                                <span class="k">this</span><span class="o">.</span><span class="na">conexionParaAtender</span>
                                                <span class="o">);</span>
                        <span class="n">BufferedReader</span> <span class="n">flujoLectura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoLectura</span><span class="o">(</span>
                                                <span class="n">conexionParaAtender</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">protocolo</span><span class="o">=</span>
                                        <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="kt">int</span> <span class="n">numVersion</span><span class="o">=</span>
                                        <span class="n">Protocolo</span><span class="o">.</span><span class="na">getNumVersion</span><span class="o">(</span><span class="n">protocolo</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">numVersion</span><span class="o">==</span><span class="mi">1</span><span class="o">){</span>
                                <span class="n">String</span> <span class="n">linea1</span><span class="o">=</span>
                                                <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="n">String</span> <span class="n">linea2</span><span class="o">=</span>
                                                <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                                <span class="c1">//Linea 1 va despues en el</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">linea1</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">linea2</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">){</span>
                                         <span class="n">dicc</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea2</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea1</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea1</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">linea2</span><span class="o">);</span>
                                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                                <span class="o">}</span>
                        <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                        <span class="s">&quot;No se pudo crear algún flujo&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-servidor">
<h3>La clase Servidor<a class="headerlink" href="#la-clase-servidor" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServidorOrdenacion</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">escuchar</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">ServerSocket</span> <span class="n">socket</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">socket</span><span class="o">=</span><span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">9876</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;No se pudo arrancar&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Servidor esperando&quot;</span><span class="o">);</span>
                        <span class="n">Socket</span> <span class="n">conexionCliente</span><span class="o">=</span>
                                        <span class="n">socket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Alguien conectó&quot;</span><span class="o">);</span>
                        <span class="n">Peticion</span> <span class="n">p</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">Peticion</span><span class="o">(</span><span class="n">conexionCliente</span><span class="o">);</span>
                        <span class="n">Thread</span> <span class="n">hiloAsociado</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
                        <span class="n">hiloAsociado</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span> <span class="c1">// Fin del método escuchar</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span>  <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argumentos</span><span class="o">){</span>
                <span class="n">ServidorOrdenacion</span> <span class="n">s</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">ServidorOrdenacion</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">s</span><span class="o">.</span><span class="na">escuchar</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;No se pudo arrancar&quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; el cliente o el serv&quot;</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-cliente">
<h3>La clase Cliente<a class="headerlink" href="#la-clase-cliente" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cliente</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ordenar</span><span class="o">(</span><span class="n">String</span> <span class="n">s1</span><span class="o">,</span> <span class="n">String</span> <span class="n">s2</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span><span class="s">&quot;10.13.0.20&quot;</span><span class="o">,</span> <span class="mi">9876</span><span class="o">);</span>
                <span class="n">Socket</span> <span class="n">conexion</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
                <span class="n">conexion</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Conexion establecida&quot;</span><span class="o">);</span>
                <span class="cm">/* Ahora hay que crear flujos de salida, enviar</span>
<span class="cm">                 * cadenas por allí y esperar los resultados.</span>
<span class="cm">                 */</span>
                <span class="k">try</span><span class="o">{</span>

                        <span class="n">BufferedReader</span> <span class="n">flujoLectura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoLectura</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>
                        <span class="n">PrintWriter</span> <span class="n">flujoEscritura</span><span class="o">=</span>
                                <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoEscritura</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>

                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>
                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span><span class="o">);</span>
                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s2</span><span class="o">);</span>
                        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">linea1</span><span class="o">=</span><span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">linea2</span><span class="o">=</span><span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;El servidor devolvió &quot;</span><span class="o">+</span>
                                        <span class="n">linea1</span> <span class="o">+</span> <span class="s">&quot; y &quot;</span><span class="o">+</span><span class="n">linea2</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>

                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Cliente</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">Cliente</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">c</span><span class="o">.</span><span class="na">ordenar</span><span class="o">(</span><span class="s">&quot;aaa&quot;</span><span class="o">,</span> <span class="s">&quot;bbb&quot;</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Fallo la conexion o &quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;los flujos&quot;</span><span class="o">);</span>
                <span class="o">}</span> <span class="c1">//Fin del catch</span>
        <span class="o">}</span> <span class="c1">//Fin del main</span>
<span class="o">}</span> <span class="c1">//Fin de la clase</span>
</pre></div>
</div>
</div>
<div class="section" id="ampliacion">
<h3>Ampliación<a class="headerlink" href="#ampliacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Finalmente la empresa va a necesitar una versión mejorada del servidor que permita a otros cliente enviar un número de palabras y luego las palabras. Se desea hacer todo sin romper la compatibilidad con los clientes viejos. Mostrar el código Java del servidor y del cliente.</p>
<p>En el servidor se añade este código extra a la hora de comprobar el protocolo:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="n">numVersion</span><span class="o">==</span><span class="mi">2</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Llegó un v2&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">lineaCantidadPalabras</span><span class="o">=</span>
        <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">numPalabras</span><span class="o">=</span>
                <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span>
                <span class="o">(</span><span class="n">lineaCantidadPalabras</span><span class="o">);</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">palabras</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">numPalabras</span><span class="o">];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">numPalabras</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">palabras</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span>
                        <span class="n">flujoLectura</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">palabras</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">ordenar</span><span class="o">(</span><span class="n">palabras</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">palabras</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">palabras</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="n">flujoEscritura</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Y finalmente solo habría que implementar un método en la petición que reciba un vector de <code class="docutils literal"><span class="pre">String</span></code> (las palabras) y devuelva el mismo vector pero ordenado.</p>
</div>
</div>
<div class="section" id="ejercicios">
<h2>Ejercicios<a class="headerlink" href="#ejercicios" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="sumas-de-verificacion">
<h3>Sumas de verificación<a class="headerlink" href="#sumas-de-verificacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Crear un servidor multihilo que permita a los clientes calcular &#8220;sumas de verificación&#8221; compuesta por la suma de los valores ASCII de los carácteres.</p>
<p>Así, la suma de verificación de la cadena &#8220;ABC&#8221; es 65+66+67=198.</p>
<p>El protocolo será el siguiente:</p>
<ul class="simple">
<li>El servidor esperá recibir una línea con solo un número positivo. Dicho número es la cantidad de líneas que nos va a enviar el cliente. Supongamos que envía 3.</li>
<li>Despues se deben recibir 3 líneas. En cada línea hay una sola palabra, de la cual el servidor calculará las sumas.</li>
<li>Despues el servidor contesta al cliente, y enviará 3 líneas separadas. En cada línea estará la suma de verificación. Las sumas se envían en el mismo orden que se recibieron.</li>
</ul>
<p>A modo de ejemplo si el cliente envió estas líneas</p>
<ul class="simple">
<li>2</li>
<li>ABC</li>
<li>ZZ</li>
</ul>
<p>Entonces el servidor luego enviará</p>
<ul class="simple">
<li>198 (que es la suma para ABC)</li>
<li>180 (que es la suma para ZZ)</li>
</ul>
</div>
<div class="section" id="solucion-a-las-sumas-de-verificacion">
<h3>Solución a las sumas de verificación<a class="headerlink" href="#solucion-a-las-sumas-de-verificacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El código siguiente ilustra la clase que hace sumas de verificación.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sumador</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">sumaSimple</span><span class="o">(</span><span class="n">String</span> <span class="n">cad</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">suma</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cad</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">suma</span> <span class="o">+=</span> <span class="n">cad</span><span class="o">.</span><span class="na">codePointAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">suma</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>A continuación se muestra el servidor.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Servidor</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">servir</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ServerSocket</span> <span class="n">serverSocket</span><span class="o">;</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">PUERTO</span> <span class="o">=</span> <span class="mi">9876</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="n">PUERTO</span><span class="o">);</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Socket</span> <span class="n">conexion</span><span class="o">;</span>
                <span class="n">conexion</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
                <span class="n">HiloConexion</span> <span class="n">hiloConexion</span><span class="o">;</span>
                <span class="n">hiloConexion</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HiloConexion</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>
                <span class="n">Thread</span> <span class="n">hilo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">hiloConexion</span><span class="o">);</span>
                <span class="n">hilo</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//No se pudo crear el server</span>
            <span class="c1">//socket porque no tenemos permisos</span>
            <span class="c1">//Se pudo crear pero no fuimos</span>
            <span class="c1">//capaces de enviar o recibir nada</span>
            <span class="c1">//Todo funcionaba pero el usuario</span>
            <span class="c1">//interrumpió</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Servidor</span> <span class="n">servidor</span><span class="o">;</span>
        <span class="n">servidor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Servidor</span><span class="o">();</span>
        <span class="n">servidor</span><span class="o">.</span><span class="na">servir</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Y a  continuación el cliente:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cliente</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">verificarCadenas</span><span class="o">(</span><span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">,</span>
                                 <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;ABC&quot;</span><span class="o">);</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;ZZ&quot;</span><span class="o">);</span>
        <span class="n">pw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">suma1</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">suma2</span> <span class="o">=</span> <span class="n">bfr</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">suma1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">suma2</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Cliente</span> <span class="n">cliente</span><span class="o">;</span>
        <span class="n">cliente</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cliente</span><span class="o">();</span>
        <span class="n">InetSocketAddress</span> <span class="n">direccion</span><span class="o">;</span>
        <span class="n">direccion</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span><span class="s">&quot;10.13.0.100&quot;</span><span class="o">,</span>
                                          <span class="mi">9876</span><span class="o">);</span>
        <span class="n">Socket</span> <span class="n">conexion</span><span class="o">;</span>
        <span class="n">conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">conexion</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">direccion</span><span class="o">);</span>
            <span class="n">BufferedReader</span> <span class="n">bfr</span><span class="o">;</span>
            <span class="n">bfr</span> <span class="o">=</span> <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoLectura</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>
            <span class="n">PrintWriter</span> <span class="n">pw</span><span class="o">;</span>
            <span class="n">pw</span> <span class="o">=</span> <span class="n">Utilidades</span><span class="o">.</span><span class="na">getFlujoEscritura</span><span class="o">(</span><span class="n">conexion</span><span class="o">);</span>
            <span class="n">cliente</span><span class="o">.</span><span class="na">verificarCadenas</span><span class="o">(</span><span class="n">bfr</span><span class="o">,</span> <span class="n">pw</span><span class="o">);</span>
            <span class="n">pw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">bfr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">conexion</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//Quiza el servidor no está encendido</span>
            <span class="c1">//Quizá lo esté pero su cortafuegos</span>
            <span class="c1">//impide conexiones</span>
            <span class="c1">//...</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="servidor-de-bases-de-datos">
<h3>Servidor de bases de datos<a class="headerlink" href="#servidor-de-bases-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se desea crear un pequeño servidor de datos en el cual los cliente puedan almacenar información de empleados. La unica información que se almacena es su código y su nombre (tampoco hay que preocuparse de qué hacer si se repite un código)</p>
<p>Un cliente puede enviar al servidor varias cosas:</p>
<ul class="simple">
<li>Puede enviar una linea con el texto &#8220;CREAR&#8221;. En ese caso el cliente debe enviar despues dos líneas.  La primera línea contiene el codigo y la segunda el nombre.</li>
<li>Un cliente puede enviar la cadena &#8220;SELECT&#8221;. En ese caso el servidor contesta con una línea numérica que indica cuantos empleados hay. Si contesta por ejemplo 2 significa que va a enviar 2 parejas de líneas (codigo, nombre). Si contesta 3 significa que va a enviar 6 líneas indicando los codigos y los nombres de los empleados.</li>
</ul>
</div>
<div class="section" id="servidor-de-eco">
<h3>Servidor de eco<a class="headerlink" href="#servidor-de-eco" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se desea crear una aplicación cliente/servidor que consista de las siguientes
partes:</p>
<ul class="simple">
<li>Por un lado habrá un servidor multihilo que implementará la capacidad de</li>
</ul>
<p>&#8220;hacer el eco&#8221; de las cadenas que reciba. Así, el servidor escuchará una cadena
y cuando la reciba devolverá exactamente la misma cadena al cliente. Se da por
sentado que se recibirá una sola línea y que el servidor siempre tiene
memoria suficiente para leer dicha línea.</p>
<ul class="simple">
<li>Por otro lado, se desea tener un cliente para hacer pruebas conectándose a</li>
</ul>
<p>dicha servidor. Un cliente simplemente se conecta al servidor, le envía una
cadena y espera recibir la misma cadena.</p>
<ul class="simple">
<li>En último lugar se desea tener una clase que compruebe la capacidad del</li>
</ul>
<p>servidor. Esta clase empezará lanzando muchos clientes a la vez y comprobará si
ha habido alguna excepción. Si no la hay es que el servidor es capaz de manejar
dicha cantidad de clientes y se incrementará la cantidad total de clientes
simultáneos. El cliente irá incrementando la cantidad de clientes hasta lograr
una excepción momento en el cual mostrará por pantalla la cantidad total de
clientes que pudo manejar el servidor sin generar ninguna excepción.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Tabla de Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">Programación de comunicaciones en red</a><ul>
<li><a class="reference internal" href="#comunicacion-entre-aplicaciones">Comunicación entre aplicaciones.</a></li>
<li><a class="reference internal" href="#roles-cliente-y-servidor">Roles cliente y servidor.</a></li>
<li><a class="reference internal" href="#recordatorio-de-los-flujos-en-java">Recordatorio de los flujos en Java</a><ul>
<li><a class="reference internal" href="#inputstreams-y-outputstreams">InputStreams y OutputStreams</a></li>
<li><a class="reference internal" href="#readers-y-writers">Readers y Writers</a></li>
<li><a class="reference internal" href="#bufferedreaders-y-printwriters"><code class="docutils literal"><span class="pre">BufferedReaders</span></code> y <code class="docutils literal"><span class="pre">PrintWriters</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#elementos-de-programacion-de-aplicaciones-en-red-librerias">Elementos de programación de aplicaciones en red. Librerías.</a><ul>
<li><a class="reference internal" href="#la-clase-url">La clase URL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#repaso-de-redes">Repaso de redes</a></li>
<li><a class="reference internal" href="#funciones-y-objetos-de-las-librerias">Funciones y objetos de las librerías.</a></li>
<li><a class="reference internal" href="#sockets">Sockets.</a></li>
<li><a class="reference internal" href="#creacion-de-sockets">Creación de sockets.</a></li>
<li><a class="reference internal" href="#enlazado-y-establecimiento-de-conexiones">Enlazado y establecimiento de conexiones.</a></li>
<li><a class="reference internal" href="#utilizacion-de-sockets-para-la-transmision-y-recepcion-de-informacion">Utilización de sockets para la transmisión y recepción de información.</a><ul>
<li><a class="reference internal" href="#el-ejemplo-completo">El ejemplo completo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#programacion-de-aplicaciones-cliente-y-servidor">Programación de aplicaciones cliente y servidor.</a><ul>
<li><a class="reference internal" href="#ejemplo-de-servidor-java">Ejemplo de servidor Java</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utilizacion-de-hilos-en-la-programacion-de-aplicaciones-en-red">Utilización de hilos en la programación de aplicaciones en red.</a><ul>
<li><a class="reference internal" href="#ejercicio-servicio-de-ordenacion">Ejercicio: servicio de ordenación</a></li>
<li><a class="reference internal" href="#una-clase-protocolo">Una clase Protocolo</a></li>
<li><a class="reference internal" href="#una-clase-con-funciones-de-utilidad">Una clase con funciones de utilidad</a></li>
<li><a class="reference internal" href="#la-clase-peticion">La clase Petición</a></li>
<li><a class="reference internal" href="#la-clase-servidor">La clase Servidor</a></li>
<li><a class="reference internal" href="#la-clase-cliente">La clase Cliente</a></li>
<li><a class="reference internal" href="#ampliacion">Ampliación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ejercicios">Ejercicios</a><ul>
<li><a class="reference internal" href="#sumas-de-verificacion">Sumas de verificación</a></li>
<li><a class="reference internal" href="#solucion-a-las-sumas-de-verificacion">Solución a las sumas de verificación</a></li>
<li><a class="reference internal" href="#servidor-de-bases-de-datos">Servidor de bases de datos</a></li>
<li><a class="reference internal" href="#servidor-de-eco">Servidor de eco</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tema2.html" title="capítulo anterior">Programación multihilo</a></li>
      <li>Next: <a href="tema4.html" title="próximo capítulo">Generación de servicios en red</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/textos/tema3.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Ir a" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Oscar Gomez.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/textos/tema3.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>